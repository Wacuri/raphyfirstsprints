{"version":3,"sources":["webpack:///webpack/bootstrap 41e2055cd011ef4586c6","webpack:///external \"react\"","webpack:///../client/src/state.js","webpack:///external \"react-easy-state\"","webpack:///external \"express\"","webpack:///external \"mongoose\"","webpack:///external \"dotenv\"","webpack:///external \"path\"","webpack:///external \"isomorphic-fetch\"","webpack:///external \"react-router\"","webpack:///external \"prop-types\"","webpack:///external \"opentok-react\"","webpack:///external \"@opentok/client\"","webpack:///external \"babel-polyfill/lib/index\"","webpack:///./index.js","webpack:///./routes/index.js","webpack:///external \"body-parser\"","webpack:///./routes/api.js","webpack:///external \"fs\"","webpack:///external \"opentok\"","webpack:///./models/journey_space.js","webpack:///external \"another-mongoose-statemachine\"","webpack:///./models/journey_participant.js","webpack:///./routes/ssr.js","webpack:///external \"react-dom/server\"","webpack:///external \"redux\"","webpack:///external \"react-redux\"","webpack:///../client/src/app.js","webpack:///external \"react-router-dom\"","webpack:///../client/src/components/header.js","webpack:///../client/src/components/home.js","webpack:///../client/src/components/user_list.js","webpack:///../client/src/components/generator_form.js","webpack:///../client/src/components/session_info.js","webpack:///../client/src/components/event_message.js","webpack:///../client/src/components/Room.js","webpack:///external \"uuid\"","webpack:///external \"opentok-layout-js\"","webpack:///external \"es6-promise\"","webpack:///external \"express-session\"","webpack:///external \"connect-mongo\""],"names":["session","journeys","loggedIn","user","location","global","__INITIAL_STATE__","dotenv","require","config","__CLIENT__","__SERVER__","routes","exports","app","use","secret","saveUninitialized","resave","store","url","process","env","MONGODB_URI","MONGO_URL","cookie","expires","Date","set","join","__dirname","json","static","listen","PORT","console","log","connect","promisify","fn","promisified","params","Promise","resolve","reject","concat","err","args","length","opentok","OPENTOK_KEY","OPENTOK_SECRET","router","Router","generateToken","sessionId","tokenOptions","role","token","get","req","res","room","findOne","lean","exec","existingSession","find","present","participants","createSession","newSession","save","toJSON","post","connectionId","body","id","connections","count","participantExists","participant","sendStatus","signal","type","data","connection","ready","allReady","readdirAsync","readdir","extname","file","journeyFiles","filter","map","put","journey","start","flags","push","event","name","destroy","clearCookie","redirect","fetch","headers","method","mode","JSON","stringify","then","response","FlagSchema","String","reason","JourneySpaceSchema","index","default","plugin","states","created","started","completed","transitions","from","to","end","JourneySpace","model","JourneyParticipantSchema","Types","ObjectId","ref","Boolean","JourneyParticipant","context","originalUrl","html","renderToString","writeHead","Location","status","render","NODE_ENV","script","openTokKey","RequireLoginRoute","Component","component","rest","renderProps","pathname","Login","props","login","e","preventDefault","state","credentials","history","field","setState","target","value","padding","width","onChange","propTypes","match","object","isRequired","App","Header","OTSession","OTPublisher","OTStreams","OTSubscriber","OT","Home","streams","publisherId","totalConnectionsCreated","connectedUsers","publisher","roomUrl","sessionHelper","apiKey","onConnect","setTimeout","refreshSession","referrer","onStreamsUpdated","window","sh","on","updatedConnectionCount","newData","d","indexOf","splice","tries","fetchRetry","displayMessageVisible","displayMessageText","sessionUrl","UserList","float","paddingRight","userCount","GeneratorForm","sessionLinkName","sessionLinkUrl","handleNameChange","bind","urlFriendlyName","createSessionLink","replace","toLowerCase","SessionInfo","jumpToSession","nextProps","sessionLink","open","fontWeight","backgroundColor","EventMessage","message","undefined","polyfill","Room","onInitPublisher","onConfirmReady","onChangeJourney","cache","onStartSession","onLoadedMetadata","journeyDuration","duration","audioTag","removeEventListener","onTimeUpdate","addEventListener","playerProgress","currentTime","playerProgressMS","onFlag","playerState","publishAudio","play","disconnect","currentParticipant","currentUserHasFlaggedJourney","flag","display","position","top","right","split","flex","timeRemaining","container","gridTemplateColumns","gridGap","marginRight","stream","fontSize","bottom","seconds","minutes","Math","floor","remainingSeconds","toFixed"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA,kC;;;;;;;;;;;;;;;ACAA;;kBAEe;AACbA,WAAS,IADI;AAEbC,YAAU,EAFG;AAGbC,YAAU,KAHG;AAIbC,QAAM,IAJO;AAKbC,YAAU;AALG,GAMTC,OAAOC,iBAAP,IAA4B,EANnB,E;;;;;;ACFf,6C;;;;;;ACAA,oC;;;;;;ACAA,qC;;;;;;ACAA,mC;;;;;;ACAA,iC;;;;;;ACAA,6C;;;;;;ACAA,yC;;;;;;ACAA,uC;;;;;;ACAA,0C;;;;;;ACAA,4C;;;;;;;;;;;;;;ACAA,qD;;;;;;;;;ACAA,IAAMC,SAAS,mBAAAC,CAAQ,CAAR,CAAf;;AAEAD,OAAOE,MAAP;AACAJ,OAAOK,UAAP,GAAoB,KAApB;AACAL,OAAOM,UAAP,GAAoB,IAApB;;AAEA,IAAMC,SAAS,mBAAAJ,CAAQ,EAAR,CAAf;;AAEAK,UAAUD,MAAV,C;;;;;;;;;ACRA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;;;AAEA,IAAME,MAAM,wBAAZ;;AAEAA,IAAIC,GAAJ,CAAQ,8BAAQ;AACZC,YAAQ,8BADI;AAEZC,uBAAmB,KAFP,EAEc;AAC3BC,YAAQ,KAHK,EAGE;AACdC,WAAO,KAAK,qDAAL,EAAgC,EAACC,KAAKC,QAAQC,GAAR,CAAYC,WAAZ,IAA2BF,QAAQC,GAAR,CAAYE,SAA7C,EAAhC,CAJK;AAKZC,YAAQ,EAACC,SAAS,IAAIC,IAAJ,CAAS,eAAT,CAAV;AALI,CAAR,CAAR;;AAQAb,IAAIc,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;AACAd,IAAIc,GAAJ,CAAQ,OAAR,EAAiB,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAjB;AACAhB,IAAIC,GAAJ,CAAQ,qBAAWgB,IAAX,EAAR;;AAEAjB,IAAIC,GAAJ,CAAQ,kBAAQiB,MAAR,CAAe,eAAKH,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,QAA3B,CAAf,CAAR;;AAEAhB,IAAIC,GAAJ,CAAQ,MAAR;AACAD,IAAIC,GAAJ,CAAQ,IAAR;;AAEAD,IAAImB,MAAJ,CAAWZ,QAAQC,GAAR,CAAYY,IAAZ,IAAoB,IAA/B,EAAqC,YAAM;AACzCC,YAAQC,GAAR,CAAY,qCAAZ;AACD,CAFD,E;;;;;;AC5BA,wC;;;;;;;;;;;;;;;ACAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;AACA,mBAAA5B,CAAQ,CAAR;;AAEA,iBAAOC,MAAP;;AAEA,mBAAS4B,OAAT,CAAiBhB,QAAQC,GAAR,CAAYC,WAAZ,IAA2BF,QAAQC,GAAR,CAAYE,SAAxD;;AAEA,SAASc,SAAT,CAAmBC,EAAnB,EAAuB;AACrB;;;;AAIA,SAAO,SAASC,WAAT,GAAgC;AAAA,sCAARC,MAAQ;AAARA,YAAQ;AAAA;;AACrC,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV;AAAA,aAAqBL,uCAAME,OAAOI,MAAP,CAAc,CAAC,UAACC,GAAD;AAAA,2CAASC,IAAT;AAASA,cAAT;AAAA;;AAAA,eAAkBD,MAAMF,OAAOE,GAAP,CAAN,GAAoBH,QAASI,KAAKC,MAAL,GAAc,CAAd,GAAkBD,KAAK,CAAL,CAAlB,GAA4BA,IAArC,CAAtC;AAAA,OAAD,CAAd,CAAN,EAArB;AAAA,KAAZ,CAAP;AACD,GAFD;AAGD;;AAED,IAAME,UAAU,sBAAY5B,QAAQC,GAAR,CAAY4B,WAAxB,EAAqC7B,QAAQC,GAAR,CAAY6B,cAAjD,CAAhB;AACA,IAAMC,SAAS,kBAAQC,MAAR,EAAf;;AAEA,SAASC,aAAT,CAAuBC,SAAvB,EAAkC;AACjC,MAAIC,eAAe,EAAnB;AACAA,eAAaC,IAAb,GAAoB,WAApB;AACA;AACA,MAAMC,QAAQT,QAAQK,aAAR,CAAsBC,SAAtB,EAAiCC,YAAjC,CAAd;AACCrB,UAAQC,GAAR,CAAY,cAAZ,EAA4BsB,KAA5B;AACD,SAAOA,KAAP;AACA;;AAED;AACAN,OAAOO,GAAP,CAAW,iBAAX;AAAA,qEAA8B,kBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACtBC,gBADsB,GACdF,IAAInB,MADU,CACtBqB,IADsB;AAAA;AAAA,mBAEC,wBAAaC,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BE,IAA7B,GAAoCC,IAApC,EAFD;;AAAA;AAEvBC,2BAFuB;;AAAA,iBAGzBA,eAHyB;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAIC,8BAAmBC,IAAnB,CAAwB,EAACnE,SAASkE,eAAV,EAA2BE,SAAS,IAApC,EAAxB,EAAmEJ,IAAnE,GAA0EC,IAA1E,EAJD;;AAAA;AAIpBI,wBAJoB;;AAK1BH,4BAAgBG,YAAhB,GAA+BA,YAA/B;AACFR,gBAAI9B,IAAJ,cACImC,eADJ;AAECR,qBAAOJ,cAAcY,gBAAgBX,SAA9B;AAFR;AAN4B;AAAA;;AAAA;AAW5BN,oBAAQqB,aAAR;AAAA,kFAAsB,iBAAOxB,GAAP,EAAY9C,OAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAChB8C,GADgB;AAAA;AAAA;AAAA;;AAAA,8BACLA,GADK;;AAAA;AAErB;AACMyB,kCAHe,GAGF,4BAAiB,EAACT,UAAD,EAAOP,WAAWvD,QAAQuD,SAA1B,EAAjB,CAHE;AAAA;AAAA,+BAIfgB,WAAWC,IAAX,EAJe;;AAAA;AAKrBX,4BAAI9B,IAAJ,cACIwC,WAAWE,MAAX,EADJ;AAECf,iCAAOJ,cAActD,QAAQuD,SAAtB;AAFR;;AALqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAtB;;AAAA;AAAA;AAAA;AAAA;;AAX4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA9B;;AAAA;AAAA;AAAA;AAAA;;AAwBAH,OAAOsB,IAAP,CAAY,wBAAZ;AAAA,sEAAsC,kBAAOd,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAC9BC,gBAD8B,GACtBF,IAAInB,MADkB,CAC9BqB,IAD8B;AAEzBa,wBAFyB,GAETf,IAAIgB,IAFK,CAE7BC,EAF6B;;AAGpCjB,gBAAI5D,OAAJ,CAAY8E,WAAZ,GAA0BlB,IAAI5D,OAAJ,CAAY8E,WAAZ,IAA2B,EAArD;AACAlB,gBAAI5D,OAAJ,CAAY8E,WAAZ,CAAwBhB,IAAxB,IAAgCa,YAAhC;AAJoC;AAAA,mBAKP,wBAAaZ,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BE,IAA7B,GAAoCC,IAApC,EALO;;AAAA;AAK/BC,2BAL+B;;AAAA,iBAMjCA,eANiC;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAOC,8BAAmBa,KAAnB,CAAyB,EAAC/E,SAASkE,eAAV,EAA2BS,0BAA3B,EAAzB,CAPD;;AAAA;AAAA;AAO1BK,6BAP0B,kBAOuE,CAPvE;;AAAA,gBAQ3BA,iBAR2B;AAAA;AAAA;AAAA;;AASxBC,uBATwB,GASV,kCAAuB,EAACjF,SAASkE,eAAV,EAA2BS,cAAcA,YAAzC,EAAuDxE,MAAMyD,IAAI5D,OAAJ,CAAYG,IAAzE,EAAvB,CATU;AAAA;AAAA,mBAUxB8E,YAAYT,IAAZ,EAVwB;;AAAA;AAapCX,gBAAIqB,UAAJ,CAAe,GAAf;;AAboC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtC;;AAAA;AAAA;AAAA;AAAA;;AAgBA9B,OAAOO,GAAP,CAAW,+BAAX;AAAA,sEAA4C,kBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,0BACbD,IAAInB,MADS,EACnCqB,IADmC,eACnCA,IADmC,EAC7Ba,YAD6B,eAC7BA,YAD6B;AAAA;AAAA,mBAEb,wBAAaZ,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BE,IAA7B,GAAoCC,IAApC,EAFa;;AAAA;AAErCC,2BAFqC;;AAAA,iBAGvCA,eAHuC;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAId,8BAAmBH,OAAnB,CAA2B,EAAC/D,SAASkE,eAAV,EAA2BS,0BAA3B,EAA3B,EAAqEV,IAArE,EAJc;;AAAA;AAIlCgB,uBAJkC;;AAKxCpB,gBAAI9B,IAAJ,CAASkD,WAAT;AALwC;;AAAA;AAQ1CpB,gBAAIqB,UAAJ,CAAe,GAAf;;AAR0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA5C;;AAAA;AAAA;AAAA;AAAA;;AAWA;AACA;AACA9B,OAAOO,GAAP,CAAW,mCAAX;AAAA,sEAAgD,kBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEhB,wBAAaE,OAAb,CAAqB,EAACD,MAAK,oBAAN,EAArB,EAAkDG,IAAlD,EAFgB;;AAAA;AAExCC,2BAFwC;;AAAA,iBAG1CA,eAH0C;AAAA;AAAA;AAAA;;AAI9C/B,oBAAQC,GAAR,CAAY,qBAAZ;AACA+C,mBAAOjB,gBAAgBX,SAAvB,EAAkC,EAAC6B,MAAM,uBAAP,EAAgCC,MAAM,4CAAtC,EAAlC;AAL8C,8CAMvCxB,IAAIqB,UAAJ,CAAe,GAAf,CANuC;;AAAA;AAQ9CrB,gBAAIqB,UAAJ,CAAe,GAAf;;AAR8C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAhD;;AAAA;AAAA;AAAA;AAAA;;AAWA9B,OAAOO,GAAP,CAAW,+CAAX;AAAA,sEAA4D,kBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,2BAC/BD,IAAInB,MAD2B,EACnDqB,IADmD,gBACnDA,IADmD,EAC7CwB,UAD6C,gBAC7CA,UAD6C;AAAA;AAAA,mBAE5B,wBAAavB,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BG,IAA7B,EAF4B;;AAAA;AAEpDC,2BAFoD;;AAAA,iBAGvDA,eAHuD;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAI9B,8BAAmBH,OAAnB,CAA2B,EAAC/D,SAASkE,eAAV,EAA2BS,cAAcW,UAAzC,EAA3B,CAJ8B;;AAAA;AAIlDL,uBAJkD;;AAKxDA,wBAAYM,KAAZ,GAAoB,IAApB;AALwD;AAAA,mBAMlDN,YAAYT,IAAZ,EANkD;;AAAA;AAOxDW,mBAAOjB,gBAAgBX,SAAvB,EAAkC,EAAC6B,MAAM,OAAP,EAAgBC,MAAM,KAAtB,EAAlC;AAPwD;AAAA,mBAQhC,8BAAmBN,KAAnB,CAAyB,EAAC/E,SAASkE,eAAV,EAA2BqB,OAAO,KAAlC,EAAyCnB,SAAS,IAAlD,EAAzB,CARgC;;AAAA;AAAA;AAQlDoB,oBARkD,oBAQuD,CARvD;;AASxD,gBAAIA,QAAJ,EAAc;AACZ;AACD;AAXuD,8CAYjD3B,IAAIqB,UAAJ,CAAe,GAAf,CAZiD;;AAAA;AAc1DrB,gBAAIqB,UAAJ,CAAe,GAAf;;AAd0D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA5D;;AAAA;AAAA;AAAA;AAAA;;AAiBA9B,OAAOO,GAAP,CAAW,WAAX;AAAA,sEAAwB,kBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAChB4B,wBADgB,GACDnD,UAAU,aAAGoD,OAAb,CADC;AAAA;AAAA,mBAEMD,aAAa,eAAK5D,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,iBAA3B,CAAb,CAFN;;AAAA;AAAA,2BAE0E,gBAAQ;AACtG,qBAAO,eAAK6D,OAAL,CAAaC,IAAb,MAAuB,MAA9B;AACD,aAJqB;;AAAA,2BAIf,gBAAQ;AACb,oCAAoBA,IAApB;AACD,aANqB;;AAEhBC,wBAFgB,kBAEmEC,MAFnE,eAInBC,GAJmB;;AAOtBlC,gBAAI9B,IAAJ,CAAS8D,YAAT;;AAPsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAxB;;AAAA;AAAA;AAAA;AAAA;;AAUAzC,OAAO4C,GAAP,CAAW,yBAAX;AAAA,sEAAsC,kBAAOpC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AACpC1B,oBAAQC,GAAR,CAAY,gBAAZ;AACO6D,mBAF6B,GAElBrC,IAAIgB,IAFc,CAE7BqB,OAF6B;AAG7BnC,gBAH6B,GAGrBF,IAAInB,MAHiB,CAG7BqB,IAH6B;AAAA;AAAA,mBAIN,wBAAaC,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BG,IAA7B,EAJM;;AAAA;AAI9BC,2BAJ8B;;AAAA,iBAKjCA,eALiC;AAAA;AAAA;AAAA;;AAMlCA,4BAAgB+B,OAAhB,GAA0BA,OAA1B;AANkC;AAAA,mBAO5B/B,gBAAgBM,IAAhB,EAP4B;;AAAA;AAQlCW,mBAAOjB,gBAAgBX,SAAvB,EAAkC,EAAC6B,MAAM,gBAAP,EAAyBC,MAAMY,OAA/B,EAAlC;;AARkC;AAUpCpC,gBAAIqB,UAAJ,CAAe,GAAf;;AAVoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtC;;AAAA;AAAA;AAAA;AAAA;;AAaA;AACA9B,OAAOsB,IAAP,CAAY,uBAAZ;AAAA,sEAAqC,kBAAOd,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAC5BC,gBAD4B,GACpBF,IAAInB,MADgB,CAC5BqB,IAD4B;AAAA;AAAA,mBAEL,wBAAaC,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BG,IAA7B,EAFK;;AAAA;AAE7BC,2BAF6B;;AAAA,iBAGhCA,eAHgC;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAI3BA,gBAAgBgC,KAAhB,EAJ2B;;AAAA;AAKjCf,mBAAOjB,gBAAgBX,SAAvB,EAAkC,EAAC6B,MAAM,cAAP,EAAuBC,MAAM,EAA7B,EAAlC;;AALiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAArC;;AAAA;AAAA;AAAA;AAAA;;AASAjC,OAAOsB,IAAP,CAAY,sBAAZ;AAAA,uEAAoC,mBAAOd,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAC3BC,gBAD2B,GACnBF,IAAInB,MADe,CAC3BqB,IAD2B;AAE3Ba,wBAF2B,GAEXf,IAAIgB,IAFO,CAE3BD,YAF2B;AAAA;AAAA,mBAGJ,wBAAaZ,OAAb,CAAqB,EAACD,UAAD,EAArB,EAA6BG,IAA7B,EAHI;;AAAA;AAG5BC,2BAH4B;;AAAA,iBAI/BA,eAJ+B;AAAA;AAAA;AAAA;;AAKhCA,4BAAgBiC,KAAhB,CAAsBC,IAAtB,CAA2B,EAACjG,MAAMwE,YAAP,EAA3B;AALgC;AAAA,mBAM1BT,gBAAgBM,IAAhB,EAN0B;;AAAA;AAAA;AAAA,mBAOL,8BAAmBL,IAAnB,CAAwB,EAACnE,SAASkE,eAAV,EAA2BE,SAAS,IAApC,EAAxB,EAAmEJ,IAAnE,GAA0EC,IAA1E,EAPK;;AAAA;AAO1BI,wBAP0B;AAAA,+CAQzBR,IAAI9B,IAAJ,cAAamC,gBAAgBO,MAAhB,EAAb,IAAuCJ,0BAAvC,IARyB;;AAAA;AAUlCR,gBAAIqB,UAAJ,CAAe,GAAf;;AAVkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAApC;;AAAA;AAAA;AAAA;AAAA;;AAaA9B,OAAOsB,IAAP,CAAY,QAAZ;AAAA,uEAAsB,mBAAOd,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AACpB1B,oBAAQC,GAAR,CAAY,WAAZ,EAAyBwB,IAAIgB,IAA7B;AACAf,gBAAIqB,UAAJ,CAAe,GAAf;AAFoB,wBAGYtB,IAAIgB,IAHhB,EAGbrB,SAHa,aAGbA,SAHa,EAGF+B,UAHE,aAGFA,UAHE;AAAA;AAAA,mBAIE,wBAAavB,OAAb,CAAqB,EAACR,oBAAD,EAArB,EAAkCU,IAAlC,EAJF;;AAAA;AAIdjE,mBAJc;;;AAMpBmC,oBAAQC,GAAR,CAAY,YAAYwB,IAAIgB,IAA5B;;AANoB,4BAQbhB,IAAIgB,IAAJ,CAASyB,KARI;AAAA,gDASb,mBATa,0BAkBb,qBAlBa;AAAA;;AAAA;AAAA,iBAUZrG,OAVY;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAWmB,8BAAmB+E,KAAnB,CAAyB,EAAC/E,gBAAD,EAAU2E,cAAcW,WAAWT,EAAnC,EAAzB,CAXnB;;AAAA;AAAA;AAWRG,6BAXQ,mBAWuF,CAXvF;;AAAA,gBAYTA,iBAZS;AAAA;AAAA;AAAA;;AAaNC,uBAbM,GAaQ,kCAAuB,EAACjF,gBAAD,EAAU2E,cAAcW,WAAWT,EAAnC,EAAvB,CAbR;AAAA;AAAA,mBAcNI,YAAYT,IAAZ,EAdM;;AAAA;AAAA;;AAAA;AAAA,iBAmBZxE,OAnBY;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAoBW,8BAAmB+D,OAAnB,CAA2B,EAAC/D,gBAAD,EAAU2E,cAAcW,WAAWT,EAAnC,EAA3B,CApBX;;AAAA;AAoBRI,wBApBQ;;AAAA,iBAqBVA,YArBU;AAAA;AAAA;AAAA;;AAsBZA,yBAAYb,OAAZ,GAAsB,KAAtB;AAtBY;AAAA,mBAuBNa,aAAYT,IAAZ,EAvBM;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtB;;AAAA;AAAA;AAAA;AAAA;;AA8BApB,OAAOsB,IAAP,CAAY,QAAZ,EAAsB,UAACd,GAAD,EAAMC,GAAN,EAAc;AAClCD,MAAI5D,OAAJ,CAAYE,QAAZ,GAAuB,IAAvB;AACA0D,MAAI5D,OAAJ,CAAYG,IAAZ,GAAmB;AACjBmG,UAAM1C,IAAIgB,IAAJ,CAAS0B;AADE,GAAnB;AAGAzC,MAAI9B,IAAJ,CAAS,EAAC7B,UAAU,IAAX,EAAiBC,MAAM,EAACmG,MAAM1C,IAAIgB,IAAJ,CAAS0B,IAAhB,EAAvB,EAAT;AACD,CAND;;AAQAlD,OAAOO,GAAP,CAAW,SAAX,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAClCD,MAAI5D,OAAJ,CAAYuG,OAAZ,CAAoB,YAAM;AACtB1C,QACG2C,WADH,CACe,aADf,EAEGC,QAFH,CAEY,QAFZ;AAGD,GAJH;AAKD,CAND;;AAQA,SAAStB,MAAT,CAAgB5B,SAAhB,EAA2B8B,IAA3B,EAAiC;AAC/BqB,gDAA4CrF,QAAQC,GAAR,CAAY4B,WAAxD,iBAA+EK,SAA/E,cAAmG;AACjGoD,aAAS;AACP,2BAAwBtF,QAAQC,GAAR,CAAY4B,WAApC,SAAmD7B,QAAQC,GAAR,CAAY6B;AADxD,KADwF;AAIjGyD,YAAQ,MAJyF;AAKjGC,UAAM,MAL2F;AAMjGjC,UAAMkC,KAAKC,SAAL,CAAe1B,IAAf;AAN2F,GAAnG,EAOG2B,IAPH,CAOQ;AAAA,WAAY7E,QAAQC,GAAR,CAAY6E,QAAZ,CAAZ;AAAA,GAPR;AAQD;;kBAEc7D,M;;;;;;AC7Nf,+B;;;;;;ACAA,oC;;;;;;;;;;;;;ACAA;;;;AACA;;;;;;AAEA,IAAM8D,aAAa,qBAAW;AAC5B/G,QAAM,EAACiF,MAAM+B,MAAP,EADsB;AAE5BC,UAAQ,EAAChC,MAAM+B,MAAP;AAFoB,CAAX,CAAnB;;AAKA,IAAME,qBAAqB,qBAAW;AACpCvD,QAAM,EAACsB,MAAM+B,MAAP,EAAeG,OAAO,IAAtB,EAD8B;AAEpC/D,aAAW,EAAC6B,MAAM+B,MAAP,EAAeG,OAAO,IAAtB,EAFyB;AAGpCrB,WAAS,EAACb,MAAM+B,MAAP,EAAeI,SAAS,4CAAxB,EAH2B;AAIpCpB,SAAO,EAACf,MAAM,CAAC8B,UAAD,CAAP,EAAqBK,SAAS,EAA9B;AAJ6B,CAAX,CAA3B;;AAOAF,mBAAmBG,MAAnB,wCAAwC;AACtCC,UAAQ;AACNC,aAAS,EAACH,SAAS,IAAV,EADH;AAENI,aAAS,EAFH;AAGNC,eAAW;AAHL,GAD8B;AAMtCC,eAAa;AACX3B,WAAO,EAAE4B,MAAM,SAAR,EAAmBC,IAAI,SAAvB,EADI;AAEXC,SAAK,EAAEF,MAAM,GAAR,EAAaC,IAAI,WAAjB;AAFM;AANyB,CAAxC;;AAYA,IAAME,eAAe,mBAASC,KAAT,CAAe,cAAf,EAA+Bb,kBAA/B,CAArB;;kBAEeY,Y;;;;;;AC7Bf,0D;;;;;;;;;;;;;ACAA;;;;;;AAEA,IAAME,2BAA2B,qBAAW;AAC1C,kBAAgB,EAAC/C,MAAM+B,MAAP,EAAeG,OAAO,IAAtB,EAD0B;AAE1C,aAAW,EAAClC,MAAM,iBAAOgD,KAAP,CAAaC,QAApB,EAA8BC,KAAK,cAAnC,EAF+B;AAG1C,WAAS,EAAClD,MAAMmD,OAAP,EAAgBhB,SAAS,KAAzB,EAHiC;AAI1C,aAAW,EAACnC,MAAMmD,OAAP,EAAgBhB,SAAS,IAAzB,EAJ+B;AAK1CpH,QAAM,qBAAW,EAACmG,MAAMa,MAAP,EAAX;AALoC,CAAX,CAAjC;;AAQA,IAAMqB,qBAAqB,mBAASN,KAAT,CAAe,oBAAf,EAAqCC,wBAArC,CAA3B;;kBAEeK,kB;;;;;;;;;;;;;ACZf;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;;;;;AAEA,IAAMpF,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOO,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5B,MAAM4E,UAAU,EAAhB;;AAEA,kBAAMvI,QAAN,GAAiB0D,IAAI5D,OAAJ,CAAYE,QAA7B;AACA,kBAAMC,IAAN,GAAayD,IAAI5D,OAAJ,CAAYG,IAAzB;AACAgC,UAAQC,GAAR,CAAY,aAAZ,EAA2BwB,IAAI5D,OAA/B,EAAwC4D,IAAI8E,WAA5C;;AAEA,MAAMC,OAAO,iBAAeC,cAAf,CACX;AAAA;AAAA;AACE,gBAAUhF,IAAI8E,WADhB;AAEE,eAASD;AAFX;AAIE;AAJF,GADW,CAAb;;AASAtG,UAAQC,GAAR,CAAY,UAAZ,EAAwBuG,IAAxB,EAA8BF,QAAQrH,GAAtC;AACA,MAAIqH,QAAQrH,GAAZ,EAAiB;AACfe,YAAQC,GAAR,CAAY,UAAZ;AACA,QAAIwB,IAAI8E,WAAJ,IAAmB,cAAvB,EAAuC;AACrC7E,UAAIgF,SAAJ,CAAc,GAAd,EAAmB;AACjBC,kBAAUL,QAAQrH;AADD,OAAnB;AAGD;AACDyC,QAAImE,GAAJ;AACD,GARD,MAQO;AACLnE,QAAIkF,MAAJ,CAAW,GAAX,EAAgBC,MAAhB,CAAuB3H,QAAQC,GAAR,CAAY2H,QAAZ,KAAyB,YAAzB,GAAwC,WAAxC,GAAsD,eAA7E,EAA8F;AAC5FN,gBAD4F;AAE5FO,cAAQpC,KAAKC,SAAL,CAAe,EAACoC,YAAY9H,QAAQC,GAAR,CAAY4B,WAAzB,EAAsChD,UAAU0D,IAAI5D,OAAJ,CAAYE,QAA5D,EAAsEC,MAAMyD,IAAI5D,OAAJ,CAAYG,IAAxF,EAAf;AAFoF,KAA9F;AAID;AACF,CA/BD;;kBAkCeiD,M;;;;;;AC7Cf,6C;;;;;;ACAA,kC;;;;;;ACAA,wC;;;;;;;;;;;;;;;;;ACAA;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;AAEA,IAAMgG,oBAAoB,SAApBA,iBAAoB,OAAqC;AAAA,MAAxBC,SAAwB,QAAnCC,SAAmC;AAAA,MAAVC,IAAU;;AAC7D,SACE,kEAAWA,IAAX,IAAiB,QAAQ,6BAAe;AACpC,aACE,gBAAMrJ,QAAN,GACE,8BAAC,SAAD,EAAesJ,WAAf,CADF,GAEE,0DAAU,IAAK;AACXC,oBAAU;AADC,SAAf,GAHJ;AAOH,KARD,IADF;AAWD,CAZD;;IAcMC,K;;;AAOJ,iBAAYC,KAAZ,EAAmB;AAAA;;AAAA,8GACXA,KADW;;AAAA,UAenBC,KAfmB,GAeX,UAACC,CAAD,EAAO;AACbA,QAAEC,cAAF;AACApD,0BAAoB;AAClB9B,cAAMkC,KAAKC,SAAL,CAAe,EAACT,MAAM,MAAKyD,KAAL,CAAWzD,IAAlB,EAAf,CADY,EAC6B;AAC/CM,gBAAQ,MAFU,EAEF;AAChBoD,qBAAa,aAHK;AAIlBrD,iBAAS;AACP,0BAAgB;AADT;AAJS,OAApB,EAQCK,IARD,CAQM;AAAA,eAAYC,SAASlF,IAAT,EAAZ;AAAA,OARN,EASCiF,IATD,CASM,gBAAQ;AACZ,wBAAM9G,QAAN,GAAiB6B,KAAK7B,QAAtB;AACA,wBAAMC,IAAN,GAAa4B,KAAK5B,IAAlB;AACA,cAAKwJ,KAAL,CAAWM,OAAX,CAAmB7D,IAAnB,CAAwB,GAAxB;AACD,OAbD;AAcD,KA/BkB;;AAEjB,UAAK2D,KAAL,GAAa;AACXzD,YAAM;AADK,KAAb;AAFiB;AAKlB;;;;6BAEQ4D,K,EAAO;AAAA;;AACd,aAAO,UAACL,CAAD,EAAO;AACZ,eAAKM,QAAL,qBACGD,KADH,EACWL,EAAEO,MAAF,CAASC,KADpB;AAGD,OAJD;AAKD;;;6BAoBQ;AACP,aACE;AAAA;AAAA,UAAK,OAAO,EAACC,SAAS,MAAV,EAAkBC,OAAO,KAAzB,EAAZ;AACE;AAAA;AAAA,YAAM,UAAU,KAAKX,KAArB;AACE;AAAA;AAAA,cAAK,WAAU,YAAf;AACE;AAAA;AAAA,gBAAO,SAAQ,MAAf;AAAA;AAAA,aADF;AAEE,qDAAO,MAAK,MAAZ,EAAmB,UAAU,KAAKY,QAAL,CAAc,MAAd,CAA7B,EAAoD,OAAO,KAAKT,KAAL,CAAWzD,IAAtE,EAA4E,WAAU,cAAtF,EAAqG,IAAG,MAAxG,EAA+G,oBAAiB,UAAhI,EAA2I,aAAY,YAAvJ;AAFF,WADF;AAKE;AAAA;AAAA,cAAQ,MAAK,QAAb,EAAsB,WAAU,iBAAhC;AAAA;AAAA;AALF;AADF,OADF;AAWD;;;;;;AApDGoD,K,CACGe,S,GAAY;AACjBC,SAAO,oBAAUC,MAAV,CAAiBC,UADP;AAEjBxK,YAAU,oBAAUuK,MAAV,CAAiBC,UAFV;AAGjBX,WAAS,oBAAUU,MAAV,CAAiBC;AAHT,C;;IAsDfC,G;;;;;;;;;;;6BACK;AACP,aACE;AAAA;AAAA;AACE,6DADF;AAEE;AAAA;AAAA;AACE,iEAAO,WAAP,EAAa,MAAK,QAAlB,EAA2B,WAAW,6BAAWnB,KAAX,CAAtC,GADF;AAEE,wCAAC,iBAAD,IAAmB,WAAnB,EAAyB,MAAK,GAA9B,EAAkC,yBAAlC,GAFF;AAGE,wCAAC,iBAAD,IAAmB,WAAnB,EAAyB,MAAK,QAA9B,EAAuC,yBAAvC;AAHF;AAFF,OADF;AAUD;;;;;;kBAGY,6BAAW,0BAAKmB,GAAL,CAAX,C;;;;;;AC9Ff,6C;;;;;;;;;;;;;ACAA;;;;AACA;;AACA;;;;;;AAEA,IAAMC,SAAS,SAATA,MAAS;AAAA,SACb;AAAA;AAAA,MAAK,WAAU,aAAf;AACE;AAAA;AAAA;AAAA;AAAA,KADF;AAEG,oBAAM5K,QAAN,IAAkB,gBAAMC,IAAxB,IACC;AAAA;AAAA;AACE;AAAA;AAAA,UAAM,WAAU,qBAAhB;AAAA;AAAoD,wBAAMA,IAAN,CAAWmG;AAA/D,OADF;AAEE;AAAA;AAAA,UAAG,MAAK,aAAR;AAAA;AAAA;AAFF;AAHJ,GADa;AAAA,CAAf;;kBAYe,0BAAKwE,MAAL,C;;;;;;;;;;;;;;;AChBf;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;WAGyE,E;IAAnEC,S,QAAAA,S;IAAWC,W,QAAAA,W;IAAaC,S,QAAAA,S;IAAWC,Y,QAAAA,Y;IAAc5G,a,QAAAA,a;;;AAEvD,IAAI5D,UAAJ,EAAgB;AAAA,iBAC2D,mBAAAF,CAAQ,EAAR,CAD3D;AAAA,MACRuK,SADQ,YACRA,SADQ;AAAA,MACGC,WADH,YACGA,WADH;AAAA,MACgBC,SADhB,YACgBA,SADhB;AAAA,MAC2BC,YAD3B,YAC2BA,YAD3B;AAAA,MACyC5G,aADzC,YACyCA,aADzC;;AAEd,MAAM6G,KAAK,mBAAA3K,CAAQ,EAAR,CAAX;AACD;;IAEoB4K,I;;;AACnB,gBAAYzB,KAAZ,EAAmB;AAAA;;AAAA,4GACXA,KADW;;AAGjB,UAAKI,KAAL,GAAa;AACXsB,eAAS,EADE;AAEXC,mBAAa,EAFF;AAGXtL,eAAS,IAHE;AAIXuL,+BAAyB,CAJd;AAKXC,sBAAgB;AALL,KAAb;AAOA,UAAKC,SAAL,GAAiB,EAAjB;AAViB;AAWlB;;;;wCAEmB;AAAA;;AAClB,UAAMC,UAAU,oBAAhB;;AAEAhF,+BAAuBgF,OAAvB,EACG1E,IADH,CACQ;AAAA,eAAOnD,IAAI9B,IAAJ,EAAP;AAAA,OADR,EAEGiF,IAFH,CAEQ,gBAAQ;AACZ,wBAAMhH,OAAN,GAAgB+B,IAAhB;AACA,eAAK4J,aAAL,GAAqBrH,cAAc;AACjCsH,kBAAQ,gBAAMzC,UADmB;AAEjC5F,qBAAW,gBAAMvD,OAAN,CAAcuD,SAFQ;AAGjCG,iBAAO,gBAAM1D,OAAN,CAAc0D,KAHY;AAIjCmI,qBAAW,qBAAM;AACf1J,oBAAQC,GAAR,CAAY,kCAAZ,EAAgD,OAAKuJ,aAAL,CAAmB3L,OAAnB,CAA2BsF,UAA3E;AACAwG,uBAAW,OAAKC,cAAhB,EAAgC,IAAhC;AACArF,qCAAuBgF,OAAvB,cAAyC;AACvC9G,oBAAMkC,KAAKC,SAAL,CAAe,EAAClC,IAAI,OAAK8G,aAAL,CAAmB3L,OAAnB,CAA2BsF,UAA3B,CAAsCT,EAA3C,EAAf,CADiC;AAEvCmF,2BAAa,aAF0B,EAEX;AAC5BrD,uBAAS;AACP,8BAAc,yBADP;AAEP,gCAAgB;AAFT,eAH8B;AAOvCC,sBAAQ,MAP+B,EAOvB;AAChBC,oBAAM,MARiC,EAQzB;AACdJ,wBAAU,QAT6B,EASnB;AACpBuF,wBAAU,aAV6B,CAUd;AAVc,aAAzC;AAYD,WAnBgC;AAoBjCC,4BAAkB,mCAAW;AAC3B9J,oBAAQC,GAAR,CAAY,6BAAZ,EAA2CiJ,OAA3C;AACA,mBAAKlB,QAAL,CAAc,EAAEkB,gBAAF,EAAd;AACD;AAvBgC,SAAd,CAArB;AAyBAa,eAAOC,EAAP,GAAY,OAAKR,aAAjB;AACA,eAAKA,aAAL,CAAmB3L,OAAnB,CAA2BoM,EAA3B,CAA8B,qBAA9B,EAAqD,UAAC/F,KAAD,EAAW;AAC9DlE,kBAAQC,GAAR,CAAY,WAAZ,EAAyBiE,KAAzB;AACA,cAAMhB,OAAO;AACX9B,uBAAW,OAAKoI,aAAL,CAAmB3L,OAAnB,CAA2BuD,SAD3B;AAEX+B,wBAAY;AACVT,kBAAIwB,MAAMf,UAAN,CAAiBT;AADX,aAFD;AAKXwB,mBAAO;;AALI,WAAb;;AASA,cAAMgG,yBAAyB,OAAKtC,KAAL,CAAWwB,uBAAX,GAAqC,CAApE;AACA,iBAAKpB,QAAL,CAAc,EAACoB,yBAAyBc,sBAA1B,EAAd;;AAEA,cAAIC,uCAAc,OAAKvC,KAAL,CAAWyB,cAAzB,EAAJ;AACA,cAAIlE,QAAQgF,QAAQvG,GAAR,CAAY;AAAA,mBAAKwG,EAAE5H,YAAP;AAAA,WAAZ,EAAiC6H,OAAjC,CAAyCnG,MAAMf,UAAN,CAAiBT,EAA1D,CAAZ;AACAyH,kBAAQG,MAAR,CAAenF,KAAf,EAAsB,CAAtB;AACA,iBAAK6C,QAAL,CAAc,EAACqB,gBAAgBc,OAAjB,EAAd;;AAEAnK,kBAAQC,GAAR,CAAY,SAAZ,EAAuBiD,IAAvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,SAlCD;;AAsCA,eAAKsG,aAAL,CAAmB3L,OAAnB,CAA2BoM,EAA3B,CAA8B,mBAA9B,EAAmD,UAAC/F,KAAD,EAAW;AAC5DlE,kBAAQC,GAAR,CAAY,SAAZ,EAAuBiE,KAAvB;AACA,cAAMgG,yBAAyB,OAAKtC,KAAL,CAAWwB,uBAAX,GAAqC,CAApE;AACA,iBAAKpB,QAAL,CAAc,EAACoB,yBAAyBc,sBAA1B,EAAd;AACAlK,kBAAQC,GAAR,CAAY,6BAA6B,OAAK2H,KAAL,CAAWwB,uBAApD;AACA,cAAMlG,OAAO;AACX9B,uBAAW,OAAKoI,aAAL,CAAmB3L,OAAnB,CAA2BuD,SAD3B;AAEX+B,wBAAY;AACVT,kBAAIwB,MAAMf,UAAN,CAAiBT;AADX,aAFD;AAKXwB,mBAAO;AALI,WAAb;;AAQA,cAAIqG,QAAQ,EAAZ;AACA,cAAMC,aAAa,SAAbA,UAAa,GAAM;AACvBjG,qCAAuBgF,OAAvB,SAAkCrF,MAAMf,UAAN,CAAiBT,EAAnD,EAAyDmC,IAAzD,CAA8D;AAAA,qBAAOnD,IAAI9B,IAAJ,EAAP;AAAA,aAA9D,EAAiFiF,IAAjF,CAAsF,gBAAQ;AAC5F,kBAAI,CAACjF,IAAD,IAAS2K,UAAU,CAAvB,EAA0B;AACxBZ,2BAAWa,UAAX,EAAuB,GAAvB;AACD,eAFD,MAEO;AACL,uBAAKxC,QAAL,CAAc;AACZqB,+DAAoB,OAAKzB,KAAL,CAAWyB,cAA/B,IAA+CzJ,IAA/C;AADY,iBAAd;AAGD;AACF,aARD;AASD,WAVD;AAWA4K;AACD,SA1BD;;AA8BA,eAAKhB,aAAL,CAAmB3L,OAAnB,CAA2BoM,EAA3B,CAA8B,QAA9B,EAAwC,UAAC/F,KAAD,EAAW;AACjDlE,kBAAQC,GAAR,CAAY,8BAAZ,EAA4CiE,KAA5C;AACAlE,kBAAQC,GAAR,CAAY,aAAZ,EAA2BiE,MAAMjB,IAAjC;AACA;;AAEA,cAAIiB,MAAMjB,IAAN,KAAe,8BAAnB,EAAmD;AACjDjD,oBAAQC,GAAR,CAAY,uCAAZ;AACA,mBAAK+H,QAAL,CAAc;AACZyC,qCAAuB,IADX;AAEZC,kCAAoB,0DAFR,EAEoE;AAChFC,0BAAY;AAHA,aAAd;AAKD;AACF,SAbD;;AAeA,eAAK3C,QAAL,CAAc;AACZnK,mBAAS,OAAK2L,aAAL,CAAmB3L;AADhB,SAAd;AAGD,OApHH;;AAuHA0G,YAAM,eAAN,EACGM,IADH,CACQ;AAAA,eAAOnD,IAAI9B,IAAJ,EAAP;AAAA,OADR,EAEGiF,IAFH,CAEQ,gBAAQ;AACZ,wBAAM/G,QAAN,GAAiB8B,IAAjB;AACD,OAJH;AAMD;;;6BAMQ;AACP,aACE;AAAA;AAAA,UAAK,WAAU,MAAf;AACE,6DAAU,WAAW,KAAKgI,KAAL,CAAWwB,uBAAhC,EAAyD,aAAa,KAAKxB,KAAL,CAAWyB,cAAjF,GADF;AAEE,iEAAc,SAAS,KAAKzB,KAAL,CAAW8C,kBAAlC,EAAsD,YAAY,KAAK9C,KAAL,CAAW+C,UAA7E,GAFF;AAGE;AAHF,OADF;AAOD;;;;;;kBA5JkB1B,I;;;;;;;;;;;;;;;ACdrB;;;;;;;;;;;;IAEqB2B,Q;;;AACnB,oBAAYpD,KAAZ,EAAmB;AAAA;;AAAA,+GACXA,KADW;AAElB;;;;6BAEQ;AACP,aACE;AAAA;AAAA,UAAK,OAAO,EAACqD,OAAM,OAAP,EAAgBC,cAAa,MAA7B,EAAZ;AACE;AAAA;AAAA;AAAA;AAAoB,eAAKtD,KAAL,CAAWuD,SAA/B;AAAA;AAAA,SADF;AAEE;AAAA;AAAA;AACG,eAAKvD,KAAL,CAAW7E,WAAX,CAAuBiB,GAAvB,CAA2B,UAAST,UAAT,EAAoB;AAC9C,mBAAO;AAAA;AAAA,gBAAI,KAAKA,WAAWnF,IAAX,CAAgBmG,IAAzB;AAAgChB,yBAAWnF,IAAX,CAAgBmG;AAAhD,aAAP;AACD,WAFA;AADH;AAFF,OADF;AAUD;;;;;;kBAhBkByG,Q;;;;;;;;;;;;;;;ACFrB;;;;AACA;;;;;;;;;;;;IAEqBI,a;;;AAEnB,yBAAYxD,KAAZ,EAAkB;AAAA;;AAAA,8HACVA,KADU;;AAEhB,UAAKI,KAAL,GAAa;AACXqD,uBAAiB,EADN;AAEXC,sBAAgB;AAFL,KAAb;;AAKA,UAAKC,gBAAL,GAAwB,MAAKA,gBAAL,CAAsBC,IAAtB,OAAxB;AACA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBD,IAArB,OAAvB;AACA,UAAKE,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBF,IAAvB,OAAzB;AATgB;AAUjB;;;;wCAEmB;AAClB,WAAKpD,QAAL,CAAc,EAACkD,gBAAgB,KAAKG,eAAL,CAAqB,KAAKzD,KAAL,CAAWqD,eAAhC,CAAjB,EAAd;AACA1G,YAAM,uCAAN;AACD;;;wCAEmB,CAEnB;;;qCAEgBL,K,EAAO;AACtB,WAAK8D,QAAL,CAAc,EAACiD,iBAAiB/G,MAAM+D,MAAN,CAAaC,KAA/B,EAAd;AACD;;;oCAEe/D,I,EAAK;AACnB,aAAOA,KAAKoH,OAAL,CAAa,MAAb,EAAqB,GAArB,EAA0BC,WAA1B,EAAP;AACD;;;6BAGQ;AACL,aACE;AAAA;AAAA;AACE;AAAA;AAAA;AACE;AAAA;AAAA;AAAA;AAAA,WADF;AAEE;AAAA;AAAA;AAAA;AACwB,qDADxB;AAEE,qDAAO,MAAK,MAAZ,EAAmB,IAAG,cAAtB,EAAqC,UAAU,KAAKL,gBAApD,GAFF;AAAA;AAEqF;AAAA;AAAA,gBAAG,MAAK,GAAR;AAAA;AAAA;AAFrF,WAFF;AAME;AAAA;AAAA;AAAA;AACyB,qDADzB;AAEE,wDAAU,IAAG,qBAAb,EAAmC,MAAK,GAAxC,EAA4C,MAAK,IAAjD;AAFF,WANF;AAUE;AAAA;AAAA;AACE,qDAAO,MAAK,QAAZ,EAAqB,OAAM,kBAA3B,EAA8C,SAAS,KAAKG,iBAA5D;AADF;AAVF,SADF;AAgBE,gEAAa,aAAa,KAAK1D,KAAL,CAAWsD,cAArC;AAhBF,OADF;AAoBH;;;;;;kBArDkBF,a;;;;;;;;;;;;;;;ACHrB;;;;;;;;;;;;IAEqBS,W;;;AAEnB,uBAAYjE,KAAZ,EAAkB;AAAA;;AAAA,0HACVA,KADU;;AAEhB,UAAKI,KAAL,GAAa;AACXqD,uBAAiB,oBADN;AAEXC,sBAAgB;AAFL,KAAb;;AAKA,UAAKQ,aAAL,GAAqB,MAAKA,aAAL,CAAmBN,IAAnB,OAArB;AAPgB;AAQjB;;;;8CAEyBO,S,EAAW;AACnC,WAAK3D,QAAL,CAAc,EAAEkD,gBAAgBS,UAAUC,WAA5B,EAAd;AACD;;;oCAEe;AACd7B,aAAO8B,IAAP,CAAY,KAAKjE,KAAL,CAAWsD,cAAvB,EAAuC,QAAvC;AACD;;AAED;;;;6BAES;AACL,aACE;AAAA;AAAA;AACE;AAAA;AAAA;AAAA;AAAA,SADF;AAEE;AAAA;AAAA;AAAG;AAAA;AAAA,cAAM,OAAO,EAAEY,YAAY,MAAd,EAAsBC,iBAAiB,MAAvC,EAA+C5D,SAAS,KAAxD,EAAb;AAAA;AAA8F,iBAAKP,KAAL,CAAWsD;AAAzG,WAAH;AAAA;AAAmI;AAAA;AAAA,cAAG,MAAK,GAAR;AAAA;AAAA;AAAnI,SAFF;AAII;AAAA;AAAA;AAAG,mDAAO,MAAK,QAAZ,EAAqB,OAAM,qBAA3B,EAAiD,SAAS,KAAKQ,aAA/D;AAAH;AAJJ,OADF;AASH;;;;;;kBAhCkBD,W;;;;;;;;;;;;;;;ACFrB;;;;;;;;;;;;IAEqBO,Y;;;AACnB,wBAAYxE,KAAZ,EAAmB;AAAA;;AAAA,uHACXA,KADW;AAElB;;;;6BAEQ;AACP,aACE;AAAA;AAAA,UAAK,OAAO,EAAEuE,iBAAiB,MAAnB,EAAZ;AACG,aAAKvE,KAAL,CAAWyE,OADd;AAAA;AACwB,aAAKzE,KAAL,CAAWyE,OAAX,KAAuBC,SAAvB,GAAmC,EAAnC,GAAyC;AAAA;AAAA,YAAG,MAAM,KAAK1E,KAAL,CAAWmD,UAApB,EAAgC,QAAO,QAAvC;AAAA;AAAA;AADjE,OADF;AAKD;;;;;;kBAXkBqB,Y;;;;;;;;;;;;;;;ACFrB;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;AACA,mBAAA3N,CAAQ,EAAR,EAAuB8N,QAAvB;AACA,mBAAA9N,CAAQ,CAAR;;WAEyE,E;IAAnEuK,S,QAAAA,S;IAAWC,W,QAAAA,W;IAAaC,S,QAAAA,S;IAAWC,Y,QAAAA,Y;IAAc5G,a,QAAAA,a;;;AAEvD,IAAI5D,UAAJ,EAAgB;AAAA,iBAC0D,mBAAAF,CAAQ,EAAR,CAD1D;AAAA,MACTuK,SADS,YACTA,SADS;AAAA,MACEC,WADF,YACEA,WADF;AAAA,MACeC,SADf,YACeA,SADf;AAAA,MAC0BC,YAD1B,YAC0BA,YAD1B;AAAA,MACwC5G,aADxC,YACwCA,aADxC;;AAEf,MAAM6G,KAAK,mBAAA3K,CAAQ,EAAR,CAAX;AACA0L,SAAOnC,KAAP;AACA;;IAEKwE,I;;;AAEJ,gBAAY5E,KAAZ,EAAmB;AAAA;;AAAA,4GACXA,KADW;;AAAA,UA0FnBoC,cA1FmB,GA0FF,YAAM;AACvBrF,+BAAuB,MAAKiD,KAAL,CAAWe,KAAX,CAAiBjI,MAAjB,CAAwBqB,IAA/C,EACEkD,IADF,CACO;AAAA,eAAOnD,IAAI9B,IAAJ,EAAP;AAAA,OADP,EAEEiF,IAFF,CAEO,gBAAQ;AACb,wBAAMhH,OAAN,GAAgB+B,IAAhB;AACG,OAJL;AAKC,KAhGkB;;AAAA,UAyGnByM,eAzGmB,GAyGD,YAAM;AACtBrM,cAAQC,GAAR,CAAY,uBAAZ;AACD,KA3GkB;;AAAA,UA6GnBqM,cA7GmB,GA6GF,UAAC5E,CAAD,EAAO;AACtBnD,+BAAuB,MAAKiD,KAAL,CAAWe,KAAX,CAAiBjI,MAAjB,CAAwBqB,IAA/C,qBAAmE,MAAK6H,aAAL,CAAmB3L,OAAnB,CAA2BsF,UAA3B,CAAsCT,EAAzG;AACD,KA/GkB;;AAAA,UAiHnB6J,eAjHmB,GAiHD,UAAC7E,CAAD,EAAO;AACvB1H,cAAQC,GAAR,CAAY,QAAZ,EAAsByH,EAAEO,MAAF,CAASC,KAA/B;AACA3D,+BAAuB,MAAKiD,KAAL,CAAWe,KAAX,CAAiBjI,MAAjB,CAAwBqB,IAA/C,eAA+D;AAC7Dc,cAAMkC,KAAKC,SAAL,CAAe,EAACd,SAAS4D,EAAEO,MAAF,CAASC,KAAnB,EAAf,CADuD,EACZ;AACjDsE,eAAO,UAFsD,EAE1C;AACnB3E,qBAAa,aAHgD,EAGjC;AAC5BrD,iBAAS;AACP,wBAAc,yBADP;AAEP,0BAAgB;AAFT,SAJoD;AAQ7DC,gBAAQ,KARqD,EAQ9C;AACfC,cAAM,MATuD,EAS/C;AACdJ,kBAAU,QAVmD,EAUzC;AACpBuF,kBAAU,aAXmD,CAWpC;AAXoC,OAA/D;AAaD,KAhIkB;;AAAA,UAkInB4C,cAlImB,GAkIF,UAAC/E,CAAD,EAAO;AACtBnD,+BAAuB,MAAKiD,KAAL,CAAWe,KAAX,CAAiBjI,MAAjB,CAAwBqB,IAA/C,aAA6D;AAC3D6K,eAAO,UADoD;AAE3D3E,qBAAa,aAF8C;AAG3DrD,iBAAS;AACP,wBAAc,yBADP;AAEP,0BAAgB;AAFT,SAHkD;AAO3DC,gBAAQ,MAPmD;AAQ3DC,cAAM;AARqD,OAA7D;AAUD,KA7IkB;;AAAA,UA+InBgI,gBA/ImB,GA+IA,UAAChF,CAAD,EAAO;AACxB,YAAKM,QAAL,CAAc;AACZ2E,yBAAiBjF,EAAEO,MAAF,CAAS2E;AADd,OAAd;AAGA,YAAKC,QAAL,CAAcC,mBAAd,CAAkC,YAAlC,EAAgD,MAAKC,YAArD;AACA,YAAKF,QAAL,CAAcG,gBAAd,CAA+B,YAA/B,EAA6C,MAAKD,YAAlD;AACD,KArJkB;;AAAA,UAuJnBA,YAvJmB,GAuJJ,UAACrF,CAAD,EAAO;AACpB,YAAKM,QAAL,CAAc;AACZiF,wBAAiBvF,EAAEO,MAAF,CAASiF,WAAT,GAAuBxF,EAAEO,MAAF,CAAS2E,QAAjC,GAA6C,GADjD;AAEZO,0BAAkBzF,EAAEO,MAAF,CAASiF;AAFf,OAAd;AAID,KA5JkB;;AAAA,UA8JnBE,MA9JmB,GA8JV,UAAC1F,CAAD,EAAO;AACdA,QAAEC,cAAF;AACApD,+BAAuB,MAAKiD,KAAL,CAAWe,KAAX,CAAiBjI,MAAjB,CAAwBqB,IAA/C,YAA4D;AAC1D6K,eAAO,UADmD;AAE1D/J,cAAMkC,KAAKC,SAAL,CAAe,EAACpC,cAAc,MAAKoF,KAAL,CAAW/J,OAAX,CAAmBsF,UAAnB,CAA8BT,EAA7C,EAAf,CAFoD;AAG1DmF,qBAAa,aAH6C;AAI1DrD,iBAAS;AACP,wBAAc,yBADP;AAEP,0BAAgB;AAFT,SAJiD;AAQ1DC,gBAAQ,MARkD;AAS1DC,cAAM;AAToD,OAA5D,EAWGG,IAXH,CAWQ;AAAA,eAAOnD,IAAI9B,IAAJ,EAAP;AAAA,OAXR,EAYGiF,IAZH,CAYQ;AAAA,eAAQ,gBAAMhH,OAAN,GAAgB+B,IAAxB;AAAA,OAZR;AAaD,KA7KkB;;AAEjB,UAAKgI,KAAL,GAAa;AACXsB,eAAS,EADE;AAEXC,mBAAa,EAFF;AAGXtL,eAAS,IAHE;AAIXwP,mBAAa,SAJF;AAKXJ,sBAAgB,CALL;AAMXE,wBAAkB,CANP;AAOXR,uBAAiB;AAPN,KAAb;AASA,UAAKrD,SAAL,GAAiB,EAAjB;AACA,UAAKuD,QAAL,GAAgB,EAAhB;AAZiB;AAalB;;;;wCAEkB;AAAA;;AACjB,WAAKA,QAAL,CAAcG,gBAAd,CAA+B,OAA/B,EAAwC,UAAC9I,KAAD,EAAW;AACjD,eAAKoF,SAAL,CAAe1B,KAAf,CAAqB0B,SAArB,CAA+BgE,YAA/B,CAA4C,IAA5C;AACA,eAAKtF,QAAL,CAAc;AACZqF,uBAAa;AADD,SAAd;AAGD,OALD;;AAOF9I,+BAAuB,KAAKiD,KAAL,CAAWe,KAAX,CAAiBjI,MAAjB,CAAwBqB,IAA/C,EACEkD,IADF,CACO;AAAA,eAAOnD,IAAI9B,IAAJ,EAAP;AAAA,OADP,EAEEiF,IAFF,CAEO,gBAAQ;AACb,wBAAMhH,OAAN,GAAgB+B,IAAhB;AACI,eAAK4J,aAAL,GAAqBrH,cAAc;AACjCsH,kBAAQ,gBAAMzC,UADmB;AAEjC5F,qBAAW,gBAAMvD,OAAN,CAAcuD,SAFQ;AAGjCG,iBAAO,gBAAM1D,OAAN,CAAc0D,KAHY;AAIjCmI,qBAAW,qBAAM;AACf1J,oBAAQC,GAAR,CAAY,kCAAZ,EAAgD,OAAKuJ,aAAL,CAAmB3L,OAAnB,CAA2BsF,UAA3E;AACAwG,uBAAW,OAAKC,cAAhB,EAAgC,IAAhC;AACD,WAPgC;AAQjCE,4BAAkB,mCAAW;AAC3B9J,oBAAQC,GAAR,CAAY,6BAAZ,EAA2CiJ,OAA3C;AACA,mBAAKlB,QAAL,CAAc,EAAEkB,gBAAF,EAAd;AACD;AAXgC,SAAd,CAArB;AAaA,eAAKM,aAAL,CAAmB3L,OAAnB,CAA2BoM,EAA3B,CAA8B,qBAA9B,EAAqD,UAAC/F,KAAD,EAAW;AAC9DlE,kBAAQC,GAAR,CAAY,WAAZ,EAAyBiE,KAAzB;AACA,cAAMhB,OAAO;AACX9B,uBAAW,OAAKoI,aAAL,CAAmB3L,OAAnB,CAA2BuD,SAD3B;AAEX+B,wBAAY;AACVT,kBAAIwB,MAAMf,UAAN,CAAiBT;AADX,aAFD;AAKXwB,mBAAO;AALI,WAAb;AAOA,iBAAK0F,cAAL;AACD,SAVD;AAWA,eAAKJ,aAAL,CAAmB3L,OAAnB,CAA2BoM,EAA3B,CAA8B,mBAA9B,EAAmD,UAAC/F,KAAD,EAAW;AAC5DlE,kBAAQC,GAAR,CAAY,SAAZ,EAAuBiE,KAAvB;AACA,cAAMhB,OAAO;AACX9B,uBAAW,OAAKoI,aAAL,CAAmB3L,OAAnB,CAA2BuD,SAD3B;AAEX+B,wBAAY;AACVT,kBAAIwB,MAAMf,UAAN,CAAiBT;AADX,aAFD;AAKXwB,mBAAO;AALI,WAAb;AAOA,iBAAK0F,cAAL;AACD,SAVD;AAWA,eAAKJ,aAAL,CAAmB3L,OAAnB,CAA2BoM,EAA3B,CAA8B,QAA9B,EAAwC,UAAC/F,KAAD,EAAW;AACjDlE,kBAAQC,GAAR,CAAY,8BAAZ,EAA4CiE,KAA5C;AACA,iBAAK0F,cAAL;AACA,cAAI1F,MAAMjB,IAAN,KAAe,qBAAnB,EAA0C;AACxC,mBAAKqG,SAAL,CAAe1B,KAAf,CAAqB0B,SAArB,CAA+BgE,YAA/B,CAA4C,KAA5C;AACA,mBAAKT,QAAL,CAAcU,IAAd;AACA,mBAAKvF,QAAL,CAAc;AACZqF,2BAAa;AADD,aAAd;AAGD;AACF,SAVD;AAWA,eAAKrF,QAAL,CAAc;AACZnK,mBAAS,OAAK2L,aAAL,CAAmB3L;AADhB,SAAd;AAGJ,OArDF;AAsDE0G,YAAM,eAAN,EACGM,IADH,CACQ;AAAA,eAAOnD,IAAI9B,IAAJ,EAAP;AAAA,OADR,EAEGiF,IAFH,CAEQ,gBAAQ;AACZ,wBAAM/G,QAAN,GAAiB8B,IAAjB;AACD,OAJH;AAKF;;;2CAEuB;AACrB,UAAI,KAAK4J,aAAT,EAAwB;AACtB,aAAKA,aAAL,CAAmBgE,UAAnB;AACD;AACF;;;6BAuFO;AAAA;;AACN,UAAMC,qBAAqB,KAAK7F,KAAL,CAAW/J,OAAX,IAAsB,gBAAMA,OAA5B,IAAuC,gBAAMA,OAAN,CAAcqE,YAAd,CAA2BF,IAA3B,CAAgC;AAAA,eAAec,YAAYN,YAAZ,KAA6B,OAAKoF,KAAL,CAAW/J,OAAX,CAAmBsF,UAAnB,CAA8BT,EAA1E;AAAA,OAAhC,CAAlE;AACA,UAAIgL,+BAA+B,KAAnC;AACA,UAAID,kBAAJ,EAAwB;AACtBC,uCAA+B,gBAAM7P,OAAN,CAAcmG,KAAd,CAAoBJ,GAApB,CAAwB;AAAA,iBAAQ+J,KAAK3P,IAAb;AAAA,SAAxB,EAA2CqM,OAA3C,CAAmDoD,mBAAmBjL,YAAtE,IAAsF,CAAC,CAAtH;AACD;AACH,aACC;AAAA;AAAA,UAAK,WAAU,mBAAf;AACC;AAAA;AAAA,YAAG,OAAO,EAACoL,SAAS,MAAV,EAAV;AAA8BjJ,eAAKC,SAAL,CAAe,gBAAM/G,OAArB,EAA8B,IAA9B,EAAoC,CAApC;AAA9B,SADD;AAEK;AAAA;AAAA,YAAO,OAAO,EAAC+P,SAAS,MAAV,EAAd,EAAiC,kBAAkB,KAAKlB,gBAAxD,EAA0E,KAAK,gBAAM7O,OAAN,IAAiB,gBAAMA,OAAN,CAAciG,OAA9G,EAAuH,UAAS,MAAhI,EAAuI,KAAK,uBAAY;AAAE,qBAAK+I,QAAL,GAAgBA,QAAhB;AAA0B,aAApL;AACC,oDAAQ,KAAK,gBAAMhP,OAAN,IAAiB,gBAAMA,OAAN,CAAciG,OAA5C,EAAqD,MAAK,YAA1D;AADD,SAFL;AAKE,aAAK8D,KAAL,CAAW/J,OAAX,IACK;AAAA;AAAA,YAAK,OAAO,EAACgQ,UAAU,UAAX,EAAZ;AACE;AAAA;AAAA,cAAQ,OAAO,EAACA,UAAU,UAAX,EAAuBC,KAAK,CAA5B,EAA+BC,OAAO,CAAtC,EAAf,EAAyD,WAAU,iCAAnE,EAAqG,UAAUL,4BAA/G,EAA6I,SAAS,KAAKN,MAA3J;AAAoKM,2CAA+B,6BAA/B,GAA+D;AAAnO,WADF;AAEE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,OAAf;AACE;AAAA;AAAA;AAAK,gCAAM7P,OAAN,CAAciG,OAAd,CAAsBkK,KAAtB,CAA4B,GAA5B,EAAiC,gBAAMnQ,OAAN,CAAciG,OAAd,CAAsBkK,KAAtB,CAA4B,GAA5B,EAAiCnN,MAAjC,GAA0C,CAA3E;AAAL,eADF;AAEI4M,oCAAsB,gBAAM5P,OAAN,CAAcqE,YAAd,CAA2BmI,OAA3B,CAAmCoD,kBAAnC,MAA2D,CAAjF,IACA;AAAA;AAAA;AACE;AAAA;AAAA,oBAAQ,WAAU,MAAlB,EAAyB,UAAU,KAAKlB,eAAxC,EAAyD,OAAO,gBAAM1O,OAAN,IAAiB,gBAAMA,OAAN,CAAciG,OAA/F;AACG,kCAAMhG,QAAN,CAAe8F,GAAf,CAAmB;AAAA,2BAClB;AAAA;AAAA,wBAAQ,OAAOE,OAAf;AAAyBA,8BAAQkK,KAAR,CAAc,GAAd,EAAmBlK,QAAQkK,KAAR,CAAc,GAAd,EAAmBnN,MAAnB,GAA2B,CAA9C;AAAzB,qBADkB;AAAA,mBAAnB;AADH,iBADF;AAMI,gCAAMhD,OAAN,CAAc+J,KAAd,KAAwB,SAAxB,IACA;AAAA;AAAA,oBAAK,WAAU,MAAf;AACE;AAAA;AAAA,sBAAQ,SAAS,KAAK6E,cAAtB,EAAsC,WAAU,iBAAhD;AAAA;AAAgF,yDAAG,WAAU,YAAb,EAA0B,YAAW,MAArC;AAAhF;AADF;AAPJ;AAHJ;AADF,WAFF;AAqBE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,OAAf;AACE,0DAAU,KAAI,KAAd,EAAoB,OAAO,KAAK7E,KAAL,CAAWqF,cAAtC,EAAsD,OAAO,EAAC7E,OAAO,MAAR,EAA7D,GADF;AAEE;AAAA;AAAA,kBAAG,OAAO,EAACwF,SAAS,MAAV,EAAV;AAA6B;AAAA;AAAA,oBAAQ,OAAO,EAACK,MAAM,CAAP,EAAf;AAAA;AAAA,iBAA7B;AAA+E;AAAA;AAAA;AAAO,uBAAKC;AAAZ;AAA/E;AAFF;AADF,WArBF;AA2BE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,mBAAf,EAAmC,KAAK;AAAA,yBAAa,OAAKC,SAAL,GAAiBA,SAA9B;AAAA,iBAAxC;AACG,mBAAKvG,KAAL,CAAWsB,OAAX,CAAmBrI,MAAnB,IAA6B,CAA7B,IACC;AAAA;AAAA;AAAA;AAAA,eAFJ;AAIE;AAAA;AAAA,kBAAK,WAAU,gBAAf,EAAgC,OAAO,EAAC+M,SAAS,MAAV,EAAkBQ,qBAAqB,gBAAvC,EAAyDC,SAAS,MAAlE,EAA0EC,aAAa,OAAvF,EAAvC;AACG,qBAAK1G,KAAL,CAAWsB,OAAX,CAAmBtF,GAAnB,CAAuB,kBAAU;AAChC,sBAAMd,cAAc,gBAAMjF,OAAN,CAAcqE,YAAd,CAA2BF,IAA3B,CAAgC;AAAA,2BAAec,YAAYN,YAAZ,KAA6B+L,OAAOpL,UAAP,CAAkBT,EAA9D;AAAA,mBAAhC,CAApB;AACA,yBACE;AAAA;AAAA,sBAAK,uBAAL;AACE;AAAA;AAAA,wBAAG,OAAO,EAAC8L,UAAU,MAAX,EAAV,EAA8B,WAAW1L,eAAeA,YAAYM,KAA3B,GAAmC,cAAnC,GAAoD,cAA7F;AAA8GN,qCAAeA,YAAYM,KAA3B,GAAmC,iBAAnC,GAAuD;AAArK,qBADF;AAEE,kDAAC,YAAD;AACE,2BAAKmL,OAAO7L,EADd;AAEE,+BAAS,OAAK8G,aAAL,CAAmB3L,OAF9B;AAGE,8BAAQ0Q;AAHV;AAFF,mBADF;AAUD,iBAZA;AADH,eAJF;AAmBE;AAAA;AAAA,kBAAK,OAAO,EAACV,UAAU,OAAX,EAAoBY,QAAQ,CAA5B,EAA+BV,OAAO,CAAtC,EAAZ;AACE,8CAAC,WAAD,IAAa,SAAS,KAAKvE,aAAL,CAAmB3L,OAAzC,EAAkD,QAAQ,KAAKwO,eAA/D,EAAgF,KAAK,wBAAa;AAAC,2BAAK/C,SAAL,GAAiBA,SAAjB;AAA2B,mBAA9H,GADF;AAEGmE,sCAAsBA,mBAAmBrK,KAAzC,IACC;AAAA;AAAA;AAAA;AAAA,iBAHJ;AAKG,iBAAC,CAACqK,kBAAD,IAAuB,CAACA,mBAAmBrK,KAA5C,KACC;AAAA;AAAA,oBAAG,WAAU,iBAAb,EAA+B,MAAK,GAApC,EAAwC,SAAS,KAAKkJ,cAAtD;AAAA;AAAA;AANJ;AAnBF;AADF;AA3BF;AANP,OADD;AAqEA;;;wBAxJoB;AAClB,UAAMoC,UAAU,KAAK9G,KAAL,CAAW+E,eAAX,GAA6B,KAAK/E,KAAL,CAAWuF,gBAAxD;AACA,UAAMwB,UAAUC,KAAKC,KAAL,CAAWH,UAAU,EAArB,CAAhB;AACA,UAAMI,mBAAmB,CAACJ,UAAU,EAAX,EAAeK,OAAf,CAAuB,CAAvB,CAAzB;AACA,aAAOJ,UAAU,GAAV,IAAiBG,mBAAmB,EAAnB,GAAwB,GAAxB,GAA8B,EAA/C,IAAqDA,gBAA5D;AACD;;;;;;kBAsJY,0BAAK1C,IAAL,C;;;;;;AChRf,iC;;;;;;ACAA,8C;;;;;;ACAA,wC;;;;;;ACAA,4C;;;;;;ACAA,0C","file":"./server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 41e2055cd011ef4586c6","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 0\n// module chunks = 0","import { store } from 'react-easy-state'\n\nexport default store({\n  session: null,\n  journeys: [],\n  loggedIn: false,\n  user: null,\n  location: '/',\n  ...(global.__INITIAL_STATE__ || {})\n});\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/state.js","module.exports = require(\"react-easy-state\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-easy-state\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"prop-types\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prop-types\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"opentok-react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok-react\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"@opentok/client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@opentok/client\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"babel-polyfill/lib/index\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill/lib/index\"\n// module id = 13\n// module chunks = 0","const dotenv = require('dotenv');\n\ndotenv.config();\nglobal.__CLIENT__ = false;\nglobal.__SERVER__ = true;\n\nconst routes = require('./routes');\n\nexports = routes;\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","import path from 'path';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport api from './api';\nimport ssr from './ssr';\n\nimport session from 'express-session';\nimport createMongoStore from 'connect-mongo';\n\nconst app = express();\n\napp.use(session({\n    secret: 'qVaNxeu5VVEAtkyFJ/62EKcp7Lw=',\n    saveUninitialized: false, // don't create session until something stored\n\t  resave: false, //don't save session if unmodified\n    store: new (createMongoStore(session))({url: process.env.MONGODB_URI || process.env.MONGO_URL}),\n    cookie: {expires: new Date(253402300000000)}\n}));\n\napp.set('view engine', 'ejs');\napp.set('views', path.join(__dirname, '../views'));\napp.use(bodyParser.json());\n\napp.use(express.static(path.join(__dirname, '..', 'public')));\n\napp.use('/api', api);\napp.use('/*', ssr);\n\napp.listen(process.env.PORT || 5000, () => {\n  console.log('Hello World listening on port 5000!');\n});\n\n\n\n// WEBPACK FOOTER //\n// ./routes/index.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 16\n// module chunks = 0","import fs from 'fs';\nimport path from 'path';\nimport express from 'express';\nimport OpenTok from 'opentok';\nimport mongoose from 'mongoose';\nimport JourneySpace from '../models/journey_space';\nimport JourneyParticipant from '../models/journey_participant';\nimport dotenv from 'dotenv';\nrequire('isomorphic-fetch');\n\ndotenv.config();\n\nmongoose.connect(process.env.MONGODB_URI || process.env.MONGO_URL);\n\nfunction promisify(fn) {\n  /**\n   * @param {...Any} params The params to pass into *fn*\n   * @return {Promise<Any|Any[]>}\n   */\n  return function promisified(...params) {\n    return new Promise((resolve, reject) => fn(...params.concat([(err, ...args) => err ? reject(err) : resolve( args.length < 2 ? args[0] : args )])))\n  }\n}\n\nconst opentok = new OpenTok(process.env.OPENTOK_KEY, process.env.OPENTOK_SECRET);\nconst router = express.Router();\n\nfunction generateToken(sessionId) {\n\tlet tokenOptions = {};\n\ttokenOptions.role = \"publisher\";\n\t// Generate a token.\n\tconst token = opentok.generateToken(sessionId, tokenOptions);\n  console.log('return token', token);\n\treturn token;\n}\n\n// TODO: switch to POST, just using GET for easier testing\nrouter.get('/sessions/:room', async (req, res) => {\n\tconst {room} = req.params;\n\tconst existingSession = await JourneySpace.findOne({room}).lean().exec();\n\tif (existingSession) {\n    const participants = await JourneyParticipant.find({session: existingSession, present: true}).lean().exec();\n    existingSession.participants = participants;\n\t\tres.json({\n\t\t\t...existingSession,\n\t\t\ttoken: generateToken(existingSession.sessionId),\n\t\t});\n\t} else {\n\t\topentok.createSession(async (err, session) => {\n\t\t  if (err) throw err;\n\t\t\t// save the sessionId\n\t\t\tconst newSession = new JourneySpace({room, sessionId: session.sessionId});\n\t\t\tawait newSession.save();\n\t\t\tres.json({\n\t\t\t\t...newSession.toJSON(),\n\t\t\t\ttoken: generateToken(session.sessionId),\n\t\t\t});\n\t\t});\n\t}\n});\n\nrouter.post('/sessions/:room/joined', async (req, res) => {\n\tconst {room} = req.params;\n  const {id: connectionId} = req.body;\n  req.session.connections = req.session.connections || {};\n  req.session.connections[room] = connectionId;\n\tconst existingSession = await JourneySpace.findOne({room}).lean().exec();\n\tif (existingSession) {\n      const participantExists = (await JourneyParticipant.count({session: existingSession, connectionId})) > 0;\n      if (!participantExists) {\n        const participant = new JourneyParticipant({session: existingSession, connectionId: connectionId, user: req.session.user});\n        await participant.save();\n      }\n  }\n  res.sendStatus(200);\n});\n\nrouter.get('/sessions/:room/:connectionId', async (req, res) => {\n  const {room, connectionId} = req.params;\n\tconst existingSession = await JourneySpace.findOne({room}).lean().exec();\n\tif (existingSession) {\n    const participant = await JourneyParticipant.findOne({session: existingSession, connectionId}).exec();\n    res.json(participant);\n    return;\n  }\n  res.sendStatus(500);\n});\n\n// TEMP: Use get for convenience. hardcode temp-home-location for the room\n// Trigger a general announcement to everyone\nrouter.get('/sessions/test/temp-home-location', async (req, res) => {\n  // const {room, connection} = req.params;\n  const existingSession = await JourneySpace.findOne({room:'temp-home-location'}).exec();\n  if (existingSession) {\n  console.log(\"**** SENDING SIGNAL\")\n  signal(existingSession.sessionId, {type: 'displayJourneyRequest', data: 'Rob has started a session. Join him (link)'});\n  return res.sendStatus(200);\n  }\n  res.sendStatus(200);\n});\n\nrouter.get('/sessions/:room/connections/:connection/ready', async (req, res) => {\n  const {room, connection} = req.params;\n  const existingSession = await JourneySpace.findOne({room}).exec();\n\tif (existingSession) {\n    const participant = await JourneyParticipant.findOne({session: existingSession, connectionId: connection});\n    participant.ready = true;\n    await participant.save();\n    signal(existingSession.sessionId, {type: 'ready', data: 'foo'});\n    const allReady = (await JourneyParticipant.count({session: existingSession, ready: false, present: true})) === 0;\n    if (allReady) {\n      // signal(existingSession.sessionId, {type: 'startJourney', data: 'foo'});\n    }\n    return res.sendStatus(200);\n  }\n  res.sendStatus(200);\n});\n\nrouter.get('/journeys', async (req, res) => {\n  const readdirAsync = promisify(fs.readdir)\n  const journeyFiles = (await readdirAsync(path.join(__dirname, '..', 'public/journeys'))).filter(file => {\n    return path.extname(file) === '.mp3';\n  }).map(file => {\n    return `/journeys/${file}`\n  });\n  res.json(journeyFiles);\n});\n\nrouter.put('/sessions/:room/journey', async (req, res) => {\n  console.log('UPDATE JOURNEY');\n  const {journey} = req.body;\n  const {room} = req.params;\n  const existingSession = await JourneySpace.findOne({room}).exec();\n\tif (existingSession) {\n    existingSession.journey = journey;\n    await existingSession.save();\n    signal(existingSession.sessionId, {type: 'updatedJourney', data: journey});\n  }\n  res.sendStatus(200);\n});\n\n// TODO: this should really verify that the user hitting this endpoint is authorized to do so (e.g. that they are the journey's host)\nrouter.post('/sessions/:room/start', async (req, res) => {\n  const {room} = req.params;\n  const existingSession = await JourneySpace.findOne({room}).exec();\n\tif (existingSession) {\n    await existingSession.start();\n    signal(existingSession.sessionId, {type: 'startJourney', data: ''});\n  }\n});\n\nrouter.post('/sessions/:room/flag', async (req, res) => {\n  const {room} = req.params;\n  const {connectionId} = req.body;\n  const existingSession = await JourneySpace.findOne({room}).exec();\n\tif (existingSession) {\n    existingSession.flags.push({user: connectionId});\n    await existingSession.save();\n    const participants = await JourneyParticipant.find({session: existingSession, present: true}).lean().exec();\n    return res.json({...existingSession.toJSON(), participants});\n  }\n  res.sendStatus(404);\n});\n\nrouter.post('/event', async (req, res) => {\n  console.log('GOT EVENT', req.body);\n  res.sendStatus(200);\n  const {sessionId, connection} = req.body;\n  const session = await JourneySpace.findOne({sessionId}).exec();\n\n  console.log(\"*******\" + req.body)\n\n  switch(req.body.event) {\n    case 'connectionCreated':\n      if (session) {\n        const participantExists = (await JourneyParticipant.count({session, connectionId: connection.id})) > 0;\n        if (!participantExists) {\n          const participant = new JourneyParticipant({session, connectionId: connection.id});\n          await participant.save();\n        }\n      }\n      break;\n    case 'connectionDestroyed':\n      if (session) {\n        const participant= await JourneyParticipant.findOne({session, connectionId: connection.id});\n        if (participant) {\n          participant.present = false;\n          await participant.save();\n        }\n      }\n      break\n  }\n});\n\nrouter.post('/login', (req, res) => {\n  req.session.loggedIn = true;\n  req.session.user = {\n    name: req.body.name\n  };\n  res.json({loggedIn: true, user: {name: req.body.name}});\n});\n\nrouter.get('/logout', (req, res) => {\n  req.session.destroy(() => {\n      res\n        .clearCookie('connect.sid')\n        .redirect('/login')\n    });\n});\n\nfunction signal(sessionId, data) {\n  fetch(`https://api.opentok.com/v2/project/${process.env.OPENTOK_KEY}/session/${sessionId}/signal`, {\n    headers: {\n      'X-TB-PARTNER-AUTH': `${process.env.OPENTOK_KEY}:${process.env.OPENTOK_SECRET}`\n    },\n    method: 'POST',\n    mode: 'cors',\n    body: JSON.stringify(data)\n  }).then(response => console.log(response));\n}\n\nexport default router;\n\n\n\n\n// WEBPACK FOOTER //\n// ./routes/api.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"opentok\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok\"\n// module id = 19\n// module chunks = 0","import mongoose, {Schema} from 'mongoose';\nimport statemachine from 'another-mongoose-statemachine';\n\nconst FlagSchema = new Schema({\n  user: {type: String},\n  reason: {type: String},\n});\n\nconst JourneySpaceSchema = new Schema({\n  room: {type: String, index: true},\n  sessionId: {type: String, index: true},\n  journey: {type: String, default: '/journeys/Journey to A Spiderweb+Music.mp3'},\n  flags: {type: [FlagSchema], default: []},\n});\n\nJourneySpaceSchema.plugin(statemachine, {\n  states: {\n    created: {default: true},\n    started: {},\n    completed: {}\n  },\n  transitions: {\n    start: { from: 'created', to: 'started' },\n    end: { from: '*', to: 'completed' },\n  }\n});\n\nconst JourneySpace = mongoose.model('JourneySpace', JourneySpaceSchema);\n\nexport default JourneySpace;\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/journey_space.js","module.exports = require(\"another-mongoose-statemachine\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"another-mongoose-statemachine\"\n// module id = 21\n// module chunks = 0","import mongoose, {Schema} from 'mongoose';\n\nconst JourneyParticipantSchema = new Schema({\n  \"connectionId\": {type: String, index: true},\n  \"session\": {type: Schema.Types.ObjectId, ref: 'JourneySpace'},\n  \"ready\": {type: Boolean, default: false},\n  \"present\": {type: Boolean, default: true},\n  user: new Schema({name: String})\n});\n\nconst JourneyParticipant = mongoose.model('JourneyParticipant', JourneyParticipantSchema);\n\nexport default JourneyParticipant;\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/journey_participant.js","import express from 'express';\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport { createStore } from 'redux';\nimport { Provider } from 'react-redux';\nimport { StaticRouter } from 'react-router';\nimport App from '../../client/src/app';\nimport state from '../../client/src/state';\n\nconst router = express.Router();\n\nrouter.get('/', (req, res) => {\n  const context = {};\n\n  state.loggedIn = req.session.loggedIn;\n  state.user = req.session.user;\n  console.log('GOT SESSION', req.session, req.originalUrl);\n\n  const html = ReactDOMServer.renderToString(\n    <StaticRouter\n      location={req.originalUrl}\n      context={context}\n    >\n      <App />\n    </StaticRouter>\n  );\n\n  console.log('GOT HTML', html, context.url);\n  if (context.url) {\n    console.log('REDIRECT');\n    if (req.originalUrl != '/favicon.ico') {\n      res.writeHead(301, {\n        Location: context.url,\n      });\n    }\n    res.end();\n  } else {\n    res.status(200).render(process.env.NODE_ENV === 'production' ? 'index.ejs' : 'index.dev.ejs', {\n      html,\n      script: JSON.stringify({openTokKey: process.env.OPENTOK_KEY, loggedIn: req.session.loggedIn, user: req.session.user}),\n    });\n  }\n});\n\n\nexport default router;\n\n\n\n// WEBPACK FOOTER //\n// ./routes/ssr.js","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = 26\n// module chunks = 0","import React, {Component} from 'react';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport { withRouter } from 'react-router';\nimport { view } from 'react-easy-state';\nimport PropTypes from 'prop-types';\nimport Header from './components/header';\nimport Home from './components/home';\nimport Room from './components/Room';\nimport state from './state';\n\nconst RequireLoginRoute = ({component: Component, ...rest}) => {\n  return (\n    <Route {...rest} render={renderProps => {\n        return (\n          state.loggedIn ?\n            <Component {...renderProps} />\n          : <Redirect to={ {\n                pathname: '/login'\n            }} />\n        )\n    }}/>\n  )\n};\n\nclass Login extends Component {\n  static propTypes = {\n    match: PropTypes.object.isRequired,\n    location: PropTypes.object.isRequired,\n    history: PropTypes.object.isRequired\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: ''\n    }\n  }\n  \n  onChange(field) {\n    return (e) => {\n      this.setState({\n        [field]: e.target.value\n      });\n    }\n  }\n\n  login = (e) => {\n    e.preventDefault();\n    fetch(`/api/login`, {\n      body: JSON.stringify({name: this.state.name}), // must match 'Content-Type' header\n      method: 'POST', // *GET, POST, PUT, DELETE, etc.\n      credentials: 'same-origin',\n      headers: {\n        'content-type': 'application/json'\n      }\n    })\n    .then(response => response.json())\n    .then(json => {\n      state.loggedIn = json.loggedIn;\n      state.user = json.user;\n      this.props.history.push('/');\n    });\n  }\n\n  render() {\n    return (\n      <div style={{padding: '20px', width: '50%'}}>\n        <form onSubmit={this.login}>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\">Name</label>\n            <input type=\"text\" onChange={this.onChange('name')} value={this.state.name} className=\"form-control\" id=\"name\" aria-describedby=\"nameHelp\" placeholder=\"Enter name\"/>\n          </div>\n          <button type=\"submit\" className=\"btn btn-primary\">Submit</button>\n        </form>\n      </div>\n    )\n  }\n}\n\nclass App extends Component {\n  render() {\n    return (\n      <div>\n        <Header />\n        <Switch>\n          <Route exact path=\"/login\" component={withRouter(Login)} />\n          <RequireLoginRoute exact path=\"/\" component={Home} />\n          <RequireLoginRoute exact path=\"/:room\" component={Room} />\n        </Switch>\n      </div>\n    )\n  }\n}\n\nexport default withRouter(view(App));\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/app.js","module.exports = require(\"react-router-dom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router-dom\"\n// module id = 28\n// module chunks = 0","import React from 'react';\nimport { view } from 'react-easy-state';\nimport state from '../state';\n\nconst Header = () => (\n  <div className=\"header pl-4\">\n    <h1>Get started with Wacuri!</h1>\n    {state.loggedIn && state.user &&\n      <div>\n        <span className='mr-2 text-secondary'>logged in as {state.user.name}</span>\n        <a href='/api/logout'>Logout</a>\n      </div>\n    }\n  </div>\n);\n\nexport default view(Header);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/header.js","import React, { Component } from 'react';\nimport UserList from './user_list'\nimport GeneratorForm from './generator_form'\nimport EventMessage from './event_message'\nimport state from '../state'\n\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\nif (__CLIENT__) {\n  var { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n  const OT = require('@opentok/client');\n}\n\nexport default class Home extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      streams: [],\n      publisherId: '',\n      session: null,\n      totalConnectionsCreated: 0,\n      connectedUsers: []\n    }\n    this.publisher = {};\n  }\n\n  componentDidMount() {\n    const roomUrl = 'temp-home-location'\n\n    fetch(`/api/sessions/${roomUrl}`)\n      .then(res => res.json())\n      .then(json => {\n        state.session = json;\n        this.sessionHelper = createSession({\n          apiKey: state.openTokKey,\n          sessionId: state.session.sessionId,\n          token: state.session.token,\n          onConnect: () => {\n            console.log('assigned connection to publisher', this.sessionHelper.session.connection);\n            setTimeout(this.refreshSession, 1000);\n            fetch(`/api/sessions/${roomUrl}/joined`, {\n              body: JSON.stringify({id: this.sessionHelper.session.connection.id}),\n              credentials: 'same-origin', // include, same-origin, *omit\n              headers: {\n                'user-agent': 'Mozilla/4.0 MDN Example',\n                'content-type': 'application/json'\n              },\n              method: 'POST', // *GET, POST, PUT, DELETE, etc.\n              mode: 'cors', // no-cors, cors, *same-origin\n              redirect: 'follow', // manual, *follow, error\n              referrer: 'no-referrer', // *client, no-referrer\n            });\n          },\n          onStreamsUpdated: streams => {\n            console.log('Current subscriber streams:', streams);\n            this.setState({ streams });\n          }\n        });\n        window.sh = this.sessionHelper;\n        this.sessionHelper.session.on(\"connectionDestroyed\", (event) => {\n          console.log('DESTROYED', event);\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionDestroyed',\n\n          }\n\n          const updatedConnectionCount = this.state.totalConnectionsCreated - 1\n          this.setState({totalConnectionsCreated: updatedConnectionCount})\n\n          let newData = [...this.state.connectedUsers]\n          let index = newData.map(d => d.connectionId).indexOf(event.connection.id)\n          newData.splice(index, 1)\n          this.setState({connectedUsers: newData})\n\n          console.log('data is', data);\n          // fetch(`/api/event`, {\n          //   body: JSON.stringify(data), // must match 'Content-Type' header\n          //   cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n          //   credentials: 'same-origin', // include, same-origin, *omit\n          //   headers: {\n          //     'user-agent': 'Mozilla/4.0 MDN Example',\n          //     'content-type': 'application/json'\n          //   },\n          //   method: 'POST', // *GET, POST, PUT, DELETE, etc.\n          //   mode: 'cors', // no-cors, cors, *same-origin\n          //   redirect: 'follow', // manual, *follow, error\n          //   referrer: 'no-referrer', // *client, no-referrer\n          // });\n          // this.refreshSession();\n        });\n\n\n\n        this.sessionHelper.session.on(\"connectionCreated\", (event) => {\n          console.log('CREATED', event);\n          const updatedConnectionCount = this.state.totalConnectionsCreated + 1\n          this.setState({totalConnectionsCreated: updatedConnectionCount})\n          console.log('**** Total connections: ' + this.state.totalConnectionsCreated)\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionCreated',\n          }\n\n          let tries = 10;\n          const fetchRetry = () => {\n            fetch(`/api/sessions/${roomUrl}/${event.connection.id}`).then(res => res.json()).then(json => {\n              if (!json && tries-- > 0) {\n                setTimeout(fetchRetry, 500);\n              } else {\n                this.setState({\n                  connectedUsers: [...this.state.connectedUsers, json]\n                });\n              }\n            });\n          }\n          fetchRetry();\n        });\n\n\n\n        this.sessionHelper.session.on(\"signal\", (event) => {\n          console.log(\"Signal sent from connection \", event);\n          console.log(\"Signal type\", event.type);\n          // this.refreshSession(); // FIXME Error: home.js:110 Uncaught TypeError: _this2.refreshSession is not a function\n\n          if (event.type === 'signal:displayJourneyRequest') {\n            console.log(\"**** CAPTURED the journey request !! \")\n            this.setState({\n              displayMessageVisible: true,\n              displayMessageText: \"George has created a session 'Daily Jetsons Meditation'.\", //TEMP hard coded\n              sessionUrl: '/another-jetsons-url'\n            });\n          }\n        });\n\n        this.setState({\n          session: this.sessionHelper.session\n        });\n      });\n\n\n    fetch('/api/journeys')\n      .then(res => res.json())\n      .then(json => {\n        state.journeys = json;\n      });\n\n  }\n\n\n\n\n\n  render() {\n    return (\n      <div className=\"home\">\n        <UserList userCount={this.state.totalConnectionsCreated} connections={this.state.connectedUsers} />\n        <EventMessage message={this.state.displayMessageText} sessionUrl={this.state.sessionUrl} />\n        <GeneratorForm />\n      </div>\n      )\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/home.js","import React, {Component} from 'react'\n\nexport default class UserList extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div style={{float:'right', paddingRight:'50px'}}>\n        <h4>Current Users ({this.props.userCount})</h4>\n        <ul>\n          {this.props.connections.map(function(connection){\n            return <li key={connection.user.name}>{connection.user.name}</li>;\n          })}\n        </ul>\n      </div>\n    )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/user_list.js","import React, {Component} from 'react'\nimport SessionInfo from './session_info'\n\nexport default class GeneratorForm extends Component {\n\n  constructor(props){\n    super(props)\n    this.state = {\n      sessionLinkName: '',\n      sessionLinkUrl: ''\n    }\n\n    this.handleNameChange = this.handleNameChange.bind(this)\n    this.urlFriendlyName = this.urlFriendlyName.bind(this)\n    this.createSessionLink = this.createSessionLink.bind(this)\n  }\n\n  createSessionLink() {\n    this.setState({sessionLinkUrl: this.urlFriendlyName(this.state.sessionLinkName) })\n    fetch('/api/sessions/test/temp-home-location')\n  }\n\n  sendNotifications() {\n\n  }\n\n  handleNameChange(event) {\n    this.setState({sessionLinkName: event.target.value})\n  }\n\n  urlFriendlyName(name){\n    return name.replace(/\\s+/g, '-').toLowerCase()\n  }\n\n\n  render() {\n      return(\n        <div>\n          <form>\n            <h3>Enter Session Details</h3>\n            <p>\n              Give your room a name:<br/>\n              <input type=\"text\" id=\"session_link\" onChange={this.handleNameChange} /> &nbsp; or <a href='#'>Generate a name</a>\n            </p>\n            <p>\n              Description (optional):<br/>\n              <textarea id=\"session_description\" rows=\"2\" cols=\"25\"></textarea>\n            </p>\n            <p>\n              <input type=\"button\" value=\"Create a session\" onClick={this.createSessionLink} />\n\n            </p>\n          </form>\n          <SessionInfo sessionLink={this.state.sessionLinkUrl} />\n        </div>\n      )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/generator_form.js","import React, {Component} from 'react'\n\nexport default class SessionInfo extends Component {\n\n  constructor(props){\n    super(props)\n    this.state = {\n      sessionLinkName: 'Reasonable Default',\n      sessionLinkUrl: 'reasonable-default'\n    }\n\n    this.jumpToSession = this.jumpToSession.bind(this)\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.setState({ sessionLinkUrl: nextProps.sessionLink });\n  }\n\n  jumpToSession() {\n    window.open(this.state.sessionLinkUrl, \"_blank\")\n  }\n\n  // TODO: npm install --save react@^16.2.0 react-dom@^16.2.0 for getDerivedstateFromProps\n\n  render() {\n      return(\n        <div>\n          <h3>Session Created</h3>\n          <p><span style={{ fontWeight: 'bold', backgroundColor: '#ccc', padding: '7px' }}>www.wacuri.com/{this.state.sessionLinkUrl}</span> <a href=\"#\">Copy link to share</a></p>\n\n            <p><input type=\"button\" value=\"Jump to the session\" onClick={this.jumpToSession} /></p>\n\n        </div>\n      )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/session_info.js","import React, {Component} from 'react'\n\nexport default class EventMessage extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div style={{ backgroundColor: '#fc9' }}>\n        {this.props.message} {this.props.message === undefined ? \"\" : (<a href={this.props.sessionUrl} target='_blank'>Join Now</a>)}\n      </div>\n    )\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/event_message.js","import React, {Component} from 'react';\nimport { view } from 'react-easy-state'\nimport state from '../state';\nimport PropTypes from 'prop-types';\nimport uuid from 'uuid';\nimport {initLayoutContainer} from 'opentok-layout-js';\nrequire('es6-promise').polyfill();\nrequire('isomorphic-fetch');\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\nif (__CLIENT__) {\n\tvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n\tconst OT = require('@opentok/client');\n\twindow.state = state;\n}\n\nclass Room extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      streams: [],\n      publisherId: '',\n      session: null,\n      playerState: 'waiting',\n      playerProgress: 0,\n      playerProgressMS: 0,\n      journeyDuration: 0,\n    }\n    this.publisher = {};\n    this.audioTag = {};\n  }\n\n\tcomponentDidMount() {\n    this.audioTag.addEventListener('ended', (event) => {\n      this.publisher.state.publisher.publishAudio(true);\n      this.setState({\n        playerState: 'ended'\n      });\n    });\n\n\t\tfetch(`/api/sessions/${this.props.match.params.room}`)\n\t\t\t.then(res => res.json())\n\t\t\t.then(json => {\n\t\t\t\tstate.session = json;\n        this.sessionHelper = createSession({\n          apiKey: state.openTokKey,\n          sessionId: state.session.sessionId,\n          token: state.session.token,\n          onConnect: () => {\n            console.log('assigned connection to publisher', this.sessionHelper.session.connection);\n            setTimeout(this.refreshSession, 1000);\n          },\n          onStreamsUpdated: streams => {\n            console.log('Current subscriber streams:', streams);\n            this.setState({ streams });\n          }\n        });\n        this.sessionHelper.session.on(\"connectionDestroyed\", (event) => {\n          console.log('DESTROYED', event);\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionDestroyed',\n          }\n          this.refreshSession();\n        });\n        this.sessionHelper.session.on(\"connectionCreated\", (event) => {\n          console.log('CREATED', event);\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionCreated',\n          }\n          this.refreshSession();\n        });\n        this.sessionHelper.session.on(\"signal\", (event) => {\n          console.log(\"Signal sent from connection \", event);\n          this.refreshSession();\n          if (event.type === 'signal:startJourney') {\n            this.publisher.state.publisher.publishAudio(false);\n            this.audioTag.play();\n            this.setState({\n              playerState: 'playing'\n            });\n          }\n        });\n        this.setState({\n          session: this.sessionHelper.session\n        });\n\t\t\t});\n    fetch('/api/journeys')\n      .then(res => res.json())\n      .then(json => {\n        state.journeys = json;\n      });\n\t}\n\n  componentWillUnmount() {\n    if (this.sessionHelper) {\n      this.sessionHelper.disconnect();\n    }\n  }\n\n  refreshSession = () => {\n\t\tfetch(`/api/sessions/${this.props.match.params.room}`)\n\t\t\t.then(res => res.json())\n\t\t\t.then(json => {\n\t\t\t\tstate.session = json;\n      });\n  }\n\n  get timeRemaining() {\n    const seconds = this.state.journeyDuration - this.state.playerProgressMS;\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = (seconds % 60).toFixed(0);\n    return minutes + \":\" + (remainingSeconds < 10 ? '0' : '') + remainingSeconds;\n  }\n\n  onInitPublisher = () => {\n    console.log('initialized publisher');\n  }\n\n  onConfirmReady = (e) => {\n    fetch(`/api/sessions/${this.props.match.params.room}/connections/${this.sessionHelper.session.connection.id}/ready`);\n  }\n\n  onChangeJourney = (e) => {\n    console.log('CHANGE', e.target.value);\n    fetch(`/api/sessions/${this.props.match.params.room}/journey`, {\n      body: JSON.stringify({journey: e.target.value}), // must match 'Content-Type' header\n      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n      credentials: 'same-origin', // include, same-origin, *omit\n      headers: {\n        'user-agent': 'Mozilla/4.0 MDN Example',\n        'content-type': 'application/json'\n      },\n      method: 'PUT', // *GET, POST, PUT, DELETE, etc.\n      mode: 'cors', // no-cors, cors, *same-origin\n      redirect: 'follow', // manual, *follow, error\n      referrer: 'no-referrer', // *client, no-referrer\n    });\n  }\n\n  onStartSession = (e) => {\n    fetch(`/api/sessions/${this.props.match.params.room}/start`, {\n      cache: 'no-cache',\n      credentials: 'same-origin',\n      headers: {\n        'user-agent': 'Mozilla/4.0 MDN Example',\n        'content-type': 'application/json'\n      },\n      method: 'POST',\n      mode: 'cors',\n    });\n  }\n\n  onLoadedMetadata = (e) => {\n    this.setState({\n      journeyDuration: e.target.duration\n    });\n    this.audioTag.removeEventListener('timeupdate', this.onTimeUpdate);\n    this.audioTag.addEventListener('timeupdate', this.onTimeUpdate);\n  }\n\n  onTimeUpdate = (e) => {\n    this.setState({\n      playerProgress: (e.target.currentTime / e.target.duration) * 100,\n      playerProgressMS: e.target.currentTime,\n    });\n  }\n\n  onFlag = (e) => {\n    e.preventDefault();\n    fetch(`/api/sessions/${this.props.match.params.room}/flag`, {\n      cache: 'no-cache',\n      body: JSON.stringify({connectionId: this.state.session.connection.id}),\n      credentials: 'same-origin',\n      headers: {\n        'user-agent': 'Mozilla/4.0 MDN Example',\n        'content-type': 'application/json'\n      },\n      method: 'POST',\n      mode: 'cors',\n    })\n      .then(res => res.json())\n      .then(json => state.session = json);\n  }\n\n\trender() {\n    const currentParticipant = this.state.session && state.session && state.session.participants.find(participant => participant.connectionId === this.state.session.connection.id);\n    let currentUserHasFlaggedJourney = false;\n    if (currentParticipant) {\n      currentUserHasFlaggedJourney = state.session.flags.map(flag => flag.user).indexOf(currentParticipant.connectionId) > -1;\n    }\n\t\treturn (\n\t\t\t<div className='journey-container'>\n\t\t\t\t<p style={{display: 'none'}}>{JSON.stringify(state.session, null, 2)}</p>\n        <audio style={{display: 'none'}} onLoadedMetadata={this.onLoadedMetadata} key={state.session && state.session.journey} controls=\"true\" ref={audioTag => { this.audioTag = audioTag }}>\n         <source src={state.session && state.session.journey} type=\"audio/mpeg\"/>\n        </audio>\n\t\t\t\t{this.state.session &&\n          <div style={{position: 'relative'}}>\n            <button style={{position: 'absolute', top: 0, right: 0}} className='btn btn-danger btn-flag-session' disabled={currentUserHasFlaggedJourney} onClick={this.onFlag}>{currentUserHasFlaggedJourney ? \"You've flagged this journey\" : \"Flag this journey\"}</button>\n            <div className='row'>\n              <div className='col-6'>\n                <h2>{state.session.journey.split('/')[state.session.journey.split('/').length - 1]}</h2>\n                { currentParticipant && state.session.participants.indexOf(currentParticipant) === 0 &&\n                  <div>\n                    <select className='mb-3' onChange={this.onChangeJourney} value={state.session && state.session.journey}>\n                      {state.journeys.map(journey => (\n                        <option value={journey}>{journey.split('/')[journey.split('/').length -1]}</option>\n                      ))}\n                    </select>\n                    { state.session.state === 'created' &&\n                      <div className='mb-2'>\n                        <button onClick={this.onStartSession} className='btn btn-primary'>Start session <i className=\"fa fa-play\" ariaHidden=\"true\"></i></button>\n                      </div>\n                    }\n                  </div>\n                }\n              </div>\n            </div>\n            <div className='row'>\n              <div className='col-3'>\n                <progress max=\"100\" value={this.state.playerProgress} style={{width: '100%'}}></progress>\n                <p style={{display: 'flex'}}><strong style={{flex: 1}}>Time remaining:</strong><span>{this.timeRemaining}</span></p>\n              </div>\n            </div>\n            <div className='row'>\n              <div className='tok-container col' ref={container => this.container = container }>\n                {this.state.streams.length == 0 &&\n                  <p>Waiting for others to join this journey...</p>\n                }\n                <div className='row no-gutters' style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gridGap: '10px', marginRight: '350px'}}>\n                  {this.state.streams.map(stream => {\n                    const participant = state.session.participants.find(participant => participant.connectionId === stream.connection.id);\n                    return (\n                      <div className={`subscriber`}>\n                        <p style={{fontSize: '14px'}} className={participant && participant.ready ? 'text-success' : 'text-warning'}>{participant && participant.ready ? 'Ready to start!' : 'Not ready yet'}</p>\n                        <OTSubscriber\n                          key={stream.id}\n                          session={this.sessionHelper.session}\n                          stream={stream}\n                        />\n                      </div>\n                    );\n                  })}\n                </div>\n                <div style={{position: 'fixed', bottom: 0, right: 0}}>\n                  <OTPublisher session={this.sessionHelper.session} onInit={this.onInitPublisher} ref={publisher => {this.publisher = publisher}}/>\n                  {currentParticipant && currentParticipant.ready &&\n                    <p>You are ready!</p>\n                  }\n                  {(!currentParticipant || !currentParticipant.ready) &&\n                    <a className='btn btn-primary' href='#' onClick={this.onConfirmReady}>Ready?</a>\n                  }\n                </div>\n              </div>\n            </div>\n          </div>\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default view(Room);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/Room.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"opentok-layout-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok-layout-js\"\n// module id = 37\n// module chunks = 0","module.exports = require(\"es6-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promise\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 39\n// module chunks = 0","module.exports = require(\"connect-mongo\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-mongo\"\n// module id = 40\n// module chunks = 0"],"sourceRoot":""}