{"version":3,"sources":["webpack:///webpack/bootstrap 7f3c4359bb683f675672","webpack:///external \"react\"","webpack:///external \"react-redux\"","webpack:///external \"prop-types\"","webpack:///external \"express\"","webpack:///external \"mongoose\"","webpack:///../client/src/consts/action_types.js","webpack:///external \"react-router-dom\"","webpack:///external \"dotenv\"","webpack:///external \"path\"","webpack:///external \"isomorphic-fetch\"","webpack:///external \"redux\"","webpack:///../client/src/actions/list_actions.js","webpack:///external \"react-easy-state\"","webpack:///external \"babel-polyfill/lib/index\"","webpack:///./index.js","webpack:///./routes/index.js","webpack:///external \"body-parser\"","webpack:///./routes/api.js","webpack:///external \"fs\"","webpack:///external \"opentok\"","webpack:///./models/tok_session.js","webpack:///external \"another-mongoose-statemachine\"","webpack:///./models/tok_session_participant.js","webpack:///./routes/ssr.js","webpack:///external \"react-dom/server\"","webpack:///external \"react-router\"","webpack:///../client/src/reducers/index.js","webpack:///../client/src/reducers/list.js","webpack:///../client/src/consts/default_state.js","webpack:///../client/src/consts/list_items.js","webpack:///../client/src/app.js","webpack:///../client/src/components/header.js","webpack:///../client/src/components/home.js","webpack:///../client/src/containers/list_items.js","webpack:///../client/src/components/list_items.js","webpack:///../client/src/containers/list_item_preview.js","webpack:///../client/src/components/list_item_preview.js","webpack:///../client/src/containers/list_item_view.js","webpack:///../client/src/components/list_item_view.js","webpack:///../client/src/components/Room.js","webpack:///../client/src/state.js","webpack:///external \"uuid\"","webpack:///external \"opentok-layout-js\"","webpack:///external \"es6-promise\"","webpack:///external \"opentok-react\"","webpack:///external \"@opentok/client\""],"names":["LIST_ACTIONS","ITEM_PREVIEW","ITEM_VIEW","ITEM_ADD","ITEM_CLEAR","previewItem","type","name","viewItem","addItem","item","clearItem","dotenv","require","config","global","__CLIENT__","__SERVER__","routes","exports","app","set","join","__dirname","use","json","static","listen","process","env","PORT","console","log","connect","MONGODB_URI","MONGO_URL","promisify","fn","promisified","params","Promise","resolve","reject","concat","err","args","length","opentok","OPENTOK_KEY","OPENTOK_SECRET","router","Router","generateToken","sessionId","tokenOptions","role","token","get","req","res","room","findOne","lean","exec","existingSession","find","session","present","participants","createSession","newSession","save","toJSON","connection","connectionId","participant","ready","signal","data","count","allReady","sendStatus","sendStsatus","readdirAsync","readdir","extname","file","journeyFiles","filter","map","put","journey","body","post","start","event","id","participantExists","fetch","headers","method","mode","JSON","stringify","then","response","TokSessionSchema","String","index","default","plugin","states","created","started","completed","transitions","from","to","end","TokSession","model","TokSessionParticipantSchema","Types","ObjectId","ref","Boolean","TokSessionParticipant","store","openTokKey","dispatch","description","context","html","renderToString","originalUrl","finalState","getState","url","writeHead","Location","status","render","NODE_ENV","script","rootReducer","list","state","action","itemPreview","items","toUpperCase","itemView","nextItems","itemToAdd","returnVal","LISTS","ACTIONS","STORE","REDUCERS","App","Header","Home","mapStateToProps","listItems","mapDispatchToProps","ListView","props","Object","keys","key","renderList","propTypes","object","isRequired","func","ListItemPreview","defaultProps","ListItemView","match","polyfill","OTSession","OTPublisher","OTStreams","OTSubscriber","OT","window","Room","refreshSession","onInitPublisher","onConfirmReady","e","sessionHelper","onChangeJourney","target","value","cache","credentials","redirect","referrer","onStartSession","onLoadedMetadata","setState","journeyDuration","duration","audioTag","removeEventListener","onTimeUpdate","addEventListener","playerProgress","currentTime","playerProgressMS","streams","publisherId","playerState","publisher","publishAudio","setTimeout","apiKey","onConnect","onStreamsUpdated","sh","on","play","journeys","disconnect","currentParticipant","display","split","indexOf","width","flex","timeRemaining","container","gridTemplateColumns","gridGap","marginRight","stream","fontSize","position","bottom","right","seconds","minutes","Math","floor","remainingSeconds","toFixed","__INITIAL_STATE__"],"mappings":"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","file":"./server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7f3c4359bb683f675672","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"prop-types\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prop-types\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 4\n// module chunks = 0","// eslint-disable-next-line\nexport const LIST_ACTIONS = {\n  ITEM_PREVIEW: 'ITEM_PREVIEW',\n  ITEM_VIEW: 'ITEM_VIEW',\n  ITEM_ADD: 'ITEM_ADD',\n  ITEM_CLEAR: 'ITEM_CLEAR',\n};\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/consts/action_types.js","module.exports = require(\"react-router-dom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router-dom\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 10\n// module chunks = 0","import { LIST_ACTIONS } from '../consts/action_types';\n\nexport const previewItem = name => ({\n  type: LIST_ACTIONS.ITEM_PREVIEW,\n  name, // shorthand for name: name\n});\n\nexport const viewItem = name => ({\n  type: LIST_ACTIONS.ITEM_VIEW,\n  name,\n});\n\nexport const addItem = item => ({\n  type: LIST_ACTIONS.ITEM_ADD,\n  item, // shorthand for item: item\n});\n\nexport const clearItem = () => ({\n  type: LIST_ACTIONS.ITEM_CLEAR,\n});\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/actions/list_actions.js","module.exports = require(\"react-easy-state\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-easy-state\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"babel-polyfill/lib/index\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill/lib/index\"\n// module id = 14\n// module chunks = 0","const dotenv = require('dotenv');\n\ndotenv.config();\nglobal.__CLIENT__ = false;\nglobal.__SERVER__ = true;\n\nconst routes = require('./routes');\n\nexports = routes;\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","import path from 'path';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport api from './api';\nimport ssr from './ssr';\n\nconst app = express();\n\napp.set('view engine', 'ejs');\napp.set('views', path.join(__dirname, '../views'));\napp.use(bodyParser.json());\n\napp.use(express.static(path.join(__dirname, '..', 'public')));\n\napp.use('/api', api);\napp.use('/*', ssr);\n\napp.listen(process.env.PORT || 5000, () => {\n  console.log('Hello World listening on port 5000!');\n});\n\n\n\n// WEBPACK FOOTER //\n// ./routes/index.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 17\n// module chunks = 0","import fs from 'fs';\nimport path from 'path';\nimport express from 'express';\nimport OpenTok from 'opentok';\nimport mongoose from 'mongoose';\nimport TokSession from '../models/tok_session';\nimport TokSessionParticipant from '../models/tok_session_participant';\nimport dotenv from 'dotenv';\nrequire('isomorphic-fetch');\n\ndotenv.config();\n\nmongoose.connect(process.env.MONGODB_URI || process.env.MONGO_URL);\n\nfunction promisify(fn) {\n  /**\n   * @param {...Any} params The params to pass into *fn*\n   * @return {Promise<Any|Any[]>}\n   */\n  return function promisified(...params) {\n    return new Promise((resolve, reject) => fn(...params.concat([(err, ...args) => err ? reject(err) : resolve( args.length < 2 ? args[0] : args )])))\n  }\n}\n\nconst opentok = new OpenTok(process.env.OPENTOK_KEY, process.env.OPENTOK_SECRET);\nconst router = express.Router();\n\nfunction generateToken(sessionId) {\n\tlet tokenOptions = {};\n\ttokenOptions.role = \"publisher\";\n\t// Generate a token.\n\tconst token = opentok.generateToken(sessionId, tokenOptions);\n  console.log('return token', token);\n\treturn token;\n}\n\n// TODO: switch to POST, just using GET for easier testing\nrouter.get('/sessions/:room', async (req, res) => {\n\tconst {room} = req.params;\n\tconst existingSession = await TokSession.findOne({room}).lean().exec();\n\tif (existingSession) {\n    const participants = await TokSessionParticipant.find({session: existingSession, present: true}).lean().exec();\n    existingSession.participants = participants;\n\t\tres.json({\n\t\t\t...existingSession,\n\t\t\ttoken: generateToken(existingSession.sessionId),\n\t\t});\n\t} else {\n\t\topentok.createSession(async (err, session) => {\n\t\t  if (err) throw err;\n\t\t\t// save the sessionId\n\t\t\tconst newSession = new TokSession({room, sessionId: session.sessionId});\n\t\t\tawait newSession.save();\n\t\t\tres.json({\n\t\t\t\t...newSession.toJSON(),\n\t\t\t\ttoken: generateToken(session.sessionId),\n\t\t\t});\n\t\t});\n\t}\n});\n\nrouter.get('/sessions/:room/connections/:connection/ready', async (req, res) => {\n  const {room, connection} = req.params;\n  const existingSession = await TokSession.findOne({room}).exec();\n\tif (existingSession) {\n    const participant = await TokSessionParticipant.findOne({session: existingSession, connectionId: connection});\n    participant.ready = true;\n    await participant.save();\n    signal(existingSession.sessionId, {type: 'ready', data: 'foo'});\n    const allReady = (await TokSessionParticipant.count({session: existingSession, ready: false, present: true})) === 0;\n    if (allReady) {\n      // signal(existingSession.sessionId, {type: 'startJourney', data: 'foo'});\n    }\n    return res.sendStatus(200);\n  }\n  res.sendStsatus(200);\n});\n\nrouter.get('/journeys', async (req, res) => {\n  const readdirAsync = promisify(fs.readdir)\n  const journeyFiles = (await readdirAsync(path.join(__dirname, '..', 'public/journeys'))).filter(file => {\n    return path.extname(file) === '.mp3';\n  }).map(file => {\n    return `/journeys/${file}`\n  });\n  res.json(journeyFiles);\n});\n\nrouter.put('/sessions/:room/journey', async (req, res) => {\n  console.log('UPDATE JOURNEY');\n  const {journey} = req.body;\n  const {room} = req.params;\n  const existingSession = await TokSession.findOne({room}).exec();\n\tif (existingSession) {\n    existingSession.journey = journey;\n    await existingSession.save();\n    signal(existingSession.sessionId, {type: 'updatedJourney', data: journey});\n  }\n  res.sendStatus(200);\n});\n\n// TODO: this should really verify that the user hitting this endpoint is authorized to do so (e.g. that they are the journey's host)\nrouter.post('/sessions/:room/start', async (req, res) => {\n  const {room} = req.params;\n  const existingSession = await TokSession.findOne({room}).exec();\n\tif (existingSession) {\n    await existingSession.start();\n    signal(existingSession.sessionId, {type: 'startJourney', data: ''});\n  }\n});\n\nrouter.post('/event', async (req, res) => {\n  console.log('GOT EVENT', req.body);\n  res.sendStatus(200);\n  const {sessionId, connection} = req.body;\n  const session = await TokSession.findOne({sessionId}).exec();\n  \n  switch(req.body.event) {\n    case 'connectionCreated':\n      if (session) {\n        const participantExists = (await TokSessionParticipant.count({session, connectionId: connection.id})) > 0;\n        if (!participantExists) {\n          const participant = new TokSessionParticipant({session, connectionId: connection.id});\n          await participant.save();\n        }\n      }\n      break;\n    case 'connectionDestroyed':\n      if (session) {\n        const participant= await TokSessionParticipant.findOne({session, connectionId: connection.id});\n        if (participant) {\n          participant.present = false;\n          await participant.save();\n        }\n      }\n      break\n  }\n});\n\nfunction signal(sessionId, data) {\n  fetch(`https://api.opentok.com/v2/project/${process.env.OPENTOK_KEY}/session/${sessionId}/signal`, {\n    headers: {\n      'X-TB-PARTNER-AUTH': `${process.env.OPENTOK_KEY}:${process.env.OPENTOK_SECRET}`\n    },\n    method: 'POST',\n    mode: 'cors',\n    body: JSON.stringify(data)\n  }).then(response => console.log(response));\n}\n\nexport default router;\n\n\n\n\n// WEBPACK FOOTER //\n// ./routes/api.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"opentok\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok\"\n// module id = 20\n// module chunks = 0","import mongoose, {Schema} from 'mongoose';\nimport statemachine from 'another-mongoose-statemachine';\n\nconst TokSessionSchema = new Schema({\n  room: {type: String, index: true},\n  sessionId: {type: String, index: true},\n  journey: {type: String, default: '/journeys/Journey to A Spiderweb+Music.mp3'},\n});\n\nTokSessionSchema.plugin(statemachine, {\n  states: {\n    created: {default: true},\n    started: {},\n    completed: {}\n  },\n  transitions: {\n    start: { from: 'created', to: 'started' },\n    end: { from: '*', to: 'completed' },\n  }\n});\n\nconst TokSession = mongoose.model('TokSession', TokSessionSchema);\n\nexport default TokSession;\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/tok_session.js","module.exports = require(\"another-mongoose-statemachine\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"another-mongoose-statemachine\"\n// module id = 22\n// module chunks = 0","import mongoose, {Schema} from 'mongoose';\n\nconst TokSessionParticipantSchema = new Schema({\n  \"connectionId\": {type: String, index: true},\n  \"session\": {type: Schema.Types.ObjectId, ref: 'TokSession'},\n  \"ready\": {type: Boolean, default: false},\n  \"present\": {type: Boolean, default: true},\n});\n\nconst TokSessionParticipant = mongoose.model('TokSessionParticipant', TokSessionParticipantSchema);\n\nexport default TokSessionParticipant;\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/tok_session_participant.js","import express from 'express';\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport { createStore } from 'redux';\nimport { Provider } from 'react-redux';\nimport { StaticRouter } from 'react-router';\nimport reducers from '../../client/src/reducers/index';\nimport { LIST_ACTIONS } from '../../client/src/consts/action_types';\nimport App from '../../client/src/app';\nconsole.log(process.env);\n\nconst router = express.Router();\n\nrouter.get('/', (req, res) => {\n  /*\n    http://redux.js.org/docs/recipes/ServerRendering.html\n  */\n  const store = createStore(reducers, {\n    openTokKey: process.env.OPENTOK_KEY\n  });\n    \n  /*\n      We can dispatch actions from server side as well. This can be very useful if you want\n      to inject some initial data into the app. For example, if you have some articles that\n      you have fetched from database and you want to load immediately after the user has loaded\n      the webpage, you can do so in here.\n\n      Here we are inject an list item into our app. Normally once the user has loaded the webpage\n      we would make a request to the server and get the latest item list. But in the server we have\n      instant connection to a database (for example, if you have a mongoDB or MySQL database installed\n      in the server which contains all you items). So you can quickly fetch and inject it into the webpage.\n\n      This will help SEO as well. If you load the webpage and make a request to the server to get all the\n      latest items/articles, by the time Google Search Engine may not see all the updated items/articles.\n\n      But if you inject the latest items/articles before it reaches the user, the Search Engine will see the\n      item/article immediately.\n       */\n  store.dispatch({\n    type: LIST_ACTIONS.ITEM_ADD,\n    item: {\n      name: 'middleware',\n      description: `Redux middleware solves different problems than Express or Koa middleware, but in a conceptually similar way.\n      It provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.`,\n    },\n  });\n\n  const context = {};\n\n  const html = ReactDOMServer.renderToString(\n    <Provider store={store}>\n      <StaticRouter\n        location={req.originalUrl}\n        context={context}\n      >\n        <App />\n      </StaticRouter>\n    </Provider>,\n  );\n\n  const finalState = store.getState();\n\n  if (context.url) {\n    res.writeHead(301, {\n      Location: context.url,\n    });\n    res.end();\n  } else {\n    res.status(200).render(process.env.NODE_ENV === 'production' ? 'index.ejs' : 'index.dev.ejs', {\n      html,\n      script: JSON.stringify({...finalState}),\n    });\n  }\n});\n\n\nexport default router;\n\n\n\n// WEBPACK FOOTER //\n// ./routes/ssr.js","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 26\n// module chunks = 0","import { combineReducers } from 'redux';\nimport list from './list';\n\nconst rootReducer = combineReducers({\n  list, // shorthand for lists: lists\n  openTokKey: (state = {}) => state\n});\n\nexport default rootReducer;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/reducers/index.js","import { LIST_ACTIONS } from '../consts/action_types';\nimport { LISTS } from '../consts/default_state';\n\nexport default (state = LISTS, action) => {\n  switch (action.type) {\n    case LIST_ACTIONS.ITEM_PREVIEW:\n      return { ...state, itemPreview: state.items[action.name.toUpperCase()] };\n    case LIST_ACTIONS.ITEM_VIEW:\n      return { ...state, itemView: state.items[action.name.toUpperCase()] };\n    case LIST_ACTIONS.ITEM_CLEAR:\n      return { ...state, itemView: null };\n    case LIST_ACTIONS.ITEM_ADD: {\n      const nextItems = { ...state.items };\n      const itemToAdd = action.item;\n      nextItems[itemToAdd.name.toUpperCase()] = itemToAdd;\n      const returnVal = { ...state, items: nextItems };\n      return returnVal;\n    }\n    default:\n      return state;\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/reducers/list.js","import LIST_ITEMS from './list_items';\n\n// eslint-disable-next-line\nexport const LISTS = { items: LIST_ITEMS, itemPreview: null, itemView: null };\n\n\n// WEBPACK FOOTER //\n// ../client/src/consts/default_state.js","export default {\n  ACTIONS: {\n    name: 'actions',\n    description: 'Actions are payloads of information that send data from your application to your store. They are the only source of information for the store.',\n  },\n  STORE: {\n    name: 'store',\n    description: 'The state of your whole application is stored in an object tree within a single store.',\n  },\n  REDUCERS: {\n    name: 'reducers',\n    description: 'Actions describe the fact that something happened, but don\\'t specify how the application\\'s state changes in response. This is the job of reducers.',\n  },\n};\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/consts/list_items.js","import React from 'react';\nimport { Route } from 'react-router-dom';\nimport Header from './components/header';\nimport Home from './components/home';\nimport ItemView from './containers/list_item_view';\nimport Room from './components/Room';\n\nconst App = () => (\n  <div>\n    <Header />\n    <Route exact path=\"/\" component={Home} />\n\t\t<Route exact path=\"/:room\" component={Room} />\n    <Route exact path=\"/view/:name\" component={ItemView} />\n  </div>\n);\n\nexport default App;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/app.js","import React from 'react';\n\nconst Header = () => (\n  <div className=\"header pl-4\">\n    <h1>Wacuri</h1>\n  </div>\n);\n\nexport default Header;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/header.js","import React from 'react';\nimport ListItems from '../containers/list_items';\nimport ListItemPreview from '../containers/list_item_preview';\n\nconst Home = () => (\n  <div className=\"home\">\n    <h3>Amazing things to come.</h3>\n  </div>\n);\n\nexport default Home;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/home.js","import { connect } from 'react-redux';\nimport { previewItem } from '../actions/list_actions';\nimport ListItems from '../components/list_items';\n\n/*\nThis is a redux specific function.\nWhat is does is: It gets the state specified in here from the global redux state.\nFor example, here we are retrieving the list of items from the redux store.\nWhenever this list changes, any component that is using this list of item will re-render.\n */\nconst mapStateToProps = state => ({\n  listItems: state.list.items,\n});\n\n/*\nThis is a redux specific function.\nhttp://redux.js.org/docs/api/bindActionCreators.html\n */\nconst mapDispatchToProps = dispatch => ({\n  previewItem: (name) => {\n    dispatch(previewItem(name));\n  },\n});\n\n\n/*\nHere we are creating a Higher order component\nhttps://facebook.github.io/react/docs/higher-order-components.html\n */\nexport default connect(mapStateToProps, mapDispatchToProps)(ListItems);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/containers/list_items.js","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass ListView extends Component {\n  renderList() {\n    const { listItems, previewItem } = this.props;\n    return Object.keys(listItems).map((key) => {\n      const item = listItems[key];\n      return (\n        <li\n          key={item.name}\n        >\n          <button onClick={() => previewItem(item.name)}>{ item.name }</button>\n        </li>\n      );\n    });\n  }\n  render() {\n    return (\n      <div className=\"list_items\">\n        <ul>\n          { this.renderList() }\n        </ul>\n      </div>\n    );\n  }\n}\n\nListView.propTypes = {\n  listItems: PropTypes.object.isRequired,\n  previewItem: PropTypes.func.isRequired,\n};\n\nexport default ListView;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/list_items.js","import { connect } from 'react-redux';\nimport ListItemPreview from '../components/list_item_preview';\n\n/*\n This is a redux specific function.\n What is does is: It gets the state specified in here from the global redux state.\n For example, here we are retrieving the list of items from the redux store.\n Whenever this list changes, any component that is using this list of item will re-render.\n */\nfunction mapStateToProps(state) {\n  return {\n    item: state.list.itemPreview,\n  };\n}\n\n/*\n Here we are creating a Higher order component\n https://facebook.github.io/react/docs/higher-order-components.html\n */\nexport default connect(mapStateToProps)(ListItemPreview);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/containers/list_item_preview.js","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Link } from 'react-router-dom';\n\nconst ListItemPreview = ({ item }) => {\n  if (!item) {\n    return (\n      <div className=\"preview\">\n        <h3>Select an item</h3>\n        <p>Description will appear here</p>\n      </div>\n    );\n  }\n  return (\n    <div className=\"preview\">\n      <h2> { item.name } </h2>\n      <p>{ item.description }</p>\n      <Link to={`view/${item.name}`}>\n        <button type=\"button\" className=\"btn btn-primary\">Read More</button>\n      </Link>\n    </div>\n  );\n};\n\nListItemPreview.propTypes = {\n  item: PropTypes.object,\n};\n\nListItemPreview.defaultProps = {\n  item: null,\n};\n\nexport default ListItemPreview;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/list_item_preview.js","import { connect } from 'react-redux';\nimport { viewItem } from '../actions/list_actions';\nimport ItemView from '../components/list_item_view';\n\nconst mapStateToProps = state => ({\n  item: state.list.itemView,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  viewItem: (name) => {\n    dispatch(viewItem(name));\n  },\n});\n\n/*\n Here we are creating a Higher order component\n https://facebook.github.io/react/docs/higher-order-components.html\n */\nexport default connect(mapStateToProps, mapDispatchToProps)(ItemView);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/containers/list_item_view.js","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Link } from 'react-router-dom';\n\nclass ListItemView extends Component {\n  componentDidMount() {\n    const { viewItem, match } = this.props;\n    viewItem(match.params.name);\n  }\n  render() {\n    const { item } = this.props;\n    if (!item) {\n      return (<div>Loading...</div>);\n    }\n\n    return (\n      <div className=\"view_item\">\n        <Link to={'/'}>\n          <button type=\"button\">Back</button>\n        </Link>\n        <h2>{ item.name }</h2>\n        <p>{ item.description }</p>\n      </div>\n    );\n  }\n}\n\nListItemView.propTypes = {\n  viewItem: PropTypes.func.isRequired,\n  match: PropTypes.object.isRequired,\n  item: PropTypes.object,\n};\n\nListItemView.defaultProps = {\n  item: null,\n};\n\nexport default ListItemView;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/list_item_view.js","import React, {Component} from 'react';\nimport { view } from 'react-easy-state'\nimport state from '../state';\nimport PropTypes from 'prop-types';\nimport uuid from 'uuid';\nimport {initLayoutContainer} from 'opentok-layout-js';\nrequire('es6-promise').polyfill();\nrequire('isomorphic-fetch');\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\nif (__CLIENT__) {\n\tvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n\tconst OT = require('@opentok/client');\n\twindow.state = state;\n}\n\nclass Room extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      streams: [],\n      publisherId: '',\n      session: null,\n      playerState: 'waiting',\n      playerProgress: 0,\n      playerProgressMS: 0,\n      journeyDuration: 0,\n    }\n    this.publisher = {};\n    this.audioTag = {};\n  }\n\n\tcomponentDidMount() {\n    this.audioTag.addEventListener('ended', (event) => {\n      this.publisher.state.publisher.publishAudio(true);\n      this.setState({\n        playerState: 'ended'\n      });\n    });\n\n    \n    setTimeout(() => {\n      console.log('ADD IT TO', this.audioTag, this.onTimeUpdate);\n      \n    }, 5000);\n    \n\t\tfetch(`/api/sessions/${this.props.match.params.room}`)\n\t\t\t.then(res => res.json())\n\t\t\t.then(json => {\n\t\t\t\tstate.session = json;\n        this.sessionHelper = createSession({\n          apiKey: state.openTokKey,\n          sessionId: state.session.sessionId,\n          token: state.session.token,\n          onConnect: () => {\n            console.log('assigned connection to publisher', this.sessionHelper.session.connection);\n            setTimeout(this.refreshSession, 1000);\n          },\n          onStreamsUpdated: streams => {\n            console.log('Current subscriber streams:', streams);\n            this.setState({ streams });\n          }\n        });\n        window.sh = this.sessionHelper;\n        this.sessionHelper.session.on(\"connectionDestroyed\", (event) => {\n          console.log('DESTROYED', event);\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionDestroyed',\n          }\n          console.log('data is', data);\n          // fetch(`/api/event`, {\n          //   body: JSON.stringify(data), // must match 'Content-Type' header\n          //   cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n          //   credentials: 'same-origin', // include, same-origin, *omit\n          //   headers: {\n          //     'user-agent': 'Mozilla/4.0 MDN Example',\n          //     'content-type': 'application/json'\n          //   },\n          //   method: 'POST', // *GET, POST, PUT, DELETE, etc.\n          //   mode: 'cors', // no-cors, cors, *same-origin\n          //   redirect: 'follow', // manual, *follow, error\n          //   referrer: 'no-referrer', // *client, no-referrer\n          // });\n          this.refreshSession();\n        });\n        this.sessionHelper.session.on(\"connectionCreated\", (event) => {\n          console.log('CREATED', event);\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionCreated',\n          }\n          console.log('data is', data);\n          // fetch(`/api/event`, {\n          //   body: JSON.stringify(data), // must match 'Content-Type' header\n          //   cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n          //   credentials: 'same-origin', // include, same-origin, *omit\n          //   headers: {\n          //     'user-agent': 'Mozilla/4.0 MDN Example',\n          //     'content-type': 'application/json'\n          //   },\n          //   method: 'POST', // *GET, POST, PUT, DELETE, etc.\n          //   mode: 'cors', // no-cors, cors, *same-origin\n          //   redirect: 'follow', // manual, *follow, error\n          //   referrer: 'no-referrer', // *client, no-referrer\n          // });\n          this.refreshSession();\n        });\n        this.sessionHelper.session.on(\"signal\", (event) => {\n          console.log(\"Signal sent from connection \", event);\n          this.refreshSession();\n          if (event.type === 'signal:startJourney') {\n            this.publisher.state.publisher.publishAudio(false);\n            this.audioTag.play();\n            this.setState({\n              playerState: 'playing'\n            });\n          }\n        });\n        this.setState({\n          session: this.sessionHelper.session\n        });\n\t\t\t});\n    fetch('/api/journeys')\n      .then(res => res.json())\n      .then(json => {\n        state.journeys = json;\n      });\n\t}\n\n  componentWillUnmount() {\n    if (this.sessionHelper) {\n      this.sessionHelper.disconnect();\n    }\n  }\n\n  refreshSession = () => {\n\t\tfetch(`/api/sessions/${this.props.match.params.room}`)\n\t\t\t.then(res => res.json())\n\t\t\t.then(json => {\n\t\t\t\tstate.session = json;\n      });\n  }\n\n  get timeRemaining() {\n    const seconds = this.state.journeyDuration - this.state.playerProgressMS;\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = (seconds % 60).toFixed(0);\n    return minutes + \":\" + (remainingSeconds < 10 ? '0' : '') + remainingSeconds;\n  }\n\n  onInitPublisher = () => {\n    console.log('initialized publisher');\n  }\n\n  onConfirmReady = (e) => {\n    fetch(`/api/sessions/${this.props.match.params.room}/connections/${this.sessionHelper.session.connection.id}/ready`);\n  }\n\n  onChangeJourney = (e) => {\n    console.log('CHANGE', e.target.value);\n    fetch(`/api/sessions/${this.props.match.params.room}/journey`, {\n      body: JSON.stringify({journey: e.target.value}), // must match 'Content-Type' header\n      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n      credentials: 'same-origin', // include, same-origin, *omit\n      headers: {\n        'user-agent': 'Mozilla/4.0 MDN Example',\n        'content-type': 'application/json'\n      },\n      method: 'PUT', // *GET, POST, PUT, DELETE, etc.\n      mode: 'cors', // no-cors, cors, *same-origin\n      redirect: 'follow', // manual, *follow, error\n      referrer: 'no-referrer', // *client, no-referrer\n    });\n  }\n\n  onStartSession = (e) => {\n    fetch(`/api/sessions/${this.props.match.params.room}/start`, {\n      cache: 'no-cache',\n      credentials: 'same-origin',\n      headers: {\n        'user-agent': 'Mozilla/4.0 MDN Example',\n        'content-type': 'application/json'\n      },\n      method: 'POST',\n      mode: 'cors',\n    });\n  }\n\n  onLoadedMetadata = (e) => {\n    this.setState({\n      journeyDuration: e.target.duration\n    });\n    this.audioTag.removeEventListener('timeupdate', this.onTimeUpdate);\n    this.audioTag.addEventListener('timeupdate', this.onTimeUpdate);\n  }\n\n  onTimeUpdate = (e) => {\n    this.setState({\n      playerProgress: (e.target.currentTime / e.target.duration) * 100,\n      playerProgressMS: e.target.currentTime,\n    });\n  }\n\n\trender() {\n    const currentParticipant = this.state.session && state.session && state.session.participants.find(participant => participant.connectionId === this.state.session.connection.id);\n\t\treturn (\n\t\t\t<div className='journey-container'>\n\t\t\t\t<p style={{display: 'none'}}>{JSON.stringify(state.session, null, 2)}</p>\n        \n        <audio style={{display: 'none'}} onLoadedMetadata={this.onLoadedMetadata} key={state.session && state.session.journey} controls=\"true\" ref={audioTag => { this.audioTag = audioTag }}>\n         <source src={state.session && state.session.journey} type=\"audio/mpeg\"/>\n        </audio>\n\t\t\t\t{this.state.session &&\n          <div>\n          <div className='row'>\n            <div className='col-6'>\n              <h2>{state.session.journey.split('/')[state.session.journey.split('/').length - 1]}</h2>\n              { currentParticipant && state.session.participants.indexOf(currentParticipant) === 0 &&\n                <div>\n                  <select className='mb-3' onChange={this.onChangeJourney} value={state.session && state.session.journey}>\n                    {state.journeys.map(journey => (\n                      <option value={journey}>{journey.split('/')[journey.split('/').length -1]}</option>\n                    ))}\n                  </select>\n                  { state.session.state === 'created' &&\n                    <div className='mb-2'>\n                      <button onClick={this.onStartSession} className='btn btn-primary'>Start session <i className=\"fa fa-play\" ariaHidden=\"true\"></i></button>\n                    </div>\n                  }\n                </div>\n              }\n            </div>\n          </div>\n          <div className='row'>\n            <div className='col-3'>\n              <progress max=\"100\" value={this.state.playerProgress} style={{width: '100%'}}></progress>\n              <p style={{display: 'flex'}}><strong style={{flex: 1}}>Time remaining:</strong><span>{this.timeRemaining}</span></p>\n            </div>\n          </div>\n          <div className='row'>\n            <div className='tok-container col' ref={container => this.container = container }>\n              {this.state.streams.length == 0 &&\n                <p>Waiting for others to join this journey...</p>\n              }\n              <div className='row no-gutters' style={{display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gridGap: '10px', marginRight: '350px'}}>\n                {this.state.streams.map(stream => {\n                  const participant = state.session.participants.find(participant => participant.connectionId === stream.connection.id);\n                  return (\n                    <div className={`subscriber`}>\n                      <p style={{fontSize: '14px'}} className={participant && participant.ready ? 'text-success' : 'text-warning'}>{participant && participant.ready ? 'Ready to start!' : 'Not ready yet'}</p>\n                      <OTSubscriber\n                        key={stream.id}\n                        session={this.sessionHelper.session}\n                        stream={stream}\n                      />\n                    </div>\n                  );\n                })}\n              </div>\n              <div style={{position: 'fixed', bottom: 0, right: 0}}>\n                <OTPublisher session={this.sessionHelper.session} onInit={this.onInitPublisher} ref={publisher => {this.publisher = publisher}}/>\n                {currentParticipant && currentParticipant.ready &&\n                  <p>You are ready!</p>\n                }\n                {(!currentParticipant || !currentParticipant.ready) &&\n                  <a className='btn btn-primary' href='#' onClick={this.onConfirmReady}>Ready?</a>\n                }\n              </div>\n            </div>\n          </div>\n        </div>\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default view(Room);\n\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/Room.js","import { store } from 'react-easy-state'\n\nexport default store({\n  ...(global.__INITIAL_STATE__ || {}),\n  session: null,\n  journeys: [],\n});\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/state.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 42\n// module chunks = 0","module.exports = require(\"opentok-layout-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok-layout-js\"\n// module id = 43\n// module chunks = 0","module.exports = require(\"es6-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promise\"\n// module id = 44\n// module chunks = 0","module.exports = require(\"opentok-react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok-react\"\n// module id = 45\n// module chunks = 0","module.exports = require(\"@opentok/client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@opentok/client\"\n// module id = 46\n// module chunks = 0"],"sourceRoot":""}