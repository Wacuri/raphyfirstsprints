{"version":3,"sources":["webpack:///webpack/bootstrap 1e56de5fb17e0e4b0010","webpack:///external \"debug\"","webpack:///external \"react\"","webpack:///../client/src/state.js","webpack:///external \"mongoose\"","webpack:///external \"react-easy-state\"","webpack:///../node_modules/Agenda/lib/utils/index.js","webpack:///external \"opentok-react\"","webpack:///external \"@opentok/client\"","webpack:///external \"path\"","webpack:///external \"human-interval\"","webpack:///external \"moment\"","webpack:///external \"express\"","webpack:///external \"react-router\"","webpack:///external \"react-router-dom\"","webpack:///external \"js-cookie\"","webpack:///external \"dotenv\"","webpack:///external \"fs\"","webpack:///external \"events\"","webpack:///../node_modules/Agenda/lib/job/index.js","webpack:///external \"date.js\"","webpack:///../node_modules/Agenda/lib/utils/create-job.js","webpack:///external \"opentok\"","webpack:///./models/journey_space.js","webpack:///./models/journey_participant.js","webpack:///./models/journey_rsvp.js","webpack:///./models/journey_content.js","webpack:///external \"isomorphic-fetch\"","webpack:///external \"prop-types\"","webpack:///../client/src/components/header.js","webpack:///external \"react-swipeable-views\"","webpack:///../client/src/components/journey_starts_in.js","webpack:///../client/src/components/intro.js","webpack:///../client/src/utility/utility.js","webpack:///external \"babel-polyfill/lib/index\"","webpack:///./index.js","webpack:///external \"isomorphic-loader/lib/extend-require\"","webpack:///./jobs/index.js","webpack:///../node_modules/Agenda/index.js","webpack:///../node_modules/Agenda/lib/agenda/index.js","webpack:///../node_modules/Agenda/lib/agenda/mongo.js","webpack:///../node_modules/Agenda/lib/agenda/database.js","webpack:///external \"mongodb\"","webpack:///../node_modules/Agenda/lib/agenda/db-init.js","webpack:///../node_modules/Agenda/lib/agenda/name.js","webpack:///../node_modules/Agenda/lib/agenda/process-every.js","webpack:///../node_modules/Agenda/lib/agenda/max-concurrency.js","webpack:///../node_modules/Agenda/lib/agenda/default-concurrency.js","webpack:///../node_modules/Agenda/lib/agenda/locklimit.js","webpack:///../node_modules/Agenda/lib/agenda/default-lock-limit.js","webpack:///../node_modules/Agenda/lib/agenda/default-lock-lifetime.js","webpack:///../node_modules/Agenda/lib/agenda/sort.js","webpack:///../node_modules/Agenda/lib/agenda/create.js","webpack:///../node_modules/Agenda/lib/job/to-json.js","webpack:///../node_modules/Agenda/lib/job/compute-next-run-at.js","webpack:///external \"cron\"","webpack:///external \"moment-timezone\"","webpack:///../node_modules/Agenda/lib/job/repeat-every.js","webpack:///../node_modules/Agenda/lib/job/repeat-at.js","webpack:///../node_modules/Agenda/lib/job/disable.js","webpack:///../node_modules/Agenda/lib/job/enable.js","webpack:///../node_modules/Agenda/lib/job/unique.js","webpack:///../node_modules/Agenda/lib/job/schedule.js","webpack:///../node_modules/Agenda/lib/job/priority.js","webpack:///../node_modules/Agenda/lib/job/fail.js","webpack:///../node_modules/Agenda/lib/job/run.js","webpack:///../node_modules/Agenda/lib/job/is-running.js","webpack:///../node_modules/Agenda/lib/job/save.js","webpack:///../node_modules/Agenda/lib/job/remove.js","webpack:///../node_modules/Agenda/lib/job/touch.js","webpack:///../node_modules/Agenda/lib/agenda/jobs.js","webpack:///../node_modules/Agenda/lib/utils/process-jobs.js","webpack:///../node_modules/Agenda/lib/agenda/purge.js","webpack:///../node_modules/Agenda/lib/agenda/define.js","webpack:///../node_modules/Agenda/lib/agenda/every.js","webpack:///../node_modules/Agenda/lib/agenda/schedule.js","webpack:///../node_modules/Agenda/lib/agenda/now.js","webpack:///../node_modules/Agenda/lib/agenda/cancel.js","webpack:///../node_modules/Agenda/lib/agenda/save-job.js","webpack:///../node_modules/Agenda/lib/agenda/start.js","webpack:///../node_modules/Agenda/lib/agenda/stop.js","webpack:///../node_modules/Agenda/lib/agenda/find-and-lock-next-job.js","webpack:///external \"lodash\"","webpack:///external \"another-mongoose-statemachine\"","webpack:///./routes/index.js","webpack:///external \"ssl-express-www\"","webpack:///external \"body-parser\"","webpack:///./routes/api.js","webpack:///./routes/ssr.js","webpack:///external \"react-dom/server\"","webpack:///external \"redux\"","webpack:///external \"react-redux\"","webpack:///../client/src/app.js","webpack:///../client/res/images/CuriousLive-logo.png","webpack:///../client/src/components/home.js","webpack:///../client/src/components/user_list.js","webpack:///../client/src/components/generator_form.js","webpack:///../client/src/components/event_message.js","webpack:///../client/src/components/journey_space_form.js","webpack:///../client/src/components/journey_detail_entry.js","webpack:///../client/src/components/session_info.js","webpack:///../client/src/components/journey_space.js","webpack:///external \"react-swipeable-views-utils\"","webpack:///external \"react-swipeable-views-core\"","webpack:///external \"uuid\"","webpack:///external \"opentok-layout-js\"","webpack:///../client/src/components/share.js","webpack:///external \"react-rating\"","webpack:///external \"es6-promise\"","webpack:///../client/src/components/countdown_message.js","webpack:///external \"agenda\"","webpack:///external \"agendash\"","webpack:///external \"express-session\"","webpack:///external \"connect-mongo\""],"names":["Deferred","promise","Promise","resolve","reject","AudioQueue","file","player","Audio","queue","track","addEventListener","e","length","src","play","queueCompletionPromise","pause","files","paused","load","event","listener","removeEventListener","time","currentTime","duration","readyState","state","journey","sessionId","journeys","joinableJourneys","loggedIn","user","location","audioTag","__CLIENT__","global","__INITIAL_STATE__","FlagSchema","Schema","type","String","reason","flagged","JourneySpaceSchema","room","index","name","image","Number","default","startAt","Date","owner","flags","timestamps","plugin","statemachine","states","created","joined","started","completed","ended","expired","failed","transitions","from","to","start","fail","complete","end","expire","reset","methods","skip","JourneySpace","mongoose","model","JourneyParticipantSchema","Types","ObjectId","ref","Boolean","JourneyParticipant","JourneyRSVPSchema","JourneyRSVP","JourneyContentSchema","filePath","JourneyContent","LeaveRoomButton","onLeave","preventDefault","props","history","push","backgroundColor","borderStyle","color","borderRadius","padding","fontSize","Component","Header","showLeave","logo","React","JourneyStartsIn","timer","on","current","setState","timerValue","newProps","clear","borderBottom","display","marginLeft","displayTime","OTSession","OTPublisher","OTStreams","OTSubscriber","createSession","require","OT","window","Intro","goTo","onChangeIndex","last","onSkip","onClose","streams","views","Cookie","set","expires","match","params","fetch","search","credentials","then","res","json","sessionHelper","apiKey","openTokKey","token","onConnect","onStreamsUpdated","minHeight","position","flexDirection","alignItems","margin","justifyContent","height","journeySpaceOwnerVideoStream","session","width","swipeable","alignSelf","listStyle","map","view","i","marginRight","cursor","children","participant","participants","find","p","stream","s","connection","id","connectionId","setSizes","ONE_SQUARE_WIDTH","LANDSCAPE_NOT_PORTRAIT","tb_and_h","document","getElementById","debug","w","innerWidth","h","innerHeight","console","log","headerHeight","offsetHeight","osw","Math","min","max","osw_h","sf","style","flexFlow","square2","maxWidth","s0","s1","s2","s3","s4","jt","tb","dotenv","config","__SERVER__","extendRequire","catch","err","agenda","Agenda","db","address","process","env","MONGODB_URI","MONGO_URL","opentok","OpenTok","OPENTOK_KEY","OPENTOK_SECRET","offset","define","job","done","collection","countDocuments","total","limit","toArray","randomJourney","journeySpace","toLowerCase","replace","getTime","add","toDate","save","schedule","_id","findOne","exec","globalSpace","response","toJSON","signal","JSON","stringify","$lt","subtract","expiredJourneys","attrs","data","findById","present","every","app","use","secure","secret","saveUninitialized","resave","store","url","cookie","path","join","__dirname","bodyParser","express","static","api","ssr","PORT","listen","connect","promisify","fn","promisified","concat","args","router","Router","generateToken","tokenOptions","role","get","req","lean","currentUserParticipant","newParticipant","selectedJourney","query","aggregate","$sample","size","newJourneySpace","rsvps","post","body","connections","sendStatus","$match","$in","$gte","$ne","$lookup","localField","foreignField","as","$project","$filter","input","cond","$eq","$sort","rsvp","put","messageData","userName","description","ready","count","allReady","journeyFile","journeyContent","userId","sessionID","destroy","clearCookie","redirect","context","html","ReactDOMServer","renderToString","originalUrl","writeHead","Location","status","render","NODE_ENV","script","someHelper","globalClickCatcher","resizeEventHandler","RequireLoginRoute","component","rest","renderProps","pathname","Login","login","method","headers","field","target","value","onChange","propTypes","PropTypes","object","isRequired","JoinableJourneyCard","loading","currentUserHasRSVP","format","Array","fill","k","JourneyBoard","roomUrl","parse","idx","findIndex","j","slice","indexOf","_participant","filter","discriminator","IntroWrapper","showIntro","RouteWithIntro","App","Home","publisherId","totalConnectionsCreated","connectedUsers","publisher","setTimeout","refreshSession","mode","referrer","sh","updatedConnectionCount","newData","d","splice","tries","fetchRetry","displayMessageVisible","displayMessageText","sessionUrl","UserList","userCount","GeneratorForm","sessionLinkName","sessionLinkUrl","activeJourneys","handleNameChange","bind","urlFriendlyName","createSessionLink","EventMessage","JourneySpaceForm","visible","toggleVisibility","border","JourneyDetailEntry","sessionVisible","nextProps","detailVisibility","SessionInfo","jumpToSession","sessionLink","sessionVisibility","open","fontWeight","VirtualizeSwipeableViews","SwipeableViews","polyfill","AbstractTimerEmitter","millisec","normalizeTime","padStart","seconds","toFixed","minutes","floor","parseInt","toString","hours","EventEmitter","SecondsTimerEmitter","createdAt","passed","interval","setInterval","clearInterval","emit","_displayTime","AudioPlayTickEmitter","audioElement","onTimeUpdate","FlagControl","currentUserHasFlaggedStream","onFlag","Waiting","onToggle","canvas","fadeOut","ctx","_this","getContext","fillStyle","fillRect","signaturePad","SignaturePad","penColor","minWidth","overflow","el","transform","WebkitOverflowScrolling","overflowY","JourneyStateProgressBar","formatState","JourneyPhases","NumPhases","Messages","container","stepIndex","SkipButton","skipToNext","vid","vidid","playerState","seekTo","VideoButton","toggle","publishVideo","publishing","AudioButton","changeToggleValue","prevState","toggleMicrophone","DEBUG_MUTE","publishAudio","stopPropagation","prevProps","userID","fetchData","PlayButton","togglePlay","cache","PauseButton","SharePrompt","textAlign","fontFamily","lineHeight","onInvite","InviteModal","journeySpaceName","error","onCopy","protocol","host","success","_copy","onComplete","span","createElement","textContent","whiteSpace","left","top","win","selection","getSelection","appendChild","range","createRange","removeAllRanges","selectNode","addRange","execCommand","remove","right","bottom","background","OrientationModal","handleChangeIndex","slideRenderer","key","maxHeight","zIndex","visibility","FeedbackModal","onSubmit","marginBottom","marginTop","UnfilledVideoSquare","slength","streamlength","localkey","hasFlagged","flag","hide_control","NoVideoSquare","feedbackNotOrientation","msg","topmsg","topmsgvis","fnc","onFeedback","onOrientation","onInitPublisher","onConfirmReady","onChangeJourney","onStartSession","onLoadedMetadata","journeyDuration","playerProgress","playerProgressMS","isHostUser","onShare","navigator","share","title","text","showInviteModal","onCloseShareModal","onCompleteShare","showOrientationModal","onCloseOrientationModal","onCompleteOrienetation","showFeedbackModal","onCloseFeedbackModal","onCompleteFeedback","fraction","togglePlayState","currentlyActivePublisher","decodeURIComponent","origin","enqueue","playPromise","undefined","onAudioCanPlay","isNaN","disconnect","currentParticipant","local_key_counter_to_avoid_warning","currentUserHasFlaggedJourney","stream0","journeyStateTimer","onCompleteOrientation","flex","remainingSeconds","playerTimeEmitter","secondsEmitter","android","userAgent","ios","isDesktop","shareUrls","whatsapp","payload","telegram","facebook","fbid","encodeURIComponent","email","sms","WebShareUI","_initialized","template","innerHTML","$root","querySelector","$whatsapp","$facebook","$telegram","$email","$sms","$copy","onclick","_hide","classList","payloadObj","facebookId","href","_init","clearTimeout","_hideTimer","_setPayload","offsetWidth","querySelectorAll","forEach","opacity","shareUi","show","CountdownMessage","currentCount","days","countdown","intervalId","deadline","endTime","now","timeRemaining","totalTimeInMinutes","message"],"mappings":"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C,EAAS;AAC9B,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;AC3FA,iC;;;;;;ACAA,4C;;;;;;;ACAa;;AAEb;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACba;;AAEb;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;;;;;;;ACVa;;AAEb;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;;;;;;;ACTa;;AAEb;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;;;;;;;ACTa;;AAEb;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACZa;AACb,aAAa,mBAAO,CAAC,EAAS;;AAE9B;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;;;;;;;ACXa;;AAEb;AACA;AACA,WAAW,cAAc;AACzB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;;;;;;;AC7Ba;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,WAAW,aAAa;AACxB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnBa;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;;;;;;;ACpEa;;AAEb;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACpBa;;AAEb;AACA;AACA,WAAW,SAAS;AACpB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;;;;;;;ACVa;;AAEb;AACA;AACA,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA,sBAAsB,oBAAoB;AAC1C;;;;;;;;ACTa;;AAEb;AACA;AACA,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;;;;;;;;ACVa;AACb,cAAc,mBAAO,CAAC,CAAU;;AAEhC;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;;;;;;;ACpBa;AACb;AACA,iGAAiG;AACjG,cAAc,mBAAO,CAAC,CAAO;AAC7B,kBAAkB,mBAAO,CAAC,EAAc;;AAExC;AACA;AACA,WAAW,WAAW;AACtB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,EAAE;AACf,aAAa,QAAQ;AACrB,eAAe;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;;AAEA;AACA,oBAAoB,OAAO;AAC3B,qBAAqB;;AAErB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,oCAAoC,UAAU;AAC9C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,WAAW;AACxB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;AC7Ua;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA;AACA,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA,eAAe,OAAO,OAAO,oBAAoB;AACjD;;;;;;;;ACba;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1Ba;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,WAAW,OAAO;AAClB,WAAW,EAAE;AACb,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,aAAa,EAAE;AACf;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,EAAE;AACf,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,SAAS;AACtB,eAAe,WAAW;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,EAAE;AACf,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,SAAS;AACtB,eAAe,EAAE;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;;ACjFa;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,WAAW,OAAO;AAClB,WAAW,EAAE;AACb,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,aAAa,EAAE;AACf;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,SAAS;AACtB,eAAe,WAAW;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,EAAE;AACf,aAAa,OAAO;AACpB,aAAa,SAAS;AACtB,eAAe,EAAE;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;;ACzEa;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,aAAa,WAAW;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACpBa;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;;;;;;;;ACtBa;AACb,cAAc,mBAAO,CAAC,CAAO;AAC7B,cAAc,mBAAO,CAAC,CAAU;;AAEhC;;AAEA;AACA;AACA,WAAW,WAAW;AACtB,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB;AAChB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,gBAAgB;AAChB;;AAEA;AACA;AACA,sDAAsD,oCAAoC;AAC1F,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,MAAM;AACnB,aAAa,EAAE;AACf;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9Ia;AACb,cAAc,mBAAO,CAAC,CAAO;AAC7B,cAAc,mBAAO,CAAC,CAAU;;AAEhC;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;;;;;;;AClBa;AACb,cAAc,mBAAO,CAAC,CAAO;;AAE7B;AACA;AACA,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA,eAAe;AACf;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,iCAAiC,MAAM,aAAa,GAAG,OAAO,gBAAgB;AA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","file":"./server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 33);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1e56de5fb17e0e4b0010","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 1\n// module chunks = 0","import { store } from 'react-easy-state'\n\nclass Deferred {\n  constructor() {\n    this.promise = new Promise((resolve, reject)=> {\n      this.reject = reject\n      this.resolve = resolve\n    })\n  }\n}\n\nclass AudioQueue {\n  constructor(file) {\n    this.file = file;\n    this.player = new Audio(file);\n    this.queue = [];\n    this.track = 0;\n    this.player.addEventListener('ended', (e) => {\n      this.track++;\n      if (this.queue.length > this.track) {\n        this.player.src = this.queue[this.track];\n        this.play();\n      } else {\n        this.track = 0;\n        this.queueCompletionPromise.resolve();\n      }\n    });\n    this.queueCompletionPromise = new Deferred();\n  }\n\n  set src(file) {\n    this.queue = [file];\n    this.player.src = file;\n  }\n\n  get src() {\n    return this.player.src;\n  }\n\n  set currentTime(time) {\n    this.player.currentTime = time;\n  }\n\n  get currentTime() {\n    return this.player.currentTime;\n  }\n\n  get duration() {\n    return this.player.duration;\n  }\n\n  get paused() {\n    return this.player.paused;\n  }\n\n  get readyState() {\n    return this.player.readyState;\n  }\n\n  play() {\n    if (!this.src) {\n      this.track = 0;\n      this.player.src = this.queue[this.track];\n    }\n    return this.player.play();\n  }\n\n  pause() {\n    return this.player.pause();\n  }\n\n  enqueue(files) {\n    this.queue = [...files];\n    this.queueCompletionPromise = new Deferred();\n    if (this.paused) {\n      this.track = 0;\n      this.player.src = this.queue[0];\n    }\n    return this.queueCompletionPromise.promise;\n  }\n\n  load() {\n    return this.player.load();\n  }\n\n  addEventListener(event, listener) {\n    return this.player.addEventListener(event, listener);\n  }\n\n  removeEventListener(event, listener) {  \n    return this.player.removeEventListener(event, listener);\n  }\n}\n\nconst state =  store({\n  journey: null,\n  sessionId: null,\n  journeys: [],\n  joinableJourneys: [],\n  loggedIn: false,\n  user: null,\n  location: '/',\n  audioTag: __CLIENT__ ? new AudioQueue('/journeys/Journey to The Magnetic Field of the Earth+Music.mp3') : null,\n  ...(global.__INITIAL_STATE__ || {})\n});\n\nexport default state;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/state.js","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"react-easy-state\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-easy-state\"\n// module id = 4\n// module chunks = 0","const createJob = require('./create-job');\nconst processJobs = require('./process-jobs');\n\nmodule.exports = {\n  createJob,\n  processJobs\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/utils/index.js\n// module id = 5\n// module chunks = 0","module.exports = require(\"opentok-react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok-react\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"@opentok/client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@opentok/client\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"human-interval\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"human-interval\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"react-router-dom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router-dom\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"js-cookie\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-cookie\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 17\n// module chunks = 0","'use strict';\n\n/**\n * Internal method to turn priority into a number\n * @param {String|Number} priority string to parse into number\n * @returns {Number} priority that was parsed\n */\nconst parsePriority = priority => {\n  const priorityMap = {\n    lowest: -20,\n    low: -10,\n    normal: 0,\n    high: 10,\n    highest: 20\n  };\n  if (typeof priority === 'number' || priority instanceof Number) {\n    return priority;\n  }\n  return priorityMap[priority];\n};\n\nclass Job {\n  constructor(args) {\n    args = args || {};\n\n    // Remove special args\n    this.agenda = args.agenda;\n    delete args.agenda;\n\n    // Process args\n    args.priority = parsePriority(args.priority) || 0;\n\n    // Set attrs to args\n    const attrs = {};\n    for (const key in args) {\n      if ({}.hasOwnProperty.call(args, key)) {\n        attrs[key] = args[key];\n      }\n    }\n\n    // Set defaults if undefined\n    // NOTE: What is the difference between 'once' here and 'single' in agenda/index.js?\n    attrs.nextRunAt = attrs.nextRunAt || new Date();\n    attrs.type = attrs.type || 'once';\n    this.attrs = attrs;\n  }\n}\n\nJob.prototype.toJSON = require('./to-json');\nJob.prototype.computeNextRunAt = require('./compute-next-run-at');\nJob.prototype.repeatEvery = require('./repeat-every');\nJob.prototype.repeatAt = require('./repeat-at');\nJob.prototype.disable = require('./disable');\nJob.prototype.enable = require('./enable');\nJob.prototype.unique = require('./unique');\nJob.prototype.schedule = require('./schedule');\nJob.prototype.priority = require('./priority');\nJob.prototype.fail = require('./fail');\nJob.prototype.run = require('./run');\nJob.prototype.isRunning = require('./is-running');\nJob.prototype.save = require('./save');\nJob.prototype.remove = require('./remove');\nJob.prototype.touch = require('./touch');\n\nmodule.exports = Job;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/index.js\n// module id = 18\n// module chunks = 0","module.exports = require(\"date.js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"date.js\"\n// module id = 19\n// module chunks = 0","'use strict';\nconst Job = require('../job');\n\n/**\n * Create Job object from data\n * @param {Object} agenda instance of Agenda\n * @param {Object} jobData job data\n * @returns {module.Job} returns created job\n */\nmodule.exports = (agenda, jobData) => {\n  jobData.agenda = agenda;\n  return new Job(jobData);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/utils/create-job.js\n// module id = 20\n// module chunks = 0","module.exports = require(\"opentok\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok\"\n// module id = 21\n// module chunks = 0","// journey_space.js -- The main state machine representing what is going on\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\nimport mongoose, {Schema} from 'mongoose';\nimport statemachine from 'another-mongoose-statemachine';\nimport moment from 'moment';\n\nconst FlagSchema = new Schema({\n  user: {type: String},\n  reason: {type: String},\n  flagged: {type: String},\n});\n\nconst JourneySpaceSchema = new Schema({\n  room: {type: String, index: true},\n  name: {type: String, index: true},\n  image: {type: String},\n  currentTime: {type: Number},\n  sessionId: {type: String, index: true},\n  journey: {type: String, default: '/journeys/Journey to A Spiderweb+Music.mp3'},\n  startAt: {type: Date},\n  owner: {type: String}, // a user session id, for now\n  flags: {type: [FlagSchema], default: []},\n}, {\n  timestamps: true\n});\n\nJourneySpaceSchema.plugin(statemachine, {\n  states: {\n    created: {default: true},\n    joined: {},\n    started: {},\n    paused: {},\n    completed: {},\n    ended: {},\n    expired: {},\n    failed: {},\n  },\n  transitions: {\n    joined: { from: 'created', to: 'joined' },\n    start: { from: ['joined', 'created', 'failed', 'paused'], to: 'started' },\n    pause: { from: ['started'], to: 'paused' },\n    fail: { from: ['joined', 'created'], to: 'failed' },\n    complete: { from: ['started', 'created'], to: 'completed' },\n    end: { from: '*', to: 'ended' },\n    expire: { from: '*', to: 'expired' },\n    reset: { from: '*', to: 'created' }\n  }\n});\n\nJourneySpaceSchema.methods.skip = async function() {\n  switch(this.state) {\n    case 'joined':\n      await this.start();\n      break;\n    case 'started':\n      await this.complete();\n      break;\n    case 'completed':\n      await this.end();\n      break;\n    case 'ended':\n      await this.expire();\n      break;\n  }\n  return;\n}\n\nconst JourneySpace = mongoose.model('JourneySpace', JourneySpaceSchema);\n\nexport default JourneySpace;\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/journey_space.js","// journey_participant.js -- A mongodb schema\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\nimport mongoose, {Schema} from 'mongoose';\n\nconst JourneyParticipantSchema = new Schema({\n  \"connectionId\": {type: String, index: true},\n  \"journeySpace\": {type: Schema.Types.ObjectId, ref: 'JourneySpace'},\n  \"ready\": {type: Boolean, default: false},\n  \"present\": {type: Boolean, default: true},\n  user: {type: String}\n});\n\nconst JourneyParticipant = mongoose.model('JourneyParticipant', JourneyParticipantSchema);\n\nexport default JourneyParticipant;\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/journey_participant.js","import mongoose, {Schema} from 'mongoose';\n\nconst JourneyRSVPSchema = new Schema({\n  journey: {type: Schema.Types.ObjectId, ref: 'JourneySpace'},\n  user: {type: String},\n});\n\nconst JourneyRSVP = mongoose.model('JourneyRSVP', JourneyRSVPSchema);\n\nexport default JourneyRSVP;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/journey_rsvp.js","// journey_content.js -- A schema for Journey Content\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\nimport mongoose, {Schema} from 'mongoose';\n\nconst JourneyContentSchema = new Schema({\n  filePath: {type: String},\n  name: {type: String},\n  image: {type: String},\n}, {\n  timestamps: true\n});\n\nconst JourneyContent = mongoose.model('JourneyContent', JourneyContentSchema);\n\nexport default JourneyContent;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./models/journey_content.js","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"prop-types\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prop-types\"\n// module id = 27\n// module chunks = 0","// header.js -- Handle title bar and so forth.\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\n\nimport React, {Component} from 'react';\nimport { view } from 'react-easy-state';\nimport state from '../state';\n\n// import logo from 'file-loader!isomorphic-loader!../../res/images/CuriousLiveLogoMark-150-300.png';\nimport logo from 'file-loader!isomorphic-loader!../../res/images/CuriousLive-logo.png';\n\n\nclass LeaveRoomButton extends Component {\n\n  onLeave = (e) => {\n    e.preventDefault();\n    if (!state.audioTag.paused) {\n      state.audioTag.pause();\n    }\n    this.props.history.push('/');            \n  }\n\n  render() {\n    return (\n\t    <button onClick={this.onLeave}\n\tstyle={{backgroundColor: 'rgb(250,188,91)', borderStyle: 'none'}}\t\n\t    >\n\t    <i className=\"fa fa-home\" style={{color: 'white',backgroundColor: 'rgb(75,176,88)', borderRadius: '50%', padding: '8px', fontSize: '24px'}}></i></button>\n    )\n  }\n}\n\n\nclass Header extends React.Component {\n    constructor(props) {\n\tsuper(props);\n    }\n    \n    render() {\n\treturn (\n\t<div  className=\"header\">\n                  <div style={{padding: '10px'}}>\n\t\t</div>\n\t\t{ this.props.showLeave && \n\t\t  <LeaveRoomButton history={this.props.history}/> }\n    <img className=\"logo\" src={logo}/>\n\t\t{/*    {state.journey && !state.journey.startAt &&\n     <h2 style={{color: 'white'}}>{state.journey.name}</h2>\n    }\n\t\t */}\n    {false && state.loggedIn && state.user &&\n      <div>\n        <span className='mr-2 text-secondary'>logged in as {state.user.name}</span>\n        <a href='/api/logout'>Logout</a>\n      </div>\n    }\n  </div>\n\t)}\n}\n\nexport default view(Header);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/header.js","module.exports = require(\"react-swipeable-views\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-swipeable-views\"\n// module id = 29\n// module chunks = 0","import React, {Component} from 'react';\n\nclass JourneyStartsIn extends Component {\n\n  constructor(props) {\n    super(props);\n    if (props.timer) {\n      props.timer.on('tick', (current) => {\n        this.setState({\n          timerValue: current\n        });\n      });\n    }\n  }\n\n  componentWillReceiveProps(newProps) {\n    if (newProps.timer) {\n      newProps.timer.on('tick', (current) => {\n        this.setState({\n          timerValue: current\n        });\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.props.timer) {\n      this.props.timer.clear();\n    }\n  }\n\n  render() {\n    const {journey} = this.props;\n    return (\n      <div className='journey-starts-in' style={{padding: '10px 10px 10px', borderBottom: '1px solid rgb(88, 88, 88)'}}>\n        { this.props.timer &&\n          <div style={{display: 'flex'}}>\n            <span className='label'>Journey starts in:</span>\n            <span className='time' style={{marginLeft: 'auto'}}>{this.props.timer.displayTime()}</span>\n          </div>\n        }\n      </div>\n    )\n  }\n}\n\nexport default JourneyStartsIn;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/journey_starts_in.js","import React, {Component} from 'react';\nimport { Route, Redirect, Switch, Link } from 'react-router-dom';\nimport { withRouter } from 'react-router';\nimport { view } from 'react-easy-state';\nimport SwipeableViews from 'react-swipeable-views';\nimport Cookie from 'js-cookie';\nimport state from '../state';\nimport JourneyStartsIn from './journey_starts_in';\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\nif (__CLIENT__) {\n\tvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n\tconst OT = require('@opentok/client');\n\twindow.state = state;\n}\n\nclass Intro extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      streams: [],\n      views: [\n        <div className='intro-screen'>\n          <h3>1. Welcome to CuriousLive&hellip; A five-minute guided journey &ndash; plus sharing &ndash; with others.</h3>\n          <p>\n            You are now in the JourneySpace and the\n            journey will begin shortly when the timer\n            above elapses and you hear the chime.\n          </p>\n          <p>\n            If more spots are available for this journey,\n            we invite you to invite a friend to two… use\n            the INVITE FRIENDS button.\n          </p>\n          <p>\n            Then we’ll mute your microphones and for\n            five minutes and you’ll hear your Journey\n            Guide taking you on the journey.\n          </p>\n          <p>\n            The goal is relaxation and joy, so settle in\n            by breathing slowly and deeply and adjust\n            your posture to be comfortable.\n          </p>\n        </div>,\n\n        <div className='intro-screen'>\n          <h3>2. Next comes the Journey&hellip;</h3>\n          <p>\n            The CuriousLive&trade; experience is\n            intentionally short so busy people can find\n            the time to do it regularly. That's when you\n            get the real benefits.\n          </p>\n          <p>\n            CuriousLive Journeys are captured Live\n            and Unplugged, never scripted. Your\n            Journey Guide will help you relax into the\n            JourneySpace and go deep into the Journey.\n          </p>\n          <p>\n            Your microphone will be automatically\n            muted.\n            <br/>\n            Some people like to leave their cameras on\n            during the journey to increase the feeling\n            of a shared experience. It is up to you.\n          </p>\n        </div>,\n\n        <div className='intro-screen'>\n          <h3>3. After the Journey comes the Sharing and Connecting.</h3>\n          <p>\n            Now you’ll have the opportunity to briefly\n            share with others your insights and\n            experience. Each person takes 1 or 2\n            minutes.\n          </p>\n          <p>\n            When you’re ready, click on the “Share”\n            button to start your Share. Go deep. Drop\n            in to your insights and intuitions and o!er\n            the others something special about your\n            experience.\n          </p>\n          <p>\n            And when others are sharing, please listen\n            deeply, and in turn they will listen more\n            deeply to you.\n          </p>\n        </div>,\n\n        <div className='intro-screen'>\n          <h3>4. How was your experience? We Love Feedback from Our Community.</h3>\n          <p>\n            We welcome your feedback about the\n            process and the Wacuri Method even\n            after the group experience. Please take\n            a moment to rate your experience and\n            give us your valuable feedback.\n          </p>\n        </div>\n      \n      ],\n      index: 0\n    }\n  }\n\n  goTo = (index) => {\n    this.setState({\n      index: index\n    });\n  }\n\n  onChangeIndex = (index, last, {reason}) => {\n    this.setState({\n      index: index\n    });\n  }\n\n  onSkip = (e) => {\n    e.preventDefault();\n    this.props.onClose();\n  }\n\n  componentDidMount() {\n    Cookie.set('saw intro', true, {expires: 365});\n\n    if (this.props.match.params.room) {\n      fetch(`/api/journeys/${this.props.match.params.room}${window.location.search}`, {credentials: 'include'})\n        .then(res => res.json())\n        .then(json => {\n          state.journey = json;\n          this.sessionHelper = createSession({\n            apiKey: state.openTokKey,\n            sessionId: state.journey.sessionId,\n            token: state.journey.token,\n            onConnect: () => {\n            },\n            onStreamsUpdated: streams => {\n              this.setState({ streams });\n            }\n          });\n        });\n    }\n  }\n\n  get journeySpaceOwnerVideoStream() {\n    if (state.journey) {\n      const owner = state.journey.owner;\n      const participant = state.journey.participants.find(p => p.user === owner);\n      if (state.sessionId === owner) {\n        return null;\n      } else {\n        const stream = this.state.streams.find(s => s.connection.id === participant.connectionId);\n        return stream;\n      }\n    }\n    return null;\n  }\n\n  render() {\n    return (\n      <div className='intro-wrapper'>\n        <div className='intro' style={{minHeight: 'calc(100vh - 46px)', position: 'relative', display: 'flex', flexDirection: 'column', backgroundColor: 'rgb(81, 148, 220)', padding: '20px'}}>\n          {state.journey &&\n            <div>\n              <div style={{display: 'flex', alignItems: 'baseline'}}>\n                <h2 style={{margin: 0}}>{state.journey.name}</h2>\n                <div style={{marginLeft: 'auto', display: 'flex'}}>\n                  <JourneyStartsIn journey={this.props.journey} timer={this.props.timer}/>\n                </div>\n              </div>\n              \n              <div style={{justifyContent: 'center', display: 'flex'}}>\n                <img style={{height: '150px'}} src={state.journey.image}/>\n                {this.sessionHelper && this.journeySpaceOwnerVideoStream && \n                  <OTSubscriber\n                    session={this.sessionHelper.session}\n                    stream={this.journeySpaceOwnerVideoStream}\n                    properties={{\n                      width: '150px',\n                      height: '150px',\n                    }}\n                  />\n                }\n              </div>\n            </div>\n          }\n          \n          <SwipeableViews onChangeIndex={this.onChangeIndex} index={this.state.index} enableMouseEvents ref={swipeable => this.swipeable = swipeable}>\n            {this.state.views}\n          </SwipeableViews>\n          <ul className='dots' style={{alignSelf: 'center', listStyle: 'none', padding: 0, margin: 'auto 0 0 0', display: 'flex'}}>\n            {this.state.views.map((view, i) => (\n              <li style={{marginRight: '10px', cursor: 'pointer'}} onClick={() => this.goTo(i)} className={this.state.index === i ? 'active' : ''}><span className='dot'></span></li>\n            ))}\n          </ul>\n          <a href='#' className='intro-skip' onClick={this.onSkip}>{this.state.index === this.state.views.length - 1 ? 'Begin Journey!' : 'skip'}</a>\n        </div>\n        <div className='intro-next'>\n          {this.props.children}\n        </div>\n      </div>\n    )\n      \n  }\n\n}\n\nexport default view(Intro);\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/intro.js","// utility.js -- This is needed to do some reposition in javascript\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\n\nexport var ONE_SQUARE_WIDTH = 0;\nexport var LANDSCAPE_NOT_PORTRAIT = true;\n    // Our basic design is to make sure that two sqares fit in\n    // the view port (not counting the header), arranged either\n    // vertically for portrait mode or horiontally for landscape.\nexport function setSizes() {\n\n    var tb_and_h = document.getElementById(\"topbar_and_header\");\n    if (!tb_and_h) { // if we can't find an element, we are on the wrong page\n\treturn;\n    }\n    \n\n    var debug = 0;\n    \n\tvar w = window.innerWidth;\n    var h = window.innerHeight;\n    if (debug) console.log(w,h);\n\t// TODO: this should actually be pulled from the header height\n    var headerHeight = tb_and_h.offsetHeight;\n    var h = h - headerHeight;\n\n    // one square width...\n    var osw = Math.min(Math.max(w,h)/2,Math.min(w,h));\n\n    var LANDSCAPE_NOT_PORTRAIT = w > h;\n    ONE_SQUARE_WIDTH = osw;\n\n    if (debug) console.log(osw);\n    \n    var osw_h = osw/2;\n\n    // The square frame\n    var sf = document.getElementById(\"bigsquares\");\n    sf.style.display = \"flex\";\n    sf.style.flexFlow = (w >= h) ? \"row wrap\" : \"column wrap\";\n    if (debug) console.log(\"flex flow\",sf.style.flexFlow);\n    \n    var square2 = document.getElementById(\"secondsquare\");\n    square2.style.width = osw+\"px\";\n    square2.style.maxWidth = osw+\"px\";    \n\n\t// video-square0 is the Thumbnail\n\t// video-square4 is the empty one\n\tvar s0 = document.getElementById(\"video-square0\");\n\tvar s1 = document.getElementById(\"video-square1\");\n\tvar s2 = document.getElementById(\"video-square2\");\n\tvar s3 = document.getElementById(\"video-square3\");\n    var s4 = document.getElementById(\"video-square4\");\n\tvar jt = document.getElementById(\"journey-timeline0\");        \n\n\ts0.style.height = osw+\"px\";\n\ts0.style.width = osw+\"px\";\n\t\n\ts1.style.height = osw_h+\"px\";\n\ts2.style.height = osw_h+\"px\";\n\ts3.style.height = osw_h+\"px\";\n\ts4.style.height = osw_h+\"px\";    \n\n\n\ts1.style.width = osw_h+\"px\";\n\ts2.style.width = osw_h+\"px\";\n\ts3.style.width = osw_h+\"px\";\n        s4.style.width = osw_h+\"px\";\n\n    // This is fragile and stupid, i need to do better.\n    jt.style.width = (osw-40)+\"px\";\n\n    \n    var tb = document.getElementById(\"titlebar\");\n\n    console.log(\"landsacpeNotPortrait\",LANDSCAPE_NOT_PORTRAIT);\n    tb.style.maxWidth = ((LANDSCAPE_NOT_PORTRAIT ) ? osw*2 : osw)+\"px\";\n\n    }\n\n\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/utility/utility.js","module.exports = require(\"babel-polyfill/lib/index\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill/lib/index\"\n// module id = 34\n// module chunks = 0","const dotenv = require('dotenv');\n\ndotenv.config();\nglobal.__CLIENT__ = false;\nglobal.__SERVER__ = true;\n\nvar extendRequire = require(\"isomorphic-loader/lib/extend-require\");\n\nrequire('./jobs');\n\nextendRequire().then(function () {\n    require(\"./routes\");\n}).catch(function (err) {\n    console.log(err);\n});\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","module.exports = require(\"isomorphic-loader/lib/extend-require\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-loader/lib/extend-require\"\n// module id = 36\n// module chunks = 0","import fs from 'fs';\nimport path from 'path';\nimport Agenda from 'Agenda';\nimport _ from 'lodash';\nimport OpenTok from 'opentok';\nimport moment from 'moment';\nimport mongoose from 'mongoose';\nimport JourneySpace from '../models/journey_space';\nimport JourneyParticipant from '../models/journey_participant';\nimport JourneyRSVP from '../models/journey_rsvp';\nimport JourneyContent from '../models/journey_content';\n\nconst agenda = new Agenda({db: {address: process.env.MONGODB_URI || process.env.MONGO_URL}});\nconst opentok = new OpenTok(process.env.OPENTOK_KEY, process.env.OPENTOK_SECRET);\nconst db = mongoose.connection;\n\nvar offset = 0;\nagenda.define('create journey space', async function(job, done) {\n  try {\n    const total = await db.collection('journeycontents').countDocuments();\n    const randomJourney = (await db.collection('journeycontents').find().skip(offset++ % total).limit(1).toArray())[0];\n    const journeySpace = new JourneySpace({\n      journey: randomJourney.filePath,\n      name: randomJourney.name,\n      image: randomJourney.image,\n      room: `${randomJourney.name.toLowerCase().replace(/[^a-z]/ig, '-')}-${(new Date()).getTime()}`,\n      startAt: moment().add(10, 'minutes').toDate()\n    });\n    await journeySpace.save();\n    await agenda.schedule(journeySpace.startAt, 'start journey', {journey: journeySpace._id});\n    const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n    if (globalSpace) {\n      const response = journeySpace.toJSON();\n      response.participants = [];\n      opentok.signal(globalSpace.sessionId, null, { 'type': 'createdNewJourney', 'data': JSON.stringify(response) }, done);\n    } else {\n      done();\n    }\n  } catch(e) {\n    console.log(e);\n    done(e);\n  }\n});\n\nagenda.define('clear expired journeys', async function(job, done) {\n  try {\n    const expiredJourneys = await JourneySpace.find({state: 'created', startAt: {$lt: moment().subtract(1, 'minutes')}}).exec();\n    const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n    for (let journey of expiredJourneys) {\n      await journey.expire();\n      if (globalSpace) {\n        opentok.signal(globalSpace.sessionId, null, { 'type': 'expiredJourney', 'data': JSON.stringify(journey) }, () => {});\n      }\n    }\n    done();\n  } catch(e) {\n    console.log(e);\n    done(e);\n  }\n});\n\nagenda.define('start journey', async function(job, done) {\n  try {\n    const {journey} = job.attrs.data;\n    const journeySpace = await JourneySpace.findById(journey).exec();\n    const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n    const participants = await JourneyParticipant.find({journeySpace: journeySpace._id, present: true}).exec();\n    if (participants.length > 1) {\n      await journeySpace.start();\n      opentok.signal(journeySpace.sessionId, null, { 'type': 'startJourney', 'data': JSON.stringify({journey}) }, () => {});\n    } else {\n      await journeySpace.fail();\n      opentok.signal(journeySpace.sessionId, null, { 'type': 'failJourney', 'data': JSON.stringify({journey}) }, () => {});\n      opentok.signal(globalSpace.sessionId, null, { 'type': 'failJourney', 'data': JSON.stringify(journeySpace.toJSON()) }, () => {});\n    }\n    done();\n  } catch(e) {\n    done(e);\n  }\n});\n\n\nagenda.on('ready', function() {\n  agenda.every('1 minute', 'create journey space');\n  agenda.every('1 minute', 'clear expired journeys');\n\n  agenda.start();\n});\n\n\n\n\n// WEBPACK FOOTER //\n// ./jobs/index.js","const Agenda = require('./lib/agenda');\n\nmodule.exports = Agenda;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/index.js\n// module id = 38\n// module chunks = 0","'use strict';\n/**\n * General Notes:\n * - Refactor remaining deprecated MongoDB Native Driver methods: findAndModify()\n */\n\nconst Emitter = require('events').EventEmitter;\nconst humanInterval = require('human-interval');\n\nclass Agenda extends Emitter {\n  constructor(config, cb) {\n    super();\n\n    if (!(this instanceof Agenda)) {\n      return new Agenda(config);\n    }\n\n    config = config || {};\n\n    this._name = config.name;\n    this._processEvery = humanInterval(config.processEvery) || humanInterval('5 seconds');\n    this._defaultConcurrency = config.defaultConcurrency || 5;\n    this._maxConcurrency = config.maxConcurrency || 20;\n    this._defaultLockLimit = config.defaultLockLimit || 0;\n    this._lockLimit = config.lockLimit || 0;\n    this._definitions = {};\n    this._runningJobs = [];\n    this._lockedJobs = [];\n    this._jobQueue = [];\n    this._defaultLockLifetime = config.defaultLockLifetime || 10 * 60 * 1000; // 10 minute default lockLifetime\n    this._sort = config.sort || {nextRunAt: 1, priority: -1};\n    this._indices = Object.assign({name: 1}, this._sort, {priority: -1, lockedAt: 1, nextRunAt: 1, disabled: 1});\n\n    this._isLockingOnTheFly = false;\n    this._jobsToLock = [];\n    if (config.mongo) {\n      this.mongo(config.mongo, config.db ? config.db.collection : undefined, cb);\n    } else if (config.db) {\n      this.database(config.db.address, config.db.collection, config.db.options, cb);\n    }\n  }\n}\n\nAgenda.prototype.mongo = require('./mongo');\nAgenda.prototype.database = require('./database');\nAgenda.prototype.db_init = require('./db-init'); // eslint-disable-line camelcase\nAgenda.prototype.name = require('./name');\nAgenda.prototype.processEvery = require('./process-every');\nAgenda.prototype.maxConcurrency = require('./max-concurrency');\nAgenda.prototype.defaultConcurrency = require('./default-concurrency');\nAgenda.prototype.lockLimit = require('./locklimit');\nAgenda.prototype.defaultLockLimit = require('./default-lock-limit');\nAgenda.prototype.defaultLockLifetime = require('./default-lock-lifetime');\nAgenda.prototype.sort = require('./sort');\nAgenda.prototype.create = require('./create');\nAgenda.prototype.jobs = require('./jobs');\nAgenda.prototype.purge = require('./purge');\nAgenda.prototype.define = require('./define');\nAgenda.prototype.every = require('./every');\nAgenda.prototype.schedule = require('./schedule');\nAgenda.prototype.now = require('./now');\nAgenda.prototype.cancel = require('./cancel');\nAgenda.prototype.saveJob = require('./save-job');\nAgenda.prototype.start = require('./start');\nAgenda.prototype.stop = require('./stop');\nAgenda.prototype._findAndLockNextJob = require('./find-and-lock-next-job');\n\nmodule.exports = Agenda;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/index.js\n// module id = 39\n// module chunks = 0","'use strict';\n\n/**\n * Build method used to add MongoDB connection details\n * @param {MongoClient} mdb instance of MongoClient to use\n * @param {String} collection name collection we want to use ('agendaJobs')\n * @param {Function} cb called when MongoDB connection fails or passes\n * @returns {exports} instance of Agenda\n */\nmodule.exports = function(mdb, collection, cb) {\n  this._mdb = mdb;\n  this.db_init(collection, cb);\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/mongo.js\n// module id = 40\n// module chunks = 0","'use strict';\nconst MongoClient = require('mongodb').MongoClient;\nconst debug = require('debug')('agenda:database');\n\n/**\n * Connect to the spec'd MongoDB server and database.\n * @param {String} url MongoDB server URI\n * @param {String} collection name of collection to use\n * @param {Object} options options for connecting\n * @param {Function} cb callback of MongoDB connection\n * @returns {exports}\n * NOTE:\n * If `url` includes auth details then `options` must specify: { 'uri_decode_auth': true }. This does Auth on\n * the specified database, not the Admin database. If you are using Auth on the Admin DB and not on the Agenda DB,\n * then you need to authenticate against the Admin DB and then pass the MongoDB instance into the constructor\n * or use Agenda.mongo(). If your app already has a MongoDB connection then use that. ie. specify config.mongo in\n * the constructor or use Agenda.mongo().\n */\nmodule.exports = function(url, collection, options, cb) {\n  const self = this;\n  if (!url.match(/^mongodb:\\/\\/.*/)) {\n    url = 'mongodb://' + url;\n  }\n\n  collection = collection || 'agendaJobs';\n  options = Object.assign({autoReconnect: true, reconnectTries: Number.MAX_SAFE_INTEGER, reconnectInterval: this._processEvery}, options);\n  MongoClient.connect(url, options, (error, db) => {\n    if (error) {\n      debug('error connecting to MongoDB using collection: [%s]', collection);\n      if (cb) {\n        cb(error, null);\n      } else {\n        throw error;\n      }\n      return;\n    }\n    debug('successful connection to MongoDB using collection: [%s]', collection);\n    self._mdb = db;\n    self.db_init(collection, cb);\n  });\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/database.js\n// module id = 41\n// module chunks = 0","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 42\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:db_init');\n\n/**\n * Internal method called in the case where new indices have an error during creation\n * @param {Error} err error returned from index creation from before\n * @param {*} result result passed in from earlier attempt of creating index\n * @param {Agenda} self instance of Agenda\n * @param {Function} cb called when indices fail or pass\n * @returns {undefined}\n */\nconst handleLegacyCreateIndex = (err, result, self, cb) => {\n  if (err && err.message !== 'no such cmd: createIndex') {\n    debug('not attempting legacy index, emitting error');\n    self.emit('error', err);\n  } else {\n    // Looks like a mongo.version < 2.4.x\n    err = null;\n    self._collection.ensureIndex(self._indices, {\n      name: 'findAndLockNextJobIndex'\n    });\n    self.emit('ready');\n  }\n  if (cb) {\n    cb(err, self._collection);\n  }\n};\n\n/**\n * Setup and initialize the collection used to manage Jobs.\n * @param {String} collection name or undefined for default 'agendaJobs'\n * @param {Function} cb called when the db is initialized\n * @returns {undefined}\n */\nmodule.exports = function(collection, cb) {\n  const self = this;\n  debug('init database collection using name [%s]', collection);\n  this._collection = this._mdb.collection(collection || 'agendaJobs');\n  debug('attempting index creation');\n  this._collection.createIndex(this._indices, {\n    name: 'findAndLockNextJobIndex'\n  }, (err, result) => {\n    if (err) {\n      debug('index creation failed, attempting legacy index creation next');\n    } else {\n      debug('index creation success');\n    }\n    handleLegacyCreateIndex(err, result, self, cb);\n  });\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/db-init.js\n// module id = 43\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:name');\n\n/**\n * Set name of queue\n * @param {String} name name of agenda instance\n * @returns {exports} agenda instance\n */\nmodule.exports = function(name) {\n  debug('Agenda.name(%s)', name);\n  this._name = name;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/name.js\n// module id = 44\n// module chunks = 0","'use strict';\nconst humanInterval = require('human-interval');\nconst debug = require('debug')('agenda:processEvery');\n\n/**\n * Set the default process interval\n * @param {Number} time time to process\n * @returns {exports} agenda instance\n */\nmodule.exports = function(time) {\n  debug('Agenda.processEvery(%d)', time);\n  this._processEvery = humanInterval(time);\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/process-every.js\n// module id = 45\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:maxConcurrency');\n\n/**\n * Set the concurrency for jobs (globally), type does not matter\n * @param {Number} num max concurrency value\n * @returns {exports} agenda instance\n */\nmodule.exports = function(num) {\n  debug('Agenda.maxConcurrency(%d)', num);\n  this._maxConcurrency = num;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/max-concurrency.js\n// module id = 46\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:defaultConcurrency');\n\n/**\n * Set the default concurrency for each job\n * @param {Number} num default concurrency\n * @returns {exports} agenda instance\n */\nmodule.exports = function(num) {\n  debug('Agenda.defaultConcurrency(%d)', num);\n  this._defaultConcurrency = num;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/default-concurrency.js\n// module id = 47\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:locklimit');\n\n/**\n * Set the default amount jobs that are allowed to be locked at one time (GLOBAL)\n * NOTE: Is this different than max concurrency?\n * @param {Number} num Lock limit\n * @returns {exports} agenda instance\n */\nmodule.exports = function(num) {\n  debug('Agenda.lockLimit(%d)', num);\n  this._lockLimit = num;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/locklimit.js\n// module id = 48\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:defaultLockLimit');\n\n/**\n * Set default lock limit per job type\n * @param {Number} num Lock limit per job\n * @returns {exports} agenda instance\n */\nmodule.exports = function(num) {\n  debug('Agenda.defaultLockLimit(%d)', num);\n  this._defaultLockLimit = num;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/default-lock-limit.js\n// module id = 49\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:defaultLockLifetime');\n\n/**\n * Set the default lock time (in ms)\n * Default is 10 * 60 * 1000 ms (10 minutes)\n * @param {Number} ms time in ms to set default lock\n * @returns {exports} agenda instance\n */\nmodule.exports = function(ms) {\n  debug('Agenda.defaultLockLifetime(%d)', ms);\n  this._defaultLockLifetime = ms;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/default-lock-lifetime.js\n// module id = 50\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:sort');\n\n/**\n * Set the sort query for finding next job\n * Default is { nextRunAt: 1, priority: -1 }\n * @param {Object} query sort query object for MongoDB\n * @returns {exports} agenda instance\n */\nmodule.exports = function(query) {\n  debug('Agenda.sort([Object])');\n  this._sort = query;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/sort.js\n// module id = 51\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:create');\nconst Job = require('../job');\n\n/**\n * Given a name and some data, create a new job\n * @param {String} name name of job\n * @param {Object} data data to set for job\n * @access protected\n * @returns {module.Job} instance of new job\n */\nmodule.exports = function(name, data) {\n  debug('Agenda.create(%s, [Object])', name);\n  const priority = this._definitions[name] ? this._definitions[name].priority : 0;\n  const job = new Job({name, data, type: 'normal', priority, agenda: this});\n  return job;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/create.js\n// module id = 52\n// module chunks = 0","'use strict';\n\n/**\n * Given a job, turn it into an object we can store in Mongo\n * @returns {Object} json object from Job\n */\nmodule.exports = function() {\n  const self = this;\n  const attrs = self.attrs || {};\n  const result = {};\n\n  for (const prop in attrs) {\n    if ({}.hasOwnProperty.call(attrs, prop)) {\n      result[prop] = attrs[prop];\n    }\n  }\n\n  const dates = ['lastRunAt', 'lastFinishedAt', 'nextRunAt', 'failedAt', 'lockedAt'];\n  dates.forEach(d => {\n    if (result[d]) {\n      result[d] = new Date(result[d]);\n    }\n  });\n\n  return result;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/to-json.js\n// module id = 53\n// module chunks = 0","'use strict';\nconst humanInterval = require('human-interval');\nconst CronTime = require('cron').CronTime;\nconst moment = require('moment-timezone');\nconst date = require('date.js');\nconst debug = require('debug')('agenda:job');\n\n/**\n * Internal method used to compute next time a job should run and sets the proper values\n * @returns {exports} instance of Job instance\n */\nmodule.exports = function() {\n  const interval = this.attrs.repeatInterval;\n  const timezone = this.attrs.repeatTimezone;\n  const repeatAt = this.attrs.repeatAt;\n  this.attrs.nextRunAt = undefined;\n\n  const dateForTimezone = date => {\n    date = moment(date);\n    if (timezone !== null) {\n      date.tz(timezone);\n    }\n    return date;\n  };\n\n  /**\n   * Internal method that computes the interval\n   * @returns {undefined}\n   */\n  const computeFromInterval = () => {\n    debug('[%s:%s] computing next run via interval [%s]', this.attrs.name, this.attrs._id, interval);\n    let lastRun = this.attrs.lastRunAt || new Date();\n    lastRun = dateForTimezone(lastRun);\n    try {\n      const cronTime = new CronTime(interval);\n      let nextDate = cronTime._getNextDateFrom(lastRun);\n      if (nextDate.valueOf() === lastRun.valueOf()) {\n        // Handle cronTime giving back the same date for the next run time\n        nextDate = cronTime._getNextDateFrom(dateForTimezone(new Date(lastRun.valueOf() + 1000)));\n      }\n      this.attrs.nextRunAt = nextDate;\n      debug('[%s:%s] nextRunAt set to [%s]', this.attrs.name, this.attrs._id, this.attrs.nextRunAt.toISOString());\n    } catch (e) {\n      // Nope, humanInterval then!\n      try {\n        if (!this.attrs.lastRunAt && humanInterval(interval)) {\n          this.attrs.nextRunAt = lastRun.valueOf();\n          debug('[%s:%s] nextRunAt set to [%s]', this.attrs.name, this.attrs._id, this.attrs.nextRunAt.toISOString());\n        } else {\n          this.attrs.nextRunAt = lastRun.valueOf() + humanInterval(interval);\n          debug('[%s:%s] nextRunAt set to [%s]', this.attrs.name, this.attrs._id, this.attrs.nextRunAt.toISOString());\n        }\n      } catch (e) {}\n    } finally {\n      if (isNaN(this.attrs.nextRunAt)) {\n        this.attrs.nextRunAt = undefined;\n        debug('[%s:%s] failed to calculate nextRunAt due to invalid repeat interval', this.attrs.name, this.attrs._id);\n        this.fail('failed to calculate nextRunAt due to invalid repeat interval');\n      }\n    }\n  };\n\n  /**\n   * Internal method to compute next run time from the repeat string\n   * @returns {undefined}\n   */\n  function computeFromRepeatAt() {\n    const lastRun = this.attrs.lastRunAt || new Date();\n    const nextDate = date(repeatAt).valueOf();\n\n    // If you do not specify offset date for below test it will fail for ms\n    const offset = Date.now();\n    if (offset === date(repeatAt, offset).valueOf()) {\n      this.attrs.nextRunAt = undefined;\n      debug('[%s:%s] failed to calculate repeatAt due to invalid format', this.attrs.name, this.attrs._id);\n      this.fail('failed to calculate repeatAt time due to invalid format');\n    } else if (nextDate.valueOf() === lastRun.valueOf()) {\n      this.attrs.nextRunAt = date('tomorrow at ', repeatAt);\n      debug('[%s:%s] nextRunAt set to [%s]', this.attrs.name, this.attrs._id, this.attrs.nextRunAt.toISOString());\n    } else {\n      this.attrs.nextRunAt = date(repeatAt);\n      debug('[%s:%s] nextRunAt set to [%s]', this.attrs.name, this.attrs._id, this.attrs.nextRunAt.toISOString());\n    }\n  }\n\n  if (interval) {\n    computeFromInterval.call(this);\n  } else if (repeatAt) {\n    computeFromRepeatAt.call(this);\n  }\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/compute-next-run-at.js\n// module id = 54\n// module chunks = 0","module.exports = require(\"cron\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cron\"\n// module id = 55\n// module chunks = 0","module.exports = require(\"moment-timezone\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment-timezone\"\n// module id = 56\n// module chunks = 0","'use strict';\n\n/**\n * Sets a job to repeat every X amount of time\n * @param {String} interval repeat every X\n * @param {Object} options options to use for job\n * @returns {exports} instance of Job\n */\nmodule.exports = function(interval, options) {\n  options = options || {};\n  this.attrs.repeatInterval = interval;\n  this.attrs.repeatTimezone = options.timezone ? options.timezone : null;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/repeat-every.js\n// module id = 57\n// module chunks = 0","'use strict';\n\n/**\n * Sets a job to repeat at a specific time\n * @param {String} time time to repeat job at (human readable or number)\n * @returns {exports} instance of Job\n */\nmodule.exports = function(time) {\n  this.attrs.repeatAt = time;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/repeat-at.js\n// module id = 58\n// module chunks = 0","'use strict';\n\n/**\n * Prevents the job type from running\n * @returns {exports} instance of Job\n */\nmodule.exports = function() {\n  this.attrs.disabled = true;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/disable.js\n// module id = 59\n// module chunks = 0","'use strict';\n\n/**\n * Allows job type to run\n * @returns {exports} instance of Job\n */\nmodule.exports = function() {\n  this.attrs.disabled = false;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/enable.js\n// module id = 60\n// module chunks = 0","'use strict';\n\n/**\n * Data to ensure is unique for job to be created\n * @param {Object} unique mongo data query for unique\n * @param {Object} opts unique options\n * @returns {exports} instance of Job\n */\nmodule.exports = function(unique, opts) {\n  this.attrs.unique = unique;\n  this.attrs.uniqueOpts = opts;\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/unique.js\n// module id = 61\n// module chunks = 0","'use strict';\nconst date = require('date.js');\n\n/**\n * Schedules a job to run at specified time\n * @param {String} time schedule a job to run \"then\"\n * @returns {exports} instance of Job\n */\nmodule.exports = function(time) {\n  this.attrs.nextRunAt = (time instanceof Date) ? time : date(time);\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/schedule.js\n// module id = 62\n// module chunks = 0","'use strict';\n\n/**\n * Internal method to turn priority into a number\n * @param {String|Number} priority string to parse into number\n * @returns {Number} priority that was parsed\n */\nconst parsePriority = priority => {\n  const priorityMap = {\n    lowest: -20,\n    low: -10,\n    normal: 0,\n    high: 10,\n    highest: 20\n  };\n  if (typeof priority === 'number' || priority instanceof Number) {\n    return priority;\n  }\n  return priorityMap[priority];\n};\n\n/**\n * Sets priority of the job\n * @param {String} priority priority of when job should be queued\n * @returns {exports} instance of Job\n */\nmodule.exports = function(priority) {\n  this.attrs.priority = parsePriority(priority);\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/priority.js\n// module id = 63\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:job');\n\n/**\n * Fails the job with a reason (error) specified\n * @param {Error|String} reason reason job failed\n * @returns {exports} instance of Job\n */\nmodule.exports = function(reason) {\n  if (reason instanceof Error) {\n    reason = reason.message;\n  }\n  this.attrs.failReason = reason;\n  this.attrs.failCount = (this.attrs.failCount || 0) + 1;\n  const now = new Date();\n  this.attrs.failedAt = now;\n  this.attrs.lastFinishedAt = now;\n  debug('[%s:%s] fail() called [%d] times so far', this.attrs.name, this.attrs._id, this.attrs.failCount);\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/fail.js\n// module id = 64\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:job');\n\n/**\n * Internal method (RUN)\n * @param {Function} cb called when job persistence in MongoDB fails or passes\n * @returns {undefined}\n */\nmodule.exports = function(cb) {\n  const self = this;\n  const agenda = self.agenda;\n  const definition = agenda._definitions[self.attrs.name];\n\n  setImmediate(() => {\n    self.attrs.lastRunAt = new Date();\n    debug('[%s:%s] setting lastRunAt to: %s', self.attrs.name, self.attrs._id, self.attrs.lastRunAt.toISOString());\n    self.computeNextRunAt();\n    self.save(() => {\n      const jobCallback = function(err) {\n        if (err) {\n          self.fail(err);\n        }\n\n        if (!err) {\n          self.attrs.lastFinishedAt = new Date();\n        }\n        self.attrs.lockedAt = null;\n        debug('[%s:%s] job finished at [%s] and was unlocked', self.attrs.name, self.attrs._id, self.attrs.lastFinishedAt);\n\n        self.save((saveErr, job) => {\n          cb && cb(err || saveErr, job);  // eslint-disable-line no-unused-expressions\n          if (err) {\n            agenda.emit('fail', err, self);\n            agenda.emit('fail:' + self.attrs.name, err, self);\n            debug('[%s:%s] failed to be saved to MongoDB', self.attrs.name, self.attrs._id);\n          } else {\n            agenda.emit('success', self);\n            agenda.emit('success:' + self.attrs.name, self);\n            debug('[%s:%s] was saved successfully to MongoDB', self.attrs.name, self.attrs._id);\n          }\n          agenda.emit('complete', self);\n          agenda.emit('complete:' + self.attrs.name, self);\n          debug('[%s:%s] job has finished', self.attrs.name, self.attrs._id);\n        });\n      };\n\n      try {\n        agenda.emit('start', self);\n        agenda.emit('start:' + self.attrs.name, self);\n        debug('[%s:%s] starting job', self.attrs.name, self.attrs._id);\n        if (!definition) {\n          debug('[%s:%s] has no definition, can not run', self.attrs.name, self.attrs._id);\n          throw new Error('Undefined job');\n        }\n        if (definition.fn.length === 2) {\n          debug('[%s:%s] process function being called', self.attrs.name, self.attrs._id);\n          definition.fn(self, jobCallback);\n        } else {\n          debug('[%s:%s] process function being called', self.attrs.name, self.attrs._id);\n          definition.fn(self);\n          jobCallback();\n        }\n      } catch (err) {\n        debug('[%s:%s] unknown error occurred', self.attrs.name, self.attrs._id);\n        jobCallback(err);\n      }\n    });\n  });\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/run.js\n// module id = 65\n// module chunks = 0","'use strict';\n\n/**\n * A job is running if:\n * (lastRunAt exists AND lastFinishedAt does not exist)\n * OR\n * (lastRunAt exists AND lastFinishedAt exists but the lastRunAt is newer [in time] than lastFinishedAt)\n * @returns {boolean} whether or not job is running at the moment (true for running)\n */\nmodule.exports = function() {\n  if (!this.attrs.lastRunAt) {\n    return false;\n  }\n  if (!this.attrs.lastFinishedAt) {\n    return true;\n  }\n  if (this.attrs.lockedAt && this.attrs.lastRunAt.getTime() > this.attrs.lastFinishedAt.getTime()) {\n    return true;\n  }\n  return false;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/is-running.js\n// module id = 66\n// module chunks = 0","'use strict';\n\n/**\n * Saves a job into the MongoDB\n * @param {Function} cb called after job is saved or errors\n * @returns {exports} instance of Job\n */\nmodule.exports = function(cb) {\n  this.agenda.saveJob(this, cb);\n  return this;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/save.js\n// module id = 67\n// module chunks = 0","'use strict';\n\n/**\n * Remove the job from MongoDB\n * @param {Function} cb called when job removal fails or passes\n * @returns {undefined}\n */\nmodule.exports = function(cb) {\n  this.agenda.cancel({_id: this.attrs._id}, cb);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/remove.js\n// module id = 68\n// module chunks = 0","'use strict';\n\n/**\n * Updates \"lockedAt\" time so the job does not get picked up again\n * @param {Function} cb called when job \"touch\" fails or passes\n * @returns {undefined}\n */\nmodule.exports = function(cb) {\n  this.attrs.lockedAt = new Date();\n  this.save(cb);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/job/touch.js\n// module id = 69\n// module chunks = 0","'use strict';\nconst utils = require('../utils');\n\nconst createJob = utils.createJob;\n\n/**\n * Finds all jobs matching 'query'\n * @param {Object} query object for MongoDB\n * @param {Function} cb called when fails or passes\n * @returns {undefined}\n */\nmodule.exports = function(query, cb) {\n  const self = this;\n  this._collection.find(query).toArray((error, result) => {\n    let jobs;\n    if (!error) {\n      jobs = result.map(createJob.bind(null, self));\n    }\n    cb(error, jobs);\n  });\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/jobs.js\n// module id = 70\n// module chunks = 0","'use strict';\n// @TODO: What should we use for internal util functions?\n//        Maybe we should use agenda:util:processJobs which would move agenda:* to agenda:agenda;*\nconst debug = require('debug')('agenda:internal:processJobs');\nconst createJob = require('./create-job');\n\n/**\n * Process methods for jobs\n * @param {module.Job} extraJob job to run immediately\n * @returns {undefined}\n */\nmodule.exports = function(extraJob) {\n  debug('starting to process jobs');\n  // Make sure an interval has actually been set\n  // Prevents race condition with 'Agenda.stop' and already scheduled run\n  if (!this._processInterval) {\n    debug('no _processInterval set when calling processJobs, returning');\n    return;\n  }\n\n  const self = this;\n  const definitions = this._definitions;\n  const jobQueue = this._jobQueue;\n  let jobName;\n\n  // Determine whether or not we have a direct process call!\n  if (!extraJob) {\n    // Go through each jobName set in 'Agenda.process' and fill the queue with the next jobs\n    for (jobName in definitions) {\n      if ({}.hasOwnProperty.call(definitions, jobName)) {\n        debug('queuing up job to process: [%s]', jobName);\n        jobQueueFilling(jobName);\n      }\n    }\n  } else if (definitions[extraJob.attrs.name]) {\n    // Add the job to list of jobs to lock and then lock it immediately!\n    debug('job [%s] was passed directly to processJobs(), locking and running immediately', extraJob.attrs.name);\n    self._jobsToLock.push(extraJob);\n    lockOnTheFly();\n  }\n\n  /**\n   * Returns true if a job of the specified name can be locked.\n   * Considers maximum locked jobs at any time if self._lockLimit is > 0\n   * Considers maximum locked jobs of the specified name at any time if jobDefinition.lockLimit is > 0\n   * @param {String} name name of job to check if we should lock or not\n   * @returns {boolean} whether or not you should lock job\n   */\n  function shouldLock(name) {\n    const jobDefinition = definitions[name];\n    let shouldLock = true;\n    if (self._lockLimit && self._lockLimit <= self._lockedJobs.length) {\n      shouldLock = false;\n    }\n    if (jobDefinition.lockLimit && jobDefinition.lockLimit <= jobDefinition.locked) {\n      shouldLock = false;\n    }\n    debug('job [%s] lock status: shouldLock = %s', name, shouldLock);\n    return shouldLock;\n  }\n\n  /**\n   * Internal method that adds jobs to be processed to the local queue\n   * @param {*} jobs Jobs to queue\n   * @param {boolean} inFront puts the job in front of queue if true\n   * @returns {undefined}\n   */\n  function enqueueJobs(jobs, inFront) {\n    if (!Array.isArray(jobs)) {\n      jobs = [jobs];\n    }\n\n    jobs.forEach(job => {\n      let jobIndex;\n      let start;\n      let loopCondition;\n      let endCondition;\n      let inc;\n\n      if (inFront) {\n        start = jobQueue.length ? jobQueue.length - 1 : 0;\n        inc = -1;\n        loopCondition = function() {\n          return jobIndex >= 0;\n        };\n        endCondition = function(queuedJob) {\n          return !queuedJob || queuedJob.attrs.priority < job.attrs.priority;\n        };\n      } else {\n        start = 0;\n        inc = 1;\n        loopCondition = function() {\n          return jobIndex < jobQueue.length;\n        };\n        endCondition = function(queuedJob) {\n          return queuedJob.attrs.priority >= job.attrs.priority;\n        };\n      }\n\n      for (jobIndex = start; loopCondition(); jobIndex += inc) {\n        if (endCondition(jobQueue[jobIndex])) {\n          break;\n        }\n      }\n\n      // Insert the job to the queue at its prioritized position for processing\n      jobQueue.splice(jobIndex, 0, job);\n    });\n  }\n\n  /**\n   * Internal method that will lock a job and store it on MongoDB\n   * This method is called when we immediately start to process a job without using the process interval\n   * We do this because sometimes jobs are scheduled but will be run before the next process time\n   * @returns {undefined}\n   */\n  function lockOnTheFly() {\n    // Already running this? Return\n    if (self._isLockingOnTheFly) {\n      debug('lockOnTheFly() already running, returning');\n      return;\n    }\n\n    // Don't have any jobs to run? Return\n    if (self._jobsToLock.length === 0) {\n      debug('no jobs to current lock on the fly, returning');\n      self._isLockingOnTheFly = false;\n      return;\n    }\n\n    // Set that we are running this\n    self._isLockingOnTheFly = true;\n\n    // Grab a job that needs to be locked\n    const now = new Date();\n    const job = self._jobsToLock.pop();\n\n    // If locking limits have been hit, stop locking on the fly.\n    // Jobs that were waiting to be locked will be picked up during a\n    // future locking interval.\n    if (!shouldLock(job.attrs.name)) {\n      debug('lock limit hit for: [%s]', job.attrs.name);\n      self._jobsToLock = [];\n      self._isLockingOnTheFly = false;\n      return;\n    }\n\n    // Query to run against collection to see if we need to lock it\n    const criteria = {\n      _id: job.attrs._id,\n      lockedAt: null,\n      nextRunAt: job.attrs.nextRunAt,\n      disabled: {$ne: true}\n    };\n\n    // Update / options for the MongoDB query\n    const update = {$set: {lockedAt: now}};\n    const options = {returnOriginal: false};\n\n    // Lock the job in MongoDB!\n    self._collection.findOneAndUpdate(criteria, update, options, (err, resp) => {\n      if (err) {\n        throw err;\n      }\n      // Did the \"job\" get locked? Create a job object and run\n      if (resp.value) {\n        const job = createJob(self, resp.value);\n        debug('found job [%s] that can be locked on the fly', job.attrs.name);\n        self._lockedJobs.push(job);\n        definitions[job.attrs.name].locked++;\n        enqueueJobs(job);\n        jobProcessing();\n      }\n\n      // Mark lock on fly is done for now\n      self._isLockingOnTheFly = false;\n\n      // Re-run in case anything is in the queue\n      lockOnTheFly();\n    });\n  }\n\n  /**\n   * Internal method used to fill a queue with jobs that can be run\n   * @param {String} name fill a queue with specific job name\n   * @returns {undefined}\n   */\n  function jobQueueFilling(name) {\n    // Don't lock because of a limit we have set (lockLimit, etc)\n    if (!shouldLock(name)) {\n      debug('lock limit reached in queue filling for [%s]', name);\n      return;\n    }\n\n    // Set the date of the next time we are going to run _processEvery function\n    const now = new Date();\n    self._nextScanAt = new Date(now.valueOf() + self._processEvery);\n\n    // For this job name, find the next job to run and lock it!\n    self._findAndLockNextJob(name, definitions[name], (err, job) => {\n      if (err) {\n        debug('[%s] job lock failed while filling queue', name);\n        throw err;\n      }\n\n      // Still have the job?\n      // 1. Add it to lock list\n      // 2. Add count of locked jobs\n      // 3. Queue the job to actually be run now that it is locked\n      // 4. Recursively run this same method we are in to check for more available jobs of same type!\n      if (job) {\n        debug('[%s:%s] job locked while filling queue', name, job.attrs._id);\n        self._lockedJobs.push(job);\n        definitions[job.attrs.name].locked++;\n        enqueueJobs(job);\n        jobQueueFilling(name);\n        jobProcessing();\n      }\n    });\n  }\n\n  /**\n   * Internal method that processes any jobs in the local queue (array)\n   * @returns {undefined}\n   */\n  function jobProcessing() {\n    // Ensure we have jobs\n    if (jobQueue.length === 0) {\n      return;\n    }\n\n    // Store for all sorts of things\n    const now = new Date();\n\n    // Get the next job that is not blocked by concurrency\n    let next;\n    for (next = jobQueue.length - 1; next > 0; next -= 1) {\n      const def = definitions[jobQueue[next].attrs.name];\n      if (def.concurrency > def.running) {\n        break;\n      }\n    }\n\n    // We now have the job we are going to process and its definition\n    const job = jobQueue.splice(next, 1)[0];\n    const jobDefinition = definitions[job.attrs.name];\n\n    debug('[%s:%s] about to process job', job.attrs.name, job.attrs._id);\n\n    // If the 'nextRunAt' time is older than the current time, run the job\n    // Otherwise, setTimeout that gets called at the time of 'nextRunAt'\n    if (job.attrs.nextRunAt < now) {\n      debug('[%s:%s] nextRunAt is in the past, run the job immediately', job.attrs.name, job.attrs._id);\n      runOrRetry();\n    } else {\n      const runIn = job.attrs.nextRunAt - now;\n      debug('[%s:%s] nextRunAt is in the future, calling setTimeout(%d)', job.attrs.name, job.attrs._id, runIn);\n      setTimeout(runOrRetry, runIn);\n    }\n\n    /**\n     * Internal method that tries to run a job and if it fails, retries again!\n     * @returns {undefined}\n     */\n    function runOrRetry() {\n      if (self._processInterval) {\n        if (jobDefinition.concurrency > jobDefinition.running && self._runningJobs.length < self._maxConcurrency) {\n          // Get the deadline of when the job is not supposed to go past for locking\n          const lockDeadline = new Date(Date.now() - jobDefinition.lockLifetime);\n\n          // This means a job has \"expired\", as in it has not been \"touched\" within the lockoutTime\n          // Remove from local lock\n          // NOTE: Shouldn't we update the 'lockedAt' value in MongoDB so it can be picked up on restart?\n          if (job.attrs.lockedAt < lockDeadline) {\n            debug('[%s:%s] job lock has expired, freeing it up', job.attrs.name, job.attrs._id);\n            self._lockedJobs.splice(self._lockedJobs.indexOf(job), 1);\n            jobDefinition.locked--;\n            jobProcessing();\n            return;\n          }\n\n          // Add to local \"running\" queue\n          self._runningJobs.push(job);\n          jobDefinition.running++;\n\n          // CALL THE ACTUAL METHOD TO PROCESS THE JOB!!!\n          debug('[%s:%s] processing job', job.attrs.name, job.attrs._id);\n          job.run(processJobResult);\n\n          // Re-run the loop to check for more jobs to process (locally)\n          jobProcessing();\n        } else {\n          // Run the job immediately by putting it on the top of the queue\n          debug('[%s:%s] concurrency preventing immediate run, pushing job to top of queue', job.attrs.name, job.attrs._id);\n          enqueueJobs(job, true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Internal method used to run the job definition\n   * @param {Error} err thrown if can't process job\n   * @param {module.Job} job job to process\n   * @returns {undefined}\n   */\n  function processJobResult(err, job) {\n    if (err && !job) {\n      throw (err);\n    }\n    const name = job.attrs.name;\n\n    // Job isn't in running jobs so throw an error\n    if (self._runningJobs.indexOf(job) === -1) {\n      debug('[%s] callback was called, job must have been marked as complete already', job.attrs._id);\n      throw new Error('callback already called - job ' + name + ' already marked complete');\n    }\n\n    // Remove the job from the running queue\n    self._runningJobs.splice(self._runningJobs.indexOf(job), 1);\n    if (definitions[name].running > 0) {\n      definitions[name].running--;\n    }\n\n    // Remove the job from the locked queue\n    self._lockedJobs.splice(self._lockedJobs.indexOf(job), 1);\n    if (definitions[name].locked > 0) {\n      definitions[name].locked--;\n    }\n\n    // Re-process jobs now that one has finished\n    jobProcessing();\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/utils/process-jobs.js\n// module id = 71\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:purge');\n\n/**\n * Removes all jobs from queue\n * NOTE: Only use after defining your jobs\n * @param {Function} cb called when fails or passes\n * @returns {undefined}\n */\nmodule.exports = function(cb) {\n  const definedNames = Object.keys(this._definitions);\n  debug('Agenda.purge(%o)');\n  this.cancel({name: {$not: {$in: definedNames}}}, cb);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/purge.js\n// module id = 72\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:define');\n\n/**\n * Setup definition for job\n * Method is used by consumers of lib to setup their functions\n * @param {String} name name of job\n * @param {Object} options options for job to run\n * @param {Function} processor function to be called to run actual job\n * @returns {undefined}\n */\nmodule.exports = function(name, options, processor) {\n  if (!processor) {\n    processor = options;\n    options = {};\n  }\n  this._definitions[name] = {\n    fn: processor,\n    concurrency: options.concurrency || this._defaultConcurrency,\n    lockLimit: options.lockLimit || this._defaultLockLimit,\n    priority: options.priority || 0,\n    lockLifetime: options.lockLifetime || this._defaultLockLifetime,\n    running: 0,\n    locked: 0\n  };\n  debug('job [%s] defined with following options: \\n%O', name, this._definitions[name]);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/define.js\n// module id = 73\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:every');\n\n/**\n * Creates a scheduled job with given interval and name/names of the job to run\n * @param {Number} interval run every X interval\n * @param {*} names String or strings of jobs to schedule\n * @param {Object} data data to run for job\n * @param {Object} options options to run job for\n * @param {Function} cb called when schedule fails or passes\n * @returns {*} Job or jobs created\n */\nmodule.exports = function(interval, names, data, options, cb) {\n  const self = this;\n\n  if (cb === undefined && typeof data === 'function') {\n    cb = data;\n    data = undefined;\n  } else if (cb === undefined && typeof options === 'function') {\n    cb = options;\n    options = undefined;\n  }\n\n  /**\n   * Internal method to setup job that gets run every interval\n   * @param {Number} interval run every X interval\n   * @param {*} name String job to schedule\n   * @param {Object} data data to run for job\n   * @param {Object} options options to run job for\n   * @param {Function} cb called when schedule fails or passes\n   * @returns {module.Job} instance of job\n   */\n  const createJob = (interval, name, data, options, cb) => {\n    const job = self.create(name, data);\n    job.attrs.type = 'single';\n    job.repeatEvery(interval, options);\n    job.computeNextRunAt();\n    job.save(cb);\n    return job;\n  };\n\n  /**\n   * Internal helper method that uses createJob to create jobs for an array of names\n   * @param {Number} interval run every X interval\n   * @param {*} names Strings of jobs to schedule\n   * @param {Object} data data to run for job\n   * @param {Object} options options to run job for\n   * @param {Function} cb called when schedule fails or passes\n   * @returns {*} array of jobs created\n   */\n  const createJobs = (interval, names, data, options, cb) => {\n    const results = [];\n    let pending = names.length;\n    let errored = false;\n    return names.map((name, i) => {\n      return createJob(interval, name, data, options, (err, result) => {\n        if (err) {\n          if (!errored) {\n            cb(err);\n          }\n          errored = true;\n          return;\n        }\n        results[i] = result;\n        if (--pending === 0 && cb) {\n          debug('every() -> all jobs created successfully');\n          cb(null, results);\n        } else {\n          debug('every() -> error creating one or more of the jobs');\n        }\n      });\n    });\n  };\n\n  if (typeof names === 'string' || names instanceof String) {\n    debug('Agenda.every(%s, %O, [Object], %O, cb)', interval, names, options);\n    return createJob(interval, names, data, options, cb);\n  } else if (Array.isArray(names)) {\n    debug('Agenda.every(%s, %s, [Object], %O, cb)', interval, names, options);\n    return createJobs(interval, names, data, options, cb);\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/every.js\n// module id = 74\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:schedule');\n\n/**\n * Schedule a job or jobs at a specific time\n * @param {String} when when the job gets run\n * @param {*} names array of job names to run\n * @param {Object} data data to send to job\n * @param {Function} cb called when schedule fails or passes\n * @returns {*} job or jobs created\n */\nmodule.exports = function(when, names, data, cb) {\n  const self = this;\n\n  if (cb === undefined && typeof data === 'function') {\n    cb = data;\n    data = undefined;\n  }\n\n  /**\n   * Internal method that creates a job with given date\n   * @param {String} when when the job gets run\n   * @param {String} name of job to run\n   * @param {Object} data data to send to job\n   * @param {Function} cb called when job persistence in MongoDB fails or passes\n   * @returns {module.Job} instance of new job\n   */\n  const createJob = (when, name, data, cb) => {\n    const job = self.create(name, data);\n    job.schedule(when);\n    job.save(cb);\n    return job;\n  };\n\n  /**\n   * Internal helper method that calls createJob on a names array\n   * @param {String} when when the job gets run\n   * @param {*} names of jobs to run\n   * @param {Object} data data to send to job\n   * @param {Function} cb called when job(s) persistence in MongoDB fails or passes\n   * @returns {*} jobs that were created\n   */\n  const createJobs = (when, names, data, cb) => {\n    const results = [];\n    let pending = names.length;\n    let errored = false;\n    return names.map((name, i) => {\n      return createJob(when, name, data, (err, result) => {\n        if (err) {\n          if (!errored) {\n            cb(err);\n          }\n          errored = true;\n          return;\n        }\n        results[i] = result;\n        if (--pending === 0 && cb) {\n          debug('Agenda.schedule()::createJobs() -> all jobs created successfully');\n          cb(null, results);\n        } else {\n          debug('Agenda.schedule()::createJobs() -> error creating one or more of the jobs');\n        }\n      });\n    });\n  };\n\n  if (typeof names === 'string' || names instanceof String) {\n    debug('Agenda.schedule(%s, %O, [Object], cb)', when, names);\n    return createJob(when, names, data, cb);\n  } else if (Array.isArray(names)) {\n    debug('Agenda.schedule(%s, %O, [Object], cb)', when, names);\n    return createJobs(when, names, data, cb);\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/schedule.js\n// module id = 75\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:now');\n\n/**\n * Create a job for this exact moment\n * @param {String} name name of job to schedule\n * @param {Object} data data to pass to job\n * @param {Function} cb called when job scheduling fails or passes\n * @returns {module.Job} new job instance created\n */\nmodule.exports = function(name, data, cb) {\n  if (!cb && typeof data === 'function') {\n    cb = data;\n    data = undefined;\n  }\n  debug('Agenda.now(%s, [Object])', name);\n  const job = this.create(name, data);\n  job.schedule(new Date());\n  job.save(cb);\n  return job;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/now.js\n// module id = 76\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:cancel');\n\n/**\n * Cancels any jobs matching the passed MongoDB query, and removes them from the database.\n *  @param {Object} query MongoDB query to use when cancelling\n *  @param {Function} cb callback(error, numRemoved) when cancellation fails or passes\n *  @caller client code, Agenda.purge(), Job.remove()\n *  @returns {undefined}\n */\nmodule.exports = function(query, cb) {\n  debug('attempting to cancel all Agenda jobs', query);\n  this._collection.deleteMany(query, (error, result) => {\n    if (cb) {\n      if (error) {\n        debug('error trying to delete jobs from MongoDB');\n      } else {\n        debug('jobs cancelled');\n      }\n      cb(error, result && result.result ? result.result.n : undefined);\n    }\n  });\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/cancel.js\n// module id = 77\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:saveJob');\nconst utils = require('../utils');\n\nconst processJobs = utils.processJobs;\n\n/**\n * Save the properties on a job to MongoDB\n * @param {module.Job} job job to save into MongoDB\n * @param {Function} cb called when job is saved or errors\n * @returns {undefined}\n */\nmodule.exports = function(job, cb) {\n  debug('attempting to save a job into Agenda instance');\n\n  // Grab information needed to save job but that we don't want to persist in MongoDB\n  const fn = cb;\n  const self = this;\n  const id = job.attrs._id;\n  const unique = job.attrs.unique;\n  const uniqueOpts = job.attrs.uniqueOpts;\n\n  // Store job as JSON and remove props we don't want to store from object\n  const props = job.toJSON();\n  delete props._id;\n  delete props.unique;\n  delete props.uniqueOpts;\n\n  // Store name of agenda queue as last modifier in job data\n  props.lastModifiedBy = this._name;\n  debug('set job props: \\n%O', props);\n\n  // Grab current time and set default query options for MongoDB\n  const now = new Date();\n  const protect = {};\n  let update = {$set: props};\n  debug('current time stored as %s', now.toISOString());\n\n  // If the job already had an ID, then update the properties of the job\n  // i.e, who last modified it, etc\n  if (id) {\n    // Update the job and process the resulting data'\n    debug('job already has _id, calling findOneAndUpdate() using _id as query');\n    this._collection.findOneAndUpdate({\n      _id: id\n    },\n    update, {\n      returnOriginal: false\n    },\n    processDbResult);\n  } else if (props.type === 'single') {\n    // Job type set to 'single' so...\n    // NOTE: Again, not sure about difference between 'single' here and 'once' in job.js\n    debug('job with type of \"single\" found');\n\n    // If the nextRunAt time is older than the current time, \"protect\" that property, meaning, don't change\n    // a scheduled job's next run time!\n    if (props.nextRunAt && props.nextRunAt <= now) {\n      debug('job has a scheduled nextRunAt time, protecting that field from upsert');\n      protect.nextRunAt = props.nextRunAt;\n      delete props.nextRunAt;\n    }\n\n    // If we have things to protect, set them in MongoDB using $setOnInsert\n    if (Object.keys(protect).length > 0) {\n      update.$setOnInsert = protect;\n    }\n\n    // Try an upsert\n    // NOTE: 'single' again, not exactly sure what it means\n    debug('calling findOneAndUpdate() with job name and type of \"single\" as query');\n    this._collection.findOneAndUpdate({\n      name: props.name,\n      type: 'single'\n    },\n    update, {\n      upsert: true,\n      returnOriginal: false\n    },\n    processDbResult);\n  } else if (unique) {\n    // If we want the job to be unique, then we can upsert based on the 'unique' query object that was passed in\n    const query = job.attrs.unique;\n    query.name = props.name;\n    if (uniqueOpts && uniqueOpts.insertOnly) {\n      update = {$setOnInsert: props};\n    }\n\n    // Use the 'unique' query object to find an existing job or create a new one\n    debug('calling findOneAndUpdate() with unique object as query: \\n%O', query);\n    this._collection.findOneAndUpdate(query, update, {upsert: true, returnOriginal: false}, processDbResult);\n  } else {\n    // If all else fails, the job does not exist yet so we just insert it into MongoDB\n    debug('using default behavior, inserting new job via insertOne() with props that were set: \\n%O', props);\n    this._collection.insertOne(props, processDbResult);\n  }\n\n  /**\n   * Given a result for findOneAndUpdate() or insert() above, determine whether to process\n   * the job immediately or to let the processJobs() interval pick it up later\n   * @param {Error} err error passed in via MongoDB call as to whether modify call failed or passed\n   * @param {*} result the data returned from the findOneAndUpdate() call or insertOne() call\n   * @access private\n   * @returns {undefined}\n   */\n  function processDbResult(err, result) {\n    // Check if there is an error and either cb(error) or throw if there is no callback\n    if (err) {\n      debug('processDbResult() received an error, job was not updated/created');\n      if (fn) {\n        return fn(err);\n      }\n      throw err;\n    } else if (result) {\n      debug('processDbResult() called with success, checking whether to process job immediately or not');\n\n      // We have a result from the above calls\n      // findAndModify() returns different results than insertOne() so check for that\n      let res = result.ops ? result.ops : result.value;\n      if (res) {\n        // If it is an array, grab the first job\n        if (Array.isArray(res)) {\n          res = res[0];\n        }\n\n        // Grab ID and nextRunAt from MongoDB and store it as an attribute on Job\n        job.attrs._id = res._id;\n        job.attrs.nextRunAt = res.nextRunAt;\n\n        // If the current job would have been processed in an older scan, process the job immediately\n        if (job.attrs.nextRunAt && job.attrs.nextRunAt < self._nextScanAt) {\n          debug('[%s:%s] job would have ran by nextScanAt, processing the job immediately', job.attrs.name, res._id);\n          processJobs.call(self, job);\n        }\n      }\n    }\n\n    // If we have a callback, return the Job instance\n    if (fn) {\n      fn(null, job);\n    }\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/save-job.js\n// module id = 78\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:start');\nconst utils = require('../utils');\n\nconst processJobs = utils.processJobs;\n\n/**\n * Starts processing jobs using processJobs() methods, storing an interval ID\n * @returns {undefined}\n */\nmodule.exports = function() {\n  if (this._processInterval) {\n    debug('Agenda.start was already called, ignoring');\n  } else {\n    debug('Agenda.start called, creating interval to call processJobs every [%dms]', this._processEvery);\n    this._processInterval = setInterval(processJobs.bind(this), this._processEvery);\n    process.nextTick(processJobs.bind(this));\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/start.js\n// module id = 79\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:stop');\n\n/**\n * Clear the interval that processes the jobs\n * @param {Function} cb called when job unlocking fails or passes\n * @returns {undefined}\n */\nmodule.exports = function(cb) {\n  const self = this;\n  /**\n   * Internal method to unlock jobs so that they can be re-run\n   * NOTE: May need to update what properties get set here, since job unlocking seems to fail\n   * @param {Function} done callback called when job unlocking fails or passes\n   * @access private\n   * @returns {undefined}\n   */\n  const _unlockJobs = function(done) {\n    debug('Agenda._unlockJobs()');\n    const jobIds = self._lockedJobs.map(job => job.attrs._id);\n\n    if (jobIds.length === 0) {\n      debug('no jobs to unlock');\n      return done();\n    }\n\n    debug('about to unlock jobs with ids: %O', jobIds);\n    self._collection.updateMany({_id: {$in: jobIds}}, {$set: {lockedAt: null}}, err => {\n      if (err) {\n        return done(err);\n      }\n\n      self._lockedJobs = [];\n      return done();\n    });\n  };\n\n  debug('Agenda.stop called, clearing interval for processJobs()');\n  cb = cb || function() {};\n  clearInterval(this._processInterval);\n  this._processInterval = undefined;\n  _unlockJobs(cb);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/stop.js\n// module id = 80\n// module chunks = 0","'use strict';\nconst debug = require('debug')('agenda:_findAndLockNextJob');\nconst utils = require('../utils');\n\nconst createJob = utils.createJob;\n\n/**\n * Find and lock jobs\n * @param {String} jobName name of job to try to lock\n * @param {Object} definition definition used to tell how job is run\n * @param {Function} cb called when job lock fails or passes\n * @access protected\n * @caller jobQueueFilling() only\n * @returns {undefined}\n */\nmodule.exports = function(jobName, definition, cb) {\n  const self = this;\n  const now = new Date();\n  const lockDeadline = new Date(Date.now().valueOf() - definition.lockLifetime);\n  debug('_findAndLockNextJob(%s, [Function], cb)', jobName);\n\n  // Don't try and access MongoDB if we've lost connection to it.\n  // Trying to resolve crash on Dev PC when it resumes from sleep. NOTE: Does this still happen?\n  const s = this._mdb.s || this._mdb.db.s;\n  if (s.topology.connections().length === 0) {\n    if (s.topology.autoReconnect && !s.topology.isDestroyed()) {\n      // Continue processing but notify that Agenda has lost the connection\n      debug('Missing MongoDB connection, not attempting to find and lock a job');\n      self.emit('error', new Error('Lost MongoDB connection'));\n      cb();\n    } else {\n      // No longer recoverable\n      debug('topology.autoReconnect: %s, topology.isDestroyed(): %s', s.topology.autoReconnect, s.topology.isDestroyed());\n      cb(new Error('MongoDB connection is not recoverable, application restart required'));\n    }\n  } else {\n    /**\n    * Query used to find job to run\n    * @type {{$or: [*]}}\n    */\n    const JOB_PROCESS_WHERE_QUERY = {\n      $or: [{\n        name: jobName,\n        lockedAt: null,\n        nextRunAt: {$lte: this._nextScanAt},\n        disabled: {$ne: true}\n      }, {\n        name: jobName,\n        lockedAt: {$exists: false},\n        nextRunAt: {$lte: this._nextScanAt},\n        disabled: {$ne: true}\n      }, {\n        name: jobName,\n        lockedAt: {$lte: lockDeadline},\n        disabled: {$ne: true}\n      }]\n    };\n\n    /**\n    * Query used to set a job as locked\n    * @type {{$set: {lockedAt: Date}}}\n    */\n    const JOB_PROCESS_SET_QUERY = {$set: {lockedAt: now}};\n\n    /**\n    * Query used to affect what gets returned\n    * @type {{returnOriginal: boolean, sort: object}}\n    */\n    const JOB_RETURN_QUERY = {returnOriginal: false, sort: this._sort};\n\n    // Find ONE and ONLY ONE job and set the 'lockedAt' time so that job begins to be processed\n    this._collection.findOneAndUpdate(JOB_PROCESS_WHERE_QUERY, JOB_PROCESS_SET_QUERY, JOB_RETURN_QUERY, (err, result) => {\n      let job;\n      if (!err && result.value) {\n        debug('found a job available to lock, creating a new job on Agenda with id [%s]', result.value._id);\n        job = createJob(self, result.value);\n      }\n      if (err) {\n        debug('error occurred when running query to find and lock job');\n      }\n      cb(err, job);\n    });\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/Agenda/lib/agenda/find-and-lock-next-job.js\n// module id = 81\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 82\n// module chunks = 0","module.exports = require(\"another-mongoose-statemachine\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"another-mongoose-statemachine\"\n// module id = 83\n// module chunks = 0","import path from 'path';\nimport express from 'express';\nimport secure from 'ssl-express-www';\nimport bodyParser from 'body-parser';\nimport api from './api';\nimport ssr from './ssr';\n\nimport Agenda from 'agenda';\nimport Agendash from 'agendash';\n\nimport session from 'express-session';\nimport createMongoStore from 'connect-mongo';\n\n\nconst app = express();\napp.use(secure);\nconst agenda = new Agenda({db: {address: process.env.MONGODB_URI || process.env.MONGO_URL}});\n\napp.use(session({\n    secret: 'qVaNxeu5VVEAtkyFJ/62EKcp7Lw=',\n    saveUninitialized: true, // don't create session until something stored\n\t  resave: false, //don't save session if unmodified\n    store: new (createMongoStore(session))({url: process.env.MONGODB_URI || process.env.MONGO_URL}),\n    cookie: {expires: new Date(253402300000000)}\n}));\n\napp.use('/jobs', Agendash(agenda));\n\napp.set('view engine', 'ejs');\napp.set('views', path.join(__dirname, '../views'));\napp.use(bodyParser.json());\n\napp.use(express.static(path.join(__dirname, '..', 'public')));\n\napp.use('/api', api);\napp.use('/*', ssr);\n\n// This is a test to see if this shows up in the Heroku log..\nconsole.log(\"HELLO WORLD\");\n// This is a test to see if this shows up in the Heroku log..\nconsole.log(\"assigned port\",process.env.PORT);\napp.listen(process.env.PORT || 5000, () => {\n  console.log('Hello World listening on port 5000!');\n});\n\n\n\n// WEBPACK FOOTER //\n// ./routes/index.js","module.exports = require(\"ssl-express-www\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ssl-express-www\"\n// module id = 85\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 86\n// module chunks = 0","// api.js -- The main endpoint for communications.\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\nimport fs from 'fs';\nimport path from 'path';\nimport express from 'express';\nimport OpenTok from 'opentok';\nimport mongoose from 'mongoose';\nimport JourneySpace from '../models/journey_space';\nimport JourneyParticipant from '../models/journey_participant';\nimport JourneyRSVP from '../models/journey_rsvp';\nimport JourneyContent from '../models/journey_content';\nimport dotenv from 'dotenv';\nrequire('isomorphic-fetch');\n\ndotenv.config();\n\nmongoose.connect(process.env.MONGODB_URI || process.env.MONGO_URL);\n\nfunction promisify(fn) {\n  /**\n   * @param {...Any} params The params to pass into *fn*\n   * @return {Promise<Any|Any[]>}\n   */\n  return function promisified(...params) {\n    return new Promise((resolve, reject) => fn(...params.concat([(err, ...args) => err ? reject(err) : resolve( args.length < 2 ? args[0] : args )])))\n  }\n}\n\nconst opentok = new OpenTok(process.env.OPENTOK_KEY, process.env.OPENTOK_SECRET);\nconst router = express.Router();\n\nfunction generateToken(sessionId) {\n\tlet tokenOptions = {};\n\ttokenOptions.role = \"publisher\";\n\t// Generate a token.\n\tconst token = opentok.generateToken(sessionId, tokenOptions);\n\treturn token;\n}\n\n// TODO: switch to POST, just using GET for easier testing\nrouter.get('/journeys/:room', async (req, res) => {\n\tconst {room} = req.params;\n\tconst journeySpace = await JourneySpace.findOne({room}).exec();\n\tif (journeySpace) {\n    try {\n      await journeySpace.joined();\n    } catch(e) {\n      // journey may already be in joined state, catch error here and ignore\n    }\n\n    if (!journeySpace.sessionId) {\n      const session = await new Promise((resolve, reject) => {\n        opentok.createSession(async (err, session) => {\n          if (err) reject(err);\n          resolve(session);\n        });\n      });\n      journeySpace.sessionId = session.sessionId;\n      await journeySpace.save();\n    }\n    const participants = await JourneyParticipant.find({journeySpace, present: true}).lean().exec();\n    const currentUserParticipant = await JourneyParticipant.findOne({journeySpace, user: req.session.id}).exec();\n    if (!currentUserParticipant) {\n      const newParticipant = new JourneyParticipant({journeySpace, user: req.session.id, present: true});\n      await newParticipant.save();\n      participants.push(newParticipant);\n      const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n      if (globalSpace) {\n        opentok.signal(globalSpace.sessionId, null, { 'type': 'newJoin', 'data': JSON.stringify(newParticipant.toJSON()) }, () => {});\n      }\n    } else {\n      currentUserParticipant.present = true;\n      await currentUserParticipant.save();\n    }\n    const response = journeySpace.toJSON();\n    response.participants = participants;\n\t\tres.json({\n\t\t\t...response,\n\t\t\ttoken: generateToken(journeySpace.sessionId),\n\t\t});\n\t} else {\n\t\topentok.createSession(async (err, session) => {\n\t\t  if (err) throw err;\n\t\t\t// create new journey space, save tok session id\n      const db = mongoose.connection;\n      let selectedJourney;\n      if (req.query.journey) {\n        selectedJourney = await JourneyContent.findOne({name: req.query.journey}).lean().exec();\n      }\n      if (!selectedJourney) {\n        const randomJourney = (await db.collection('journeycontents').aggregate([{$sample: {size: 1}}]).toArray())[0];\n        selectedJourney = randomJourney;\n      }\n      const newJourneySpace = new JourneySpace({\n        room, \n        sessionId: session.sessionId,\n        journey: selectedJourney.filePath,\n        name: req.query.name || selectedJourney.name,\n        image: selectedJourney.image,\n        owner: req.session.id,\n      });\n\t\t\tawait newJourneySpace.save();\n      const response = newJourneySpace.toJSON();\n      response.participants = [];\n      response.rsvps = [];\n\t\t\tres.json({\n\t\t\t\t...response,\n\t\t\t\ttoken: generateToken(session.sessionId),\n\t\t\t});\n\t\t});\n\t}\n});\n\nrouter.post('/journeys/:room/joined', async (req, res) => {\n\tconst {room} = req.params;\n  const {id: connectionId} = req.body;\n  req.session.connections = req.session.connections || {};\n  req.session.connections[room] = connectionId;\n\tconst journeySpace = await JourneySpace.findOne({room}).lean().exec();\n\tif (journeySpace) {\n    let participant = await JourneyParticipant.findOne({journeySpace, user: req.session.id}).exec();\n    if (participant) {\n      participant.connectionId = connectionId;\n      participant.present = true;\n      await participant.save();\n    } else {\n      participant = new JourneyParticipant({journeySpace, user: req.session.id, connectionId});\n      await participant.save();\n    }\n    const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n    if (globalSpace) {\n      opentok.signal(globalSpace.sessionId, null, { 'type': 'journeyerJoined', 'data': JSON.stringify(participant.toJSON()) }, () => {});\n    }\n    res.json(participant.toJSON());\n  } else {\n    res.sendStatus(404);\n  }\n});\n\nrouter.get('/journeys/:room/:connectionId', async (req, res) => {\n  const {room, connectionId} = req.params;\n\tconst journeySpace = await JourneySpace.findOne({room}).lean().exec();\n\tif (journeySpace) {\n    const participant = await JourneyParticipant.findOne({session: journeySpace, connectionId}).exec();\n    res.json(participant);\n    return;\n  }\n  res.sendStatus(500);\n});\n\nrouter.get('/active_journeys', async(req, res) => {\n  const journeys = await JourneySpace.aggregate([\n    {\n      $match: {\n        state: {$in: ['created', 'joined']}, startAt: {$gte: new Date()}, room: {$ne: 'temp-home-location'}\n      }\n    }, \n\n    {\n      $lookup: {\n        from: 'journeyparticipants',\n        localField: '_id',\n        foreignField: 'journeySpace',\n        as: 'participants'\n      }\n    },\n\n    {\n      $project: {\n        room: 1,\n        name: 1,\n        journey: 1,\n        image: 1,\n        startAt: 1,\n        participants: {\n          $filter: {\n            input: \"$participants\",\n            as: \"participants\",\n            cond: { $eq: ['$$participants.present', true] }\n          }\n        }\n      }\n    },\n\n    {\n      $sort: {startAt: 1}\n    }\n  ]);\n\n  res.json(journeys);\n});\n\nrouter.post('/journeys/:id/rsvp', async (req, res) => {\n  const journey = await JourneySpace.findById(req.params.id).exec();\n  try {\n    await journey.joined();\n  } catch(e) {\n    console.log(e);\n  }\n  const rsvp = new JourneyRSVP({journey, user: req.session.id});\n  await rsvp.save();\n  const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n  if (globalSpace) {\n    opentok.signal(globalSpace.sessionId, null, { 'type': 'newRSVP', 'data': JSON.stringify(rsvp) }, () => {});\n  }\n  res.json(rsvp);\n});\n\nrouter.post('/journeys/:room/completed', async (req, res) => {\n  const journey = await JourneySpace.findOne({room: req.params.room}).exec();\n  await journey.complete();\n  const response = journey.toJSON();\n  const participants = await JourneyParticipant.find({session: journey, present: true}).lean().exec();\n  response.participants = participants;\n  opentok.signal(journey.sessionId, null, { 'type': 'journeyUpdated', 'data': JSON.stringify(response) }, () => {});\n  res.sendStatus(200);\n});\n\nrouter.put('/journeys/:room/progress', async (req, res) => {\n  const {currentTime} = req.body;\n  const journey = await JourneySpace.findOne({room: req.params.room}).exec();\n  journey.currentTime = currentTime;\n  await journey.save();\n  res.sendStatus(200);\n});\n\nrouter.post('/journeys/:id/skip', async (req, res) => {\n  const journey = await JourneySpace.findOne({room: req.params.id}).exec();\n  await journey.skip();\n  const response = journey.toJSON();\n  const participants = await JourneyParticipant.find({session: journey, present: true}).lean().exec();\n  response.participants = participants;\n  opentok.signal(journey.sessionId, null, { 'type': 'journeyUpdated', 'data': JSON.stringify(response) }, () => {});\n});\n\n// TEMP: Use get for convenience. hardcode temp-home-location for the room\n// Trigger a general announcement to everyone\nrouter.get('/sessions/test/temp-home-location', async (req, res) => {\n  // const {room, connection} = req.params;\n  const journeySpace = await JourneySpace.findOne({room:'temp-home-location'}).exec();\n  if (journeySpace) {\n  console.log(\"**** SENDING SIGNAL\")\n  let messageData = {\n    userName: \"Bob\",\n    description: \"some text\",\n    url: \"http://www.news.google.com\"\n  }\n\n  opentok.signal(journeySpace.sessionId, null, {type: 'displayJourneyRequest', data: JSON.stringify(messageData)}, () => {});\n  return res.sendStatus(200);\n  }\n  res.sendStatus(200);\n});\n\nrouter.get('/journeys/:room/connections/:connection/ready', async (req, res) => {\n  const {room, connection} = req.params;\n  const journeySpace = await JourneySpace.findOne({room}).exec();\n\tif (journeySpace) {\n    const participant = await JourneyParticipant.findOne({session: journeySpace, connectionId: connection});\n    participant.ready = true;\n    await participant.save();\n    opentok.signal(journeySpace.sessionId, null, {type: 'ready', data: 'foo'}, () => {});\n    const allReady = (await JourneyParticipant.count({session: journeySpace, ready: false, present: true})) === 0;\n    if (allReady) {\n      // signal(journeySpace.sessionId, {type: 'startJourney', data: 'foo'});\n    }\n    return res.sendStatus(200);\n  }\n  res.sendStatus(200);\n});\n\nrouter.get('/journeys', async (req, res) => {\n  const journeys = await JourneyContent.find().exec();\n  res.json(journeys);\n});\n\nrouter.put('/journeys/:room/journey', async (req, res) => {\n  const {journey: journeyFile} = req.body;\n  const {room} = req.params;\n  const journey = await JourneySpace.findOne({room}).exec();\n  const journeyContent = await JourneyContent.findOne({filePath: journeyFile}).exec();\n\tif (journey) {\n    journey.journey = journeyContent.filePath;\n    journey.image = journeyContent.image;\n    journey['name'] = journeyContent.get('name');\n    await journey.save();\n    await journey.reset();\n    const response = journey.toJSON();\n    const participants = await JourneyParticipant.find({session: journey, present: true}).lean().exec();\n    response.participants = participants;\n    opentok.signal(journey.sessionId, null, { 'type': 'journeyUpdated', 'data': JSON.stringify(response) }, () => {});\n  }\n  res.sendStatus(200);\n});\n\n// TODO: this should really verify that the user hitting this endpoint is authorized to do so (e.g. that they are the journey's host)\nrouter.post('/journeys/:room/start', async (req, res) => {\n  const {room} = req.params;\n  const journeySpace = await JourneySpace.findOne({room}).exec();\n\tif (journeySpace) {\n    try {\n      await journeySpace.start();\n    } catch(e) {\n      console.log('error starting journey', e);\n    }\n    opentok.signal(journeySpace.sessionId, null, {type: 'startJourney', data: ''}, () => {});\n  }\n  res.sendStatus(200);\n});\n\nrouter.post('/journeys/:room/pause', async (req, res) => {\n  const {room} = req.params;\n  const journeySpace = await JourneySpace.findOne({room}).exec();\n\tif (journeySpace) {\n    try {\n      await journeySpace.pause();\n    } catch(e) {\n      console.log('error pausing journey', e);\n    }\n    opentok.signal(journeySpace.sessionId, null, {type: 'pauseJourney', data: ''}, () => {});\n  }\n});\n\n\nrouter.post('/journeys/:room/flag', async (req, res) => {\n  const {room} = req.params;\n  const userId = req.sessionID; // using sessionId as representation of user for now\n  const journeySpace = await JourneySpace.findOne({room}).exec();\n\tif (journeySpace) {\n    journeySpace.flags.push({user: userId, flagged: req.body.stream});\n    await journeySpace.save();\n    const participants = await JourneyParticipant.find({session: journeySpace, present: true}).lean().exec();\n    return res.json({...journeySpace.toJSON(), participants});\n  }\n  res.sendStatus(404);\n});\n\nrouter.post('/event', async (req, res) => {\n  const {sessionId, connection} = req.body;\n  const journeySpace = await JourneySpace.findOne({sessionId}).exec();\n\n  console.log(req.body.event, JSON.stringify(req.body, null, 2));\n\n  switch(req.body.event) {\n    case 'connectionCreated':\n      break;\n    case 'connectionDestroyed':\n      if (journeySpace) {\n        const participant= await JourneyParticipant.findOne({journeySpace, connectionId: connection.id});\n        if (participant) {\n          participant.present = false;\n          await participant.save();\n          const globalSpace = await JourneySpace.findOne({room: 'temp-home-location'}).exec();\n          if (globalSpace) {\n            opentok.signal(globalSpace.sessionId, null, { 'type': 'journeyerLeftSpace', 'data': JSON.stringify(participant.toJSON()) }, () => {});\n          }\n        }\n      }\n      break\n  }\n  res.sendStatus(200);\n});\n\nrouter.post('/login', (req, res) => {\n  req.session.loggedIn = true;\n  req.session.user = {\n    name: req.body.name\n  };\n  res.json({loggedIn: true, user: {name: req.body.name}});\n});\n\nrouter.get('/logout', (req, res) => {\n  req.session.destroy(() => {\n      res\n        .clearCookie('connect.sid')\n        .redirect('/login')\n    });\n});\n\nexport default router;\n\n\n\n\n// WEBPACK FOOTER //\n// ./routes/api.js","import express from 'express';\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport { createStore } from 'redux';\nimport { Provider } from 'react-redux';\nimport { StaticRouter } from 'react-router';\nimport App from '../../client/src/app';\nimport state from '../../client/src/state';\n\nconst router = express.Router();\n\nrouter.get('/', (req, res) => {\n  const context = {};\n\n  state.loggedIn = req.session.loggedIn;\n  state.user = req.session.user;\n\n  const html = ReactDOMServer.renderToString(\n    <StaticRouter\n      location={req.originalUrl}\n      context={context}\n    >\n      <App />\n    </StaticRouter>\n  );\n\n  if (context.url) {\n    if (req.originalUrl != '/favicon.ico') {\n      res.writeHead(301, {\n        Location: context.url,\n      });\n    }\n    res.end();\n  } else {\n    res.status(200).render(process.env.NODE_ENV === 'production' ? 'index.ejs' : 'index.dev.ejs', {\n      html,\n      script: JSON.stringify({openTokKey: process.env.OPENTOK_KEY, loggedIn: req.session.loggedIn, user: req.session.user, sessionId: req.sessionID}),\n    });\n  }\n});\n\n\nexport default router;\n\n\n\n// WEBPACK FOOTER //\n// ./routes/ssr.js","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 89\n// module chunks = 0","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 90\n// module chunks = 0","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = 91\n// module chunks = 0","// app.js -- The \"one-page\" client side holder for this react app\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\nimport React, {Component} from 'react';\nimport { Route, Redirect, Switch, Link } from 'react-router-dom';\nimport { withRouter } from 'react-router';\nimport { view } from 'react-easy-state';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport Cookie from 'js-cookie';\nimport Header from './components/header';\nimport Home from './components/home';\nimport JourneySpace from './components/journey_space';\nimport Intro from './components/intro';\nimport CountdownMessage from './components/countdown_message';\nimport state from './state';\nimport * as someHelper from './utility/utility'\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\n\n// Note: it may be worth using serve favicon to make this work on our deployed site: https://expressjs.com/en/resources/middleware/serve-favicon.html\n\n\nif (__CLIENT__) {\n  var { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n  const OT = require('@opentok/client');\n  const globalClickCatcher = (e) => {\n    if (state.audioTag && state.audioTag.paused) {\n      state.audioTag.play().then(() => {\n        state.audioTag.pause();\n        document.body.removeEventListener('click', globalClickCatcher);\n      });\n    }\n  };\n    \n    const resizeEventHandler = (e) => {\n\tsomeHelper.setSizes();\n    };\n    document.body.addEventListener('click', globalClickCatcher);\n    window.addEventListener('resize', resizeEventHandler);\n    window.addEventListener('load', resizeEventHandler);\n}\n\n\nconst RequireLoginRoute = ({component: Component, ...rest}) => {\n  return (\n    <Route {...rest} render={renderProps => {\n        return (\n          state.loggedIn ?\n            <Component {...renderProps} />\n          : <Redirect to={ {\n                pathname: '/login'\n            }} />\n        )\n    }}/>\n  )\n};\n\nclass Login extends Component {\n  static propTypes = {\n    match: PropTypes.object.isRequired,\n    location: PropTypes.object.isRequired,\n    history: PropTypes.object.isRequired\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: ''\n    }\n  }\n\n  onChange(field) {\n    return (e) => {\n      this.setState({\n        [field]: e.target.value\n      });\n    }\n  }\n\n  login = (e) => {\n    e.preventDefault();\n    fetch(`/api/login`, {\n      body: JSON.stringify({name: this.state.name}), // must match 'Content-Type' header\n      method: 'POST', // *GET, POST, PUT, DELETE, etc.\n      credentials: 'same-origin',\n      headers: {\n        'content-type': 'application/json'\n      }\n    })\n    .then(response => response.json())\n    .then(json => {\n      state.loggedIn = json.loggedIn;\n      state.user = json.user;\n      this.props.history.push('/');\n    });\n  }\n\n  render() {\n    return (\n      <div style={{padding: '20px', width: '50%'}}>\n        <form onSubmit={this.login}>\n          <div className=\"form-group\">\n            <label htmlFor=\"name\">Name</label>\n            <input type=\"text\" onChange={this.onChange('name')} value={this.state.name} className=\"form-control\" id=\"name\" aria-describedby=\"nameHelp\" placeholder=\"Enter name\"/>\n          </div>\n          <button type=\"submit\" className=\"btn btn-primary\">Submit</button>\n        </form>\n      </div>\n    )\n  }\n}\n\nclass JoinableJourneyCard extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: false \n    }\n  }\n\n  render() {\n    const {journey} = this.props;\n    const currentUserHasRSVP = (journey.participants || []).find(participant => participant.user === state.sessionId) != null;\n\n    return (\n      <div className='joinable-journey-card'>\n        <div className='image'>\n          <img src={journey.image}/>\n        </div>\n        <div className='content'>\n          <CountdownMessage endTime={journey.startAt} />\n          <h4>{journey.name}</h4>\n          <p>Starts at: {moment(journey.startAt).format('LT')}</p>\n          <ul className='journey-vacant-spots' style={{display: 'flex', listStyle: 'none', margin: 0, padding: 0}}>\n            <li key=\"msg\">{3 - journey.participants.length} spot{3 - journey.participants.length > 1 ? 's' : ''} available:</li>\n            {Array(3).fill(0).map((k, i) => (\n\t\t// Rob is changing this to \"user\" just as a test of my ability to change things...\n\t\t// Note: Adding a \"key\" here seems unneeded but made a confusing waring disappear...\n\t\t    <li key={\"item\"+i}><i className={`fa fa-user ${journey.participants.length > i ? 'fill' : ''}`}></i></li>\n            ))}\n            \n          </ul>\n          <Link to={`/${journey.room}`} className='btn btn-primary'>{currentUserHasRSVP ? 'Go there now' : 'Join'}</Link>\n        </div>\n      </div>\n    )\n  }\n}\n\nclass JourneyBoard extends Component {\n\n  componentDidMount() {\n    const roomUrl = 'temp-home-location'\n\n    // subscribe to global events\n    fetch(`/api/journeys/${roomUrl}`, {credentials: 'include'})\n      .then(res => res.json())\n      .then(json => {\n        this.sessionHelper = createSession({\n          apiKey: state.openTokKey,\n          sessionId: json.sessionId,\n          token: json.token,\n          onConnect: () => {\n          }\n        });\n\n          this.sessionHelper.session.on(\"signal:createdNewJourney\", (event) => {\n\t      // console.log(\"joinable Jounerys:\");\n\t      // console.log(state.joinableJourneys);\n\t      // console.log([JSON.parse(event.data)]);\t      \n//\t      state.joinableJourneys = _.unionBy(state.joinableJourneys, [JSON.parse(event.data)], (j) => j._id)\t      \n              state.joinableJourneys.push(JSON.parse(event.data));\n\t      \n\t      console.log(state.joinableJourneys);\t      \n        });\n\n        this.sessionHelper.session.on(\"signal:expiredJourney\", (event) => {\n          const journey = JSON.parse(event.data);\n          const idx = state.joinableJourneys.findIndex(j => j._id === journey._id);\n          state.joinableJourneys = [...state.joinableJourneys.slice(0, idx), ...state.joinableJourneys.slice(idx + 1)];\n        });\n\n        this.sessionHelper.session.on(\"signal:failJourney\", (event) => {\n          const journey = JSON.parse(event.data);\n          const idx = state.joinableJourneys.findIndex(j => j._id === journey._id);\n          state.joinableJourneys = [...state.joinableJourneys.slice(0, idx), ...state.joinableJourneys.slice(idx + 1)];\n        });\n\n        this.sessionHelper.session.on('signal:journeyerJoined', (event) => {\n          const participant = JSON.parse(event.data);\n          const journey = state.joinableJourneys.find(j => j._id === participant.journeySpace);\n          if (journey) {\n            const idx = state.joinableJourneys.indexOf(journey);\n            if (journey.participants.findIndex(_participant => _participant._id === participant._id) === -1) {\n              journey.participants.push(participant);\n            }\n//\t      console.log(state.joinableJourneys);\n              state.joinableJourneys = [...state.joinableJourneys.slice(0, idx), journey, ...state.joinableJourneys.slice(idx + 1)];\n//\t      console.log(\"journeyer joined done!\");\n//\t      console.log(state.joinableJourneys);\t      \n          }\n        });\n\n        this.sessionHelper.session.on('signal:journeyerLeftSpace', (event) => {\n          const participant = JSON.parse(event.data);\n          console.log('Event: left space', event.data);\n          const journey = state.joinableJourneys.find(j => j._id === participant.journeySpace);\n          const idx = state.joinableJourneys.indexOf(journey);\n            journey.participants = journey.participants.filter(p => p._id !== participant._id);\n//\t      console.log(state.joinableJourneys);\t    \n            state.joinableJourneys = [...state.joinableJourneys.slice(0, idx), journey, ...state.joinableJourneys.slice(idx + 1)];\n//\t      console.log(\"journeyer left space done!\");\n//\t      console.log(state.joinableJourneys);\t      \t    \n        });\n\n      });\n\n\n    // fetch currently active journeys\n    fetch('/api/active_journeys')\n      .then(res => res.json())\n      .then(json => {\n        state.joinableJourneys = json;\n      });\n  }\n\n    render() {\n\t// Note, if this key is ever read and treated as a id, then we will have a terrible problem.\n\t// I want to remove the warnings I am getting, but this is a dangerous way to do it.\n\t// Possibly I should deal with this in a different way.\n\tvar discriminator = 0;\n\treturn (\n\t\t<div>\n\t\t<Header history={this.props.history} showLeave={false}/>\t    \n      <div className='joinable-journeys'>\n        {state.joinableJourneys.map(journey => <JoinableJourneyCard key={journey._id+\"_\"+discriminator++} journey={journey} audioTag={this.audioTag}/>)}\n\t    </div>\n\t\t</div>\n    )\n  }\n}\n\nclass IntroWrapper extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showIntro: !Cookie.get('saw intro')\n    }\n  }\n\n  componentDidMount() {\n  }\n\n  onClose = () => {\n    this.setState({\n      showIntro: false\n    });\n  }\n\n  render() {\n    if (this.state.showIntro) {\n      return (\n        <Intro onClose={this.onClose} {...this.props}>\n          <this.props.component {...this.props}/>\n        </Intro>\n      )\n    } else {\n      return <this.props.component {...this.props}/>\n    }\n  }\n}\n\nconst RouteWithIntro = ({component: Component, ...rest}) => {\n  const showIntro = __CLIENT__ && !Cookie.get('saw intro');\n  return (\n    <div>\n      {showIntro && \n        <Route {...rest} render={renderProps => {\n          return (\n            <IntroWrapper component={Component} {...renderProps}/>\n          )\n        }}/>\n      }\n\n      {!showIntro &&\n        <Route {...rest} render={renderProps => {\n          return (\n            <Component {...renderProps} />\n          )\n        }}/>\n      }\n    </div>\n  )\n}\n\n\nclass App extends Component {\n  render() {\n    return (\n      <div>\n        <Switch>\n          <RouteWithIntro exact path=\"/login\" component={withRouter(Login)} />\n          <RouteWithIntro exact path=\"/\" component={view(JourneyBoard)} />\n          <RouteWithIntro exact path=\"/old\" component={Home} />\n          <RouteWithIntro exact path=\"/:room\" component={JourneySpace} />\n        </Switch>\n      </div>\n    )\n  }\n}\n\nexport default withRouter(view(App));\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/app.js","module.exports = __webpack_public_path__ + \"7d7cdc1523d104f06849d7e9c11e45db.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/file-loader!../node_modules/isomorphic-loader!../client/res/images/CuriousLive-logo.png\n// module id = 93\n// module chunks = 0","import React, { Component } from 'react';\nimport UserList from './user_list'\nimport GeneratorForm from './generator_form'\nimport EventMessage from './event_message'\nimport JourneySpaceForm from './journey_space_form'\nimport state from '../state'\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\nif (__CLIENT__) {\n  var { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n  const OT = require('@opentok/client');\n}\n\nexport default class Home extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      streams: [],\n      publisherId: '',\n      session: null,\n      totalConnectionsCreated: 0,\n      connectedUsers: []\n    }\n    this.publisher = {};\n  }\n\n  componentDidMount() {\n    const roomUrl = 'temp-home-location'\n\n    fetch(`/api/journeys/${roomUrl}`)\n      .then(res => res.json())\n      .then(json => {\n        this.sessionHelper = createSession({\n          apiKey: state.openTokKey,\n          sessionId: json.sessionId,\n          token: json.token,\n          onConnect: () => {\n            setTimeout(this.refreshSession, 1000);\n            fetch(`/api/journeys/${roomUrl}/joined`, {\n              body: JSON.stringify({id: this.sessionHelper.session.connection.id}),\n              credentials: 'same-origin', // include, same-origin, *omit\n              headers: {\n                'user-agent': 'Mozilla/4.0 MDN Example',\n                'content-type': 'application/json'\n              },\n              method: 'POST', // *GET, POST, PUT, DELETE, etc.\n              mode: 'cors', // no-cors, cors, *same-origin\n              redirect: 'follow', // manual, *follow, error\n              referrer: 'no-referrer', // *client, no-referrer\n            });\n          },\n          onStreamsUpdated: streams => {\n            this.setState({ streams });\n          }\n        });\n        window.sh = this.sessionHelper;\n        this.sessionHelper.session.on(\"connectionDestroyed\", (event) => {\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionDestroyed',\n\n          }\n\n          const updatedConnectionCount = this.state.totalConnectionsCreated - 1\n          this.setState({totalConnectionsCreated: updatedConnectionCount})\n\n          let newData = [...this.state.connectedUsers]\n          let index = newData.map(d => d.connectionId).indexOf(event.connection.id)\n          newData.splice(index, 1)\n          this.setState({connectedUsers: newData})\n        });\n\n\n\n        this.sessionHelper.session.on(\"connectionCreated\", (event) => {\n          const updatedConnectionCount = this.state.totalConnectionsCreated + 1\n          this.setState({totalConnectionsCreated: updatedConnectionCount})\n\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionCreated',\n          }\n\n          let tries = 10;\n          const fetchRetry = () => {\n            fetch(`/api/journeys/${roomUrl}/${event.connection.id}`).then(res => res.json()).then(json => {\n              if (!json && tries-- > 0) {\n                setTimeout(fetchRetry, 500);\n              } else {\n                this.setState({\n                  connectedUsers: [...this.state.connectedUsers, json]\n                });\n              }\n            });\n          }\n          fetchRetry();\n        });\n\n\n\n        this.sessionHelper.session.on(\"signal\", (event) => {\n          if (event.type === 'signal:displayJourneyRequest') {\n            this.setState({\n              displayMessageVisible: true,\n              displayMessageText: \"George has created a session 'Daily Jetsons Meditation'.\", //TEMP hard coded\n              sessionUrl: '/another-jetsons-url'\n            });\n          }\n        });\n\n        this.setState({\n          session: this.sessionHelper.session\n        });\n      });\n\n\n    fetch('/api/journeys')\n      .then(res => res.json())\n      .then(json => {\n        state.journeys = json;\n      });\n\n  }\n\n  render() {\n    return (\n      <div className=\"home container\">\n        <div className=\"row\">\n          <UserList userCount={this.state.totalConnectionsCreated} connections={this.state.connectedUsers} />\n          <div className=\"col-sm\">\n            <JourneySpaceForm />\n            <EventMessage journeys={state.journeys} />\n          </div>\n        </div>\n      </div>\n      )\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/home.js","import React, {Component} from 'react'\n\nexport default class UserList extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"col-sm\">\n        <h4>Current Users ({this.props.userCount})</h4>\n        <ul>\n          {this.props.connections.map(function(connection){\n            return <li key={connection.user.name}>{connection.user.name}</li>;\n          })}\n        </ul>\n      </div>\n    )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/user_list.js","import React, {Component} from 'react'\nimport state from '../state';\n\nexport default class GeneratorForm extends Component {\n\n  constructor(props){\n    super(props)\n    this.state = {\n      sessionLinkName: '',\n      sessionLinkUrl: '',\n      activeJourneys: []\n    }\n\n    this.handleNameChange = this.handleNameChange.bind(this)\n    this.urlFriendlyName = this.urlFriendlyName.bind(this)\n    this.createSessionLink = this.createSessionLink.bind(this)\n\n  }\n\n  createSessionLink() {\n    this.setState({sessionLinkUrl: this.urlFriendlyName(this.state.sessionLinkName) })\n    fetch('/api/sessions/test/temp-home-location')\n\n    fetch('/api/active_journeys')\n    .then(res => res.json())\n    .then(json => {\n      state.activeJourneys = json\n    });\n  }\n\n  sendNotifications() {\n\n  }\n\n  handleNameChange(event) {\n    this.setState({sessionLinkName: event.target.value})\n  }\n\n  urlFriendlyName(name){\n    return name.replace(/\\s+/g, '-').toLowerCase()\n  }\n\n\n  render() {\n      return(\n        <div>Hello</div>\n      )\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/generator_form.js","import React from 'react'\n\nconst EventMessage = (props) => {\n  return (\n    <div className=\"col-sm\">\n      {props.journeys.map((journey, index) => (\n        <p key={index}\n           style={{ backgroundColor: '#fc9', padding: '7px'}}>\n           A journey space has been created.\n           <br/>\n           <a href={\"/\" + journey.room} target=\"_blank\">Join</a>\n           &nbsp;&nbsp;\n           <a href=\"#\">Share</a></p>\n      ))}\n    </div>\n  );\n}\n\nexport default EventMessage\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/event_message.js","import React, {Component} from 'react'\nimport JourneyDetailEntry from './journey_detail_entry'\n\nexport default class JourneySpaceForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: false\n    }\n\n    this.toggleVisibility = this.toggleVisibility.bind(this)\n  }\n\n  toggleVisibility() {\n    this.setState({visible: !this.state.visible})\n  }\n\n  render() {\n      return (\n        <div className=\"col-sm\">\n          <div className=\"container\" style={{ border: '1px solid #e6e6e6', padding:'10px'}}>\n            <form>\n              <button type=\"button\" className=\"btn btn-outline-primary btn-block\" onClick={this.toggleVisibility}>\n                <i className=\"fa fa-plus\"></i>&nbsp;&nbsp;Create a new Journey Space\n              </button>\n              <JourneyDetailEntry detailVisibility={this.state.visible} />\n            </form>\n          </div>\n        </div>\n      )\n  }\n\n\n}\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/journey_space_form.js","import React, {Component} from 'react'\nimport SessionInfo from './session_info'\n\nexport default class JourneyDetailEntry extends Component {\n\n    constructor(props){\n    super(props)\n    this.state = {\n      visible: false,\n      sessionVisible: false,\n      sessionLinkName: '',\n      sessionLinkUrl: '',\n      activeJourneys: []\n    }\n\n    this.handleNameChange = this.handleNameChange.bind(this)\n    this.urlFriendlyName = this.urlFriendlyName.bind(this)\n    this.createSessionLink = this.createSessionLink.bind(this)\n\n  }\n\n  createSessionLink() {\n    this.setState({sessionLinkUrl: this.urlFriendlyName(this.state.sessionLinkName) })\n    fetch('/api/sessions/test/temp-home-location')\n\n    fetch('/api/active_journeys')\n    .then(res => res.json())\n    .then(json => {\n      state.activeJourneys = json\n      this.setState({sessionVisible: true})\n    });\n  }\n\n  handleNameChange(event) {\n    this.setState({sessionLinkName: event.target.value})\n  }\n\n  urlFriendlyName(name){\n    return name.replace(/\\s+/g, '-').toLowerCase()\n  }\n\n\n  componentWillReceiveProps(nextProps) {\n    this.setState({ visible: nextProps.detailVisibility});\n  }\n\n\n  render() {\n    if(this.state.visible === true) {\n    return (\n      <div>\n        <h3>Enter Journey Details</h3>\n        <p>\n          Give your room a name:<br/>\n          <input type=\"text\" id=\"session_link\" onChange={this.handleNameChange} />\n        </p>\n        <p>\n          <input type=\"button\" className=\"btn btn-primary\" value=\"Create a journey space\" onClick={this.createSessionLink} />\n        </p>\n        <SessionInfo sessionVisibility={this.state.sessionVisible} sessionLink={this.state.sessionLinkUrl} />\n      </div>\n    )\n    } else {\n      return (\n        <div></div>\n      )\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/journey_detail_entry.js","import React, {Component} from 'react'\n\nexport default class SessionInfo extends Component {\n\n  constructor(props){\n    super(props)\n    this.state = {\n      visible: false,\n      sessionLinkUrl: ''\n    }\n\n    this.jumpToSession = this.jumpToSession.bind(this)\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.setState({ sessionLinkUrl: nextProps.sessionLink });\n    this.setState({ visible: nextProps.sessionVisibility });\n  }\n\n  jumpToSession() {\n    window.open(this.state.sessionLinkUrl, \"_blank\")\n  }\n\n  // TODO: npm install --save react@^16.2.0 react-dom@^16.2.0 for getDerivedstateFromProps\n\n  render() {\n    if(this.state.visible === true) {\n      return(\n        <div>\n          <strong>You created journey space!</strong>\n          <p><span style={{ fontWeight: 'bold', backgroundColor: '#ccc', padding: '7px' }}>www.wacuri.com/{this.state.sessionLinkUrl}</span>&nbsp;<input className=\"btn btn-primary\" type=\"button\" value=\"Jump to the session\" onClick={this.jumpToSession} /></p>\n        </div>\n      )\n\n    } else {\n      return (\n        <div></div>\n      )\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/session_info.js","// journey_space.js -- The main page where the Curious Live Journeys are experienced.\n// Copyright (C) 2018 Robert L. Read <read.robert@gmail.com>\n\n// This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n\n// This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.\n\n// You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.\n\nimport EventEmitter from 'events';\nimport React, {Component} from 'react';\nimport { view } from 'react-easy-state';\nimport { Link } from 'react-router-dom';\nimport Cookie from 'js-cookie';\nimport SwipeableViews from 'react-swipeable-views';\nimport { virtualize } from 'react-swipeable-views-utils';\nimport { mod } from 'react-swipeable-views-core';\nconst VirtualizeSwipeableViews = virtualize(SwipeableViews);\n\n// import SignaturePad from './signature_pad';\nimport state from '../state';\nimport PropTypes from 'prop-types';\nimport uuid from 'uuid';\nimport {initLayoutContainer} from 'opentok-layout-js';\nimport './share';\nimport JourneyStartsIn from './journey_starts_in';\nimport Header from './header';\nimport Intro from './intro';\n\n// This may not be the right way to do this\n// var Rating = require('react-rating');\nimport Rating from 'react-rating';\n\nimport * as someHelper from '../utility/utility'\n\nrequire('es6-promise').polyfill();\nrequire('isomorphic-fetch');\n\n\nvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = {};\n\nif (__CLIENT__) {\n\tvar { OTSession, OTPublisher, OTStreams, OTSubscriber, createSession } = require('opentok-react');\n\tconst OT = require('@opentok/client');\n\twindow.state = state;\n}\n\n\nclass LeaveRoomButton extends Component {\n\n  onLeave = (e) => {\n    e.preventDefault();\n    if (!state.audioTag.paused) {\n      state.audioTag.pause();\n    }\n      this.props.history.push('/');      \n  }\n\n  render() {\n    return (\n      <button onClick={this.onLeave} className='btn btn-primary'>Leave</button>\n    )\n  }\n}\n\n\nclass AbstractTimerEmitter extends EventEmitter {\n  _displayTime(millisec: number) {\n    if (millisec < 0) { return '0:00'; }\n    const normalizeTime = (time: string): string => (time.length === 1) ? time.padStart(2, '0') : time;\n\n    let seconds: string = (millisec / 1000).toFixed(0);\n    let minutes: string = Math.floor(parseInt(seconds) / 60).toString();\n    let hours: string = '';\n\n    if (parseInt(minutes) > 59) {\n     hours = normalizeTime(Math.floor(parseInt(minutes) / 60).toString());\n     minutes = normalizeTime((parseInt(minutes) - (parseInt(hours) * 60)).toString());\n    }\n    seconds = normalizeTime(Math.floor(parseInt(seconds) % 60).toString());\n\n    if (hours !== '') {\n      return `${hours}:${minutes}:${seconds}`;\n    }\n    return `${minutes}:${seconds}`;\n  }\n}  \n\nclass SecondsTimerEmitter extends AbstractTimerEmitter {\n  constructor(createdAt, startAt) {\n    super();\n    this.start = createdAt.getTime();\n    this.total = startAt.getTime() - this.start;\n    this.passed = new Date().getTime() - this.start;\n    this.interval = setInterval(() => {\n      this.passed = new Date().getTime() - this.start;\n      if (this.passed >= this.total) {\n        clearInterval(this.interval);\n      }\n      this.emit('tick', this.passed);\n    }, 100);\n  }\n\n  clear() {\n    clearInterval(this.interval);\n  }\n\n  displayTime() {\n    return this._displayTime(this.total - this.passed);\n  }\n  \n}\n\nclass AudioPlayTickEmitter extends AbstractTimerEmitter {\n  constructor(audioElement) {\n    super();\n    this.currentTime = (audioElement.currentTime || 0) * 1000;\n    this.total = audioElement.duration * 1000;\n    if (audioElement.readyState === 4) {\n      audioElement.addEventListener('timeupdate', this.onTimeUpdate);\n      this.emit('tick', audioElement.currentTime * 1000);\n    }\n\n    audioElement.addEventListener('loadedmetadata', (e) => {\n      audioElement.addEventListener('timeupdate', this.onTimeUpdate);\n      this.total = e.target.duration * 1000;\n      this.emit('tick', audioElement.currentTime * 1000);\n    });\n  }\n\n\n  onTimeUpdate = (e) => {\n    this.currentTime = e.target.currentTime * 1000;\n    this.emit('tick', this.currentTime);\n  }\n\n  clear() {\n    \n  }\n\n  displayTime() {\n    return this._displayTime(this.total - this.currentTime);\n  }\n}\n\nconst FlagControl = ({currentUserHasFlaggedStream, stream, onFlag, children}) => {\n  return (\n    <button \n      className='btn-flag-session'\n      disabled={currentUserHasFlaggedStream}\n      onClick={(e) => { e.preventDefault(); onFlag(stream); }}>\n      {children}  \n    </button>\n  )\n}\nclass Waiting extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      open: true\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.canvas) {\n      var signaturePad = new SignaturePad(this.canvas, {\n        backgroundColor: 'rgb(255, 255, 255)',\n        penColor: '#666',\n        minWidth: 1,\n        maxWidth: 10,\n      });\n\n      var _this = this;\n      function fadeOut() {\n        var ctx = _this.canvas.getContext('2d');\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n        ctx.fillRect(0, 0, _this.canvas.width, _this.canvas.height);\n        setTimeout(fadeOut,100);\n      }\n\n      var ctx = _this.canvas.getContext('2d');\n      ctx.fillStyle = \"rgba(42,42,42,1)\";\n      ctx.fillRect(0, 0, _this.canvas.width, _this.canvas.height);\n      \n      fadeOut();\n    }\n  }\n\n  onToggle = (e) => {\n    this.setState({\n      open: !this.state.open\n    });\n  }\n\n  render() {\n    return (\n      <div style={{overflow: 'hidden', position: 'relative'}}>\n        {!this.state.open &&\n          <div>\n            <p>Chill out, draw something:</p>\n            <div className='wrapper'>\n              <canvas className='signature-pad' ref={el => this.canvas = el} width={400} height={400}/>\n            </div>\n          </div>\n        }\n        <div className='waiting' style={{transform: `translateY(${this.state.open ? '0' : '94%'})`, position: `${this.state.open ? 'relative' : 'absolute'}`}}>\n          <a className='text-right mr-3' style={{display: 'block', color: 'white'}} href='#' onClick={this.onToggle}>{this.state.open ? 'Close X' : 'Open ^'}</a>\n          <div style={{WebkitOverflowScrolling: 'touch', overflowY: 'scroll'}}>\n            <iframe height='100%' width='100%' style={{width: '100%', height: '400px', border: 'none'}} src='https://docs.google.com/viewer?url=http://wacuri.herokuapp.com/CuriousLive4-Stage%20Orientation.pdf&embedded=true'/>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nclass JourneyStateProgressBar extends Component {\n\n  constructor(props) {\n    super(props);\n    props.timer.on('tick', (current) => {\n      this.setState({\n        timerValue: current\n      });\n    });\n    this.state = {\n      timerValue: 0,\n      total: props.timer.total,\n    }\n  }\n\n  componentWillReceiveProps(newProps) {\n    newProps.timer.on('tick', (current) => {\n      this.setState({\n        timerValue: current\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.timer.clear();\n  }\n\n  formatState(state: number) {\n    switch(this.props.journey.state) {\n      case 'joined':\n      case 'created':\n        return 'Waiting';\n      case 'started':\n      case 'paused':\n        return 'The Journey';\n      case 'ended':\n        return 'The Sharing';\n      case 'failed':\n        return 'No one joined';\n      default:\n        return 'Waiting';\n    }\n  }\n\n  render() {\n    return (\n      <div className='journeyspace-progress pl-3 pr-3'>\n        <small>Current Section</small>\n        <progress max={this.props.timer.total} value={this.state.timerValue} style={{width: '100%'}}></progress>\n        <div style={{display: 'flex'}}>\n          <p>{this.formatState(this.props.journey.state)}</p>\n          <p style={{marginLeft: 'auto'}}>-{this.props.timer.displayTime()}</p>\n        </div>\n      </div>\n    )\n  }\n}\n\n// I need to create a new react component here. Possibly this would be releasable on its own.\n// The basic idea we need here is a changing piece of text, with bars beneath it to indicate the state.\n// Possibly I should develop this component separately, completely outside this project.\n// \n // To be done: We need to define an additional state to represent \"the completion of the journey\"\n// We need to implement the state indicator bar as a series of colors. This should be\n// easy with background color and CSS\n\n// We need to implement the \nclass JourneyPhases extends Component {\n\n  constructor(props) {\n    super(props);\n    props.timer.on('tick', (current) => {\n      this.setState({\n        timerValue: current\n      });\n    });\n  }\n\n  componentWillReceiveProps(newProps) {\n    newProps.timer.on('tick', (current) => {\n      this.setState({\n        timerValue: current\n      });\n    });\n  }\n\n    get stepIndex() {\n    switch(this.props.journey.state) {\n      case 'joined':\n      case 'created':\n        return 0;\n      case 'failed':\n\treturn 3;\n      case 'started':\n      case 'paused':\n        return 1;\n      case 'completed':\n\treturn 2;\n      case 'ended':\n\treturn 2;\n    case 'playing':\n\treturn 1;\n    case 'paused':\n\treturn 1;\n      default:\n        return 2;\n    }\n  }\n    // Note: setting the backgroudnColor below to orange does not work, but at least gives us a\n    // gray that can be seen against the black background\n   \n  render() {\n      const {journey} = this.props;\n      const NumPhases = 4;\n      const Messages = [\"Breathe and center yourself\",\"Journey in Progess\",\"Share your Insights\",\"Provide Feedback\"];\n    return (\n\t    <div ref={el => {this.container = el}} id={'journey-timeline0'} className={`journey-timeline step-${this.stepIndex.toString()}`}>\n\t    <div>\n\t    <div style={{display: 'flex', flexDirection: 'row' }}>\n\t    <span>{Messages[this.stepIndex]}</span>\n\n\t{ state.journey.startAt &&\n\t    (this.stepIndex == 0) &&\n                <span className='timer' style={{marginLeft: '10px'}}>{this.props.timer.displayTime()}</span>\n\t}\n\t    </div>\n\t    </div>\n\t    <div id={'phase-bar0'}>\n\t    <div className={ `phase-bar bar-${this.stepIndex == 0 ? 'white' : 'green'}`}>\n\t      </div>\n\t    <div className={ `phase-bar bar-${this.stepIndex == 1 ? 'white' : 'green'}`}>\n\t      </div>\n\t    <div className={ `phase-bar bar-${this.stepIndex == 2 ? 'white' : 'green'}`}>\n\t      </div>\n\t    <div className={ `phase-bar bar-${this.stepIndex == 3 ? 'white' : 'green'}`}>\n\t      </div>\n\t    </div>\n\t</div>\t\t\t\n    )\n  }\n}\n\n/*\nclass JourneyTimeline extends Component {\n\n  constructor(props) {\n    super(props);\n    props.timer.on('tick', (current) => {\n      this.setState({\n        timerValue: current\n      });\n    });\n  }\n\n  componentWillReceiveProps(newProps) {\n    newProps.timer.on('tick', (current) => {\n      this.setState({\n        timerValue: current\n      });\n    });\n  }\n\n  get stepIndex() {\n    switch(this.props.journey.state) {\n      case 'joined':\n      case 'created':\n        return 0;\n      case 'started':\n      case 'paused':\n        return 1;\n      default:\n        return 2;\n    }\n  }\n\n  get positionForCaret() {\n    if (!this.container) { return 0; }\n    const idx = this.stepIndex;\n    const items = this.container.querySelectorAll('li');\n    return Array(idx + 1).fill(0).reduce((memo, i, j) => {\n      if (j == 0) {\n        return 0;\n      } else {\n        return memo + items[j - 0].offsetHeight;\n      }\n    }, 0);\n  }\n  \n  get heightForActive() {\n    if (!this.container) { return 0; }\n    const idx = this.stepIndex;\n    const items = this.container.querySelectorAll('li');\n    return items[idx].offsetHeight;\n  }\n\n  onSeek = (e) => {\n    const percent = e.nativeEvent.offsetX / this.progressBar.offsetWidth;\n    this.props.seekTo(percent);\n  }\n\n    // Note: setting the backgroudnColor below to orange does not work, but at least gives us a\n    // gray that can be seen against the black background\n   \n  render() {\n    const {journey} = this.props;\n    return (\n\t    <div ref={el => {this.container = el}} className={`journey-timeline step-${this.stepIndex.toString()}`}>\n\t    <div style={{display: 'flex'}}>\n        <ul>\n          <li key=\"Prepare\" className={journey.state === 'joined' ? 'active' : ''}>\n            <h4>Prepare</h4>\n            <div style={{display: 'flex'}}>\n              <p>Breathe and center yourself</p>\n              {journey.state === 'joined' && journey.startAt &&\n                <p className='timer' style={{marginLeft: '10px'}}>{this.props.timer.displayTime()}</p>\n              }\n        </div>\n            </li>\n\t    </ul>\n\t    <ul>\n          <li key=\"Journey\" className={journey.state === 'started' ? 'active' : ''} style={{position: 'relative'}}>\n            <h4>Journey</h4>\n            <div style={{display: 'flex'}}>\n              <p>Listen and imagine</p>\n              {(journey.state === 'started' || journey.state === 'paused') &&\n                <p className='timer' style={{marginLeft: '10px'}}>{this.props.timer.displayTime()}</p>\n              }\n              {(journey.state === 'started' || journey.state === 'paused') &&\n                <div style={{position: 'absolute', bottom: '-12px', left: '10px', right: '10px'}}>\n               <progress ref={(progressBar) => this.progressBar = progressBar} onClick={this.onSeeko} max={this.props.timer.total} value={this.props.timer.currentTime} style={{width: '90%',backgroundColor: 'orange'}}></progress>\n                </div>\n              }\n            </div>\n            </li>\n\t    </ul>\n\t    <ul>\n          <li key=\"Sharing\">\n            <h4>Sharing</h4>\n            <p>Feelings and thoughts</p>\n          </li>\n\t\t\t</ul>\n\t\t\t</div>\n\t</div>\t\t\t\n    )\n  }\n}\n*/\nclass SkipButton extends Component {\n    constructor(props) {\n       super(props);\n    }\n    skipToNext = (e) => {\n\tconsole.log(\"SKIP TO NEXT CALLED\");\n\te.preventDefault();\n   // This seeking to near the end works better than just calling skip, because it allows our natural processes to continue.\n    // fetch(`/api/journeys/${this.props.journey.room}/skip`, {\n    //   cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n    //   credentials: 'same-origin', // include, same-origin, *omit\n    //   headers: {\n    //     'content-type': 'application/json'\n    //   },\n    //   method: 'POST', // *GET, POST, PUT, DELETE, etc.\n    //   mode: 'cors', // no-cors, cors, *same-origin\n    //   redirect: 'follow', // manual, *follow, error\n    //   referrer: 'no-referrer', // *client, no-referrer\n    // });\n      // I believe this should change the state to completed, but I am not sure\n      // if that happens server side or client side\n\tconsole.log(\"skipToNext event fired\");\n\tconst vid = this.props.vidid;\n\tconst playerState = this.props.playerState;\n\tconst seekTo = this.props.seekTo;\n\t// This is my attempt to seek to the end....\n\t// It is not clear how the audio really works; I am not sure that \"seek\" functions.\n\tseekTo(99/100);\n\t// figure out how to pause, and how to seek correctly....\n  }\n\n    render() {\n\treturn (\n\t    <span className={`fa-stack`} onClick={this.skipToNext}>\n\t    <i className='fa fa-circle fa-stack-2x' \n\tstyle={{color: 'rgb(75,176,88)'}}\n\t    ></i>\n\t    {\n            <i className={`fa fa-step-forward fa-stack-1x`}\n\t     style={{color: 'white'}}></i>\n\t     }\n\t\t </span>\n    )\n  }\n}\n\nclass VideoButton extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      publishing: true\n    }\n  }\n\n  toggle = (e) => {\n    e.preventDefault();\n    const {publisher} = this.props;\n    if (publisher && publisher.state && publisher.state.publisher) {\n      publisher.state.publisher.publishVideo(!this.state.publishing);\n      this.setState({\n        publishing: !this.state.publishing\n      });\n    }\n  }\n\n  render() {\n    return (\n\t    <span className={`fa-stack`} onClick={this.toggle}>\n\t    <i className='fa fa-circle fa-stack-2x' \n\tstyle={{color: 'rgb(75,176,88)'}}\n\t    ></i>\n\t    {\n            <i className={`fa fa-video-camera fa-stack-1x`}\n\t     style={{color: 'white'}}></i>\n\t     }\n\t\t </span>\n    )\n  }\n}\n\nclass AudioButton extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      publishing: true\n    }\n\n    // This binding is necessary to make `this` work in the callback -- ROB IS TRYING THIS  \n    this.toggleMicrophone = this.toggleMicrophone.bind(this);\n  }\n\n    // NOTE: This seems like a good idea, and it causes no problem on Chrome,\n    // but it makes a complete failure on Safari, so I am giving up this feature.\n    \n  //   componentWillReceiveProps(nextProps) {\n  // \tconsole.log(\"WillReceiveProps called\");\n  // \tconst {publisher} = nextProps;\n\n  // \tconsole.log(\"WillReceiveProps called\",publisher);\t\n  // \tif (publisher && publisher.state && publisher.state.publisher) {\n\n  // \t    // WARNING: Commneting this out is partially working --- it is controlling things in a one-way direction.\n  // \t    // the active drop down on the video image is not correctly tied to this on Safari.\n  // \t    // Rob believes this is cauising a bug on Safari...\n  // \t    // Note that there is a warning on the log in Chrome about an \"unmounted componnets\".\n  //     publisher.state.publisher.on('audioLevelUpdated', (event) => {\n  //       if (event.audioLevel === 0) {\n  //         this.setState({\n  //           publishing: false\n  //         });\n  //       } else {\n  //         this.setState({\n  //           publishing: true\n  //         });\n  //       }\n  //     });\n  //   }\n  // }\n    componentDidUpdate(prevProps) {\n  // Typical usage (don't forget to compare props):\n  if (this.props.userID !== prevProps.userID) {\n      this.fetchData(this.props.userID);\n  }\n}\n\n    changeToggleValue = () => {\n\tthis.setState((prevState) => {\n\t    return { publishing: !prevState.publishing};\n\t})\n    };\n    \n    toggleMicrophone = (e) => {\n\tconst DEBUG_MUTE = 1;\t\n\te.preventDefault();\n      const {publisher} = this.props;\n      if (DEBUG_MUTE) {\n\t  console.log(\"Initial Publishing State:\",this.state.publishing);\n\t  console.log(publisher,publisher.state,publisher.state.publisher);\n      }\n\t// ON SAFARI, this state is never changing!\n\t\n    if (publisher && publisher.state && publisher.state.publisher) {\n\tpublisher.state.publisher.publishAudio(!this.state.publishing);\n\tthis.changeToggleValue();\n    }\n\tif (DEBUG_MUTE) {\n\t  console.log(\"FINAL this.publishing:\",this.state.publishing);\n\t  console.log(\"FINAL state:\",this.state);\t  \n      }\n\n\t// This is absolutely necessary, but insuffient to make it work properly.\n\te.stopPropagation();\n  }\n  \n\n  render() {\n    return (\n/*\t    <button id=\"microphoneButton\" style={this.props.style || {}} onClick={this.toggleMicrophone} className={`btn btn-${this.state.publishing ? 'primary' : 'secondary'}`}> \n\n\t    <i className=\"fa fa-microphone fa-fw\" ></i>\n\t    </button>\n*/\t    \n\t    <span className={`fa-stack`} onClick={this.toggleMicrophone}>\n\t    <i className='fa fa-circle fa-stack-2x' \n\tstyle={{color: 'rgb(75,176,88)'}}\n\t    ></i>\n\t    {\n            <i className={`fa fa-microphone fa-stack-1x`}\n\t     style={{color: 'white'}}></i>\n\t     }\n\t\t </span>\n\n\t\n    )\n  }\n}\n\nclass PlayButton extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: (props.player && props.player.paused) || true\n    }\n      props.player.addEventListener('play', () => {\n      this.setState({\n        paused: false\n      });\n    // This binding is necessary to make `this` work in the callback -- ROB IS TRYING THIS  \n    this.togglePlay = this.togglePlay.bind(this);\n    });\n\n    props.player.addEventListener('pause', () => {\n      this.setState({\n        paused: true\n      });\n    });\n  }\n\n    togglePlay = (e) => {\n    e.preventDefault();\n    setTimeout(() => {\n      if (state.audioTag.paused) {\n        fetch(`/api/journeys/${this.props.journey.room}/start`, {\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'content-type': 'application/json'\n          },\n          method: 'POST',\n          mode: 'cors',\n        });\n      } else {\n        fetch(`/api/journeys/${this.props.journey.room}/pause`, {\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'content-type': 'application/json'\n          },\n          method: 'POST',\n          mode: 'cors',\n        });\n      }\n    }, 20);\n  }\n\n    render() {\n    return (\n\t    <span className='fa-stack play-button' onClick={this.togglePlay}>\n\t    <i className='fa fa-circle fa-stack-2x'\n    \t      style={{color: 'rgb(74,170,221)'}}\n\t    ></i>\n\t    {\n            <i className={`fa fa-${state.audioTag.paused ? 'play' : 'pause'} fa-stack-1x`}\n\t     style={{color: 'white'}}></i>\n\t     }\n\t\t </span>\n    )\n  }\n}\n\n// This is oddly similar and anti-symmetric to the PlayButton.\nclass PauseButton extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: (props.player && props.player.paused) || true\n    }\n      props.player.addEventListener('play', () => {\n      this.setState({\n        paused: false\n      });\n    // This binding is necessary to make `this` work in the callback -- ROB IS TRYING THIS  \n    this.togglePlay = this.togglePlay.bind(this);\n    });\n\n    props.player.addEventListener('pause', () => {\n      this.setState({\n        paused: true\n      });\n    });\n  }\n\n    togglePlay = (e) => {\n    e.preventDefault();\n    setTimeout(() => {\n      if (state.audioTag.paused) {\n        fetch(`/api/journeys/${this.props.journey.room}/start`, {\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'content-type': 'application/json'\n          },\n          method: 'POST',\n          mode: 'cors',\n        });\n      } else {\n        fetch(`/api/journeys/${this.props.journey.room}/pause`, {\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'content-type': 'application/json'\n          },\n          method: 'POST',\n          mode: 'cors',\n        });\n      }\n    }, 20);\n  }\n\n    render() {\n    return (\n\t    <span className='fa-stack' onClick={this.togglePlay}>\n\t    <i className='fa fa-circle fa-stack-2x' onClick={this.togglePlay}\n\tstyle={{color: 'rgb(75,176,88)'}}\n\t    ></i>\n\t    {\n            <i className={`fa fa-${state.audioTag.paused ? 'pause' : 'play'} fa-stack-1x`}\n\t     style={{color: 'white'}}></i>\n\t     }\n\t\t </span>\n    )\n  }\n}\n\n\n\nclass SharePrompt extends Component {\n\n  render() {\n    return (\n      <div className='journeyspace-sharePrompt' style={{textAlign: 'center'}}>\n        <p style={{fontFamily: 'Playfair Display, serif', fontSize: '25px', lineHeight: 0.8}}>If you would like to invite a friend you can make this a permanent JourneySpace:</p>\n        <button className='btn btn-primary' onClick={this.props.onInvite}>Invite Friends</button>\n      </div>\n    )\n  }\n}\n\nclass InviteModal extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      journeySpaceName: '',\n      error: false\n    }\n  }\n\n    onChange = (e) => {\n    e.preventDefault();\t\n    this.setState({\n      journeySpaceName: e.target.value,\n      error: this.state.error && e.target.value != ''\n    });\n\te.stopPropagation();\t\n  }\n\n  onCopy = (e) => {\n    e.preventDefault();\n    if (this.state.journeySpaceName === '') {\n      this.setState({\n        error: 'please enter a name'\n      });\n    } else {\n      this.setState({\n        error: false\n      });\n      const name = this.state.journeySpaceName;\n      const urlFriendlyName = name.replace(/[^\\w]/g, '-').toLowerCase();\n      const url = `${window.location.protocol}//${window.location.host}/${urlFriendlyName}`;\n      const success = this._copy(url);\n      if (success) {\n        this.props.onComplete(url, name);\n      } else {\n        this.setState({\n          error: 'failed to copy url'\n        });\n      }\n    }\n  }\n\n  _copy(url) {\n    // A <span> contains the text to copy\n    const span = document.createElement('span');\n    span.textContent = url;\n    span.style.whiteSpace = 'pre'; // Preserve consecutive spaces and newlines\n\n    // Paint the span outside the viewport\n    span.style.position = 'absolute';\n    span.style.left = '-9999px';\n    span.style.top = '-9999px';\n\n    const win = window;\n    const selection = win.getSelection();\n    win.document.body.appendChild(span);\n\n    const range = win.document.createRange();\n    selection.removeAllRanges();\n    range.selectNode(span);\n    selection.addRange(range);\n\n    let success = false;\n    try {\n        success = win.document.execCommand('copy');\n    } catch (err) {}\n\n    selection.removeAllRanges();\n    span.remove();\n\n    return success;\n  }\n\n  render() {\n    return (\n      <div style={{width: '100%', height: '100%', position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(89, 153, 222, 0.9)'}} className='journeyspace-invite'>\n        <a href='#' onClick={this.props.onClose} style={{position: 'absolute', right: '20px', top: '20px'}}>\n          <i className='fa fa-times' style={{fontSize: '22px', color: 'white'}}/>\n        </a>\n        <div style={{textAlign: 'center', position: 'fixed', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', padding: '0 20px', minWidth: '90%'}}>\n          <p style={{fontSize: '26px', lineHeight: 0.8, fontFamily: 'Playfair Display, serif', color: 'white'}}>Share your new permanent CuriousLive Space with Friends</p>\n          <input type='text' value={this.state.journeySpaceName} onChange={this.onChange} placeholder='Name Your Space'/>\n          {this.state.error && <p className='text-danger'>{this.state.error}</p>}\n          <p style={{margin: '10px 0 10px 0'}}>Share Using</p>\n          <ul style={{listStyle: 'none', margin: 0, padding: 0}}>\n            <li onClick={this.onCopy} style={{width: '90px', height: '90px', margin: '0 auto', cursor: 'pointer'}}>\n              <i className='fa fa-link' style={{display: 'flex', background: 'white', height: '70px', flexDirection: 'row', alignItems: 'center', justifyContent: 'center', fontSize: '38px'}}/>\n              <p>Copy Link</p>\n            </li>\n          </ul>\n        </div>\n      </div>\n    )\n  }\n}\n\n\nclass OrientationModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n\tindex: 0\n    }\n  }\n\n    onChange = (e) => {\n    e.preventDefault();\t\n    this.setState({\n      journeySpaceName: e.target.value,\n      error: this.state.error && e.target.value != ''\n    });\n\te.stopPropagation();\t\n    }\n\n    left = () => {\n\tthis.handleChangeIndex((this.state.index-1) % 3);\n    }\n    right = () => {\n\tthis.handleChangeIndex((this.state.index+1) % 3);\t\n    }\n\n    handleChangeIndex = index => {\n\tthis.setState(\n\t    {index: index}\n\t);\n    };\n\n  render() {\n      function slideRenderer(params) {\n\t  console.log(\"params\", params);\n  const { index, key } = params;\n\n  switch (mod(index, 3)) {\n    case 0:\n      return (\n\t    <div>\n<p className='message-heading'>1.  Welcome to CuriousLive ...<br/>\n\t      A five-minute guided journey - plus sharing - with others.</p>\n\t      <p/>\t      \n<p>\nThe journey will begin when the timer above elapses and you hear the cime.\n</p>\n<p>\nBreathe slowly and deeply and ajust your posture to be comfortable.\n\t    </p>\n\t      </div>\n      );\n\n    case 1:\n      return (\n    <div>\t    \n\t      <p className='message-heading'>2.  Next comes the Journey...</p>\n\t      <p/>\t      \n<p>\nYour microphone will be muted.\n</p>\n<p>\nSome people like to leave their cameras on during the journey to increase the feeling of a shared experience. It is up to you.\n\t    </p>\n\t    </div>\n\t      \n      );\n\n    case 2:\n      return (\n\t    <div>\n\t      <p className='message-heading'>3.  After the Journey comes the Sharing and Connecting.</p>\n\t      <p/>\n<p>\n\t    After the journey you will have the opportunity to share your insights.\n\t    Each person takes 1 or 2 minutes.\n</p>\n\t    <p>\n\t    When others are sharing, please listen deeply, and in turn they will listen more deeply to you.\n\t    </p>\n\t    </div>\n      );\n\n    default:\n      return null;\n  }\n}\n\n    const index = this.state.index;\n    return (\n\t    <div style={{position: 'absolute',\n\t\t\t minHeight: `${someHelper.ONE_SQUARE_WIDTH}px`,\n\t\t\t maxWidth: `${someHelper.ONE_SQUARE_WIDTH}px`,\n\t\t\t maxHeight: `${someHelper.ONE_SQUARE_WIDTH}px`,\n\t\t\t minWidth: `${someHelper.ONE_SQUARE_WIDTH}px`,\t\t\t \n\t\t\t backgroundColor: 'rgba(74, 170, 221, 1.0)',\n\t\t\t display: 'flex',\n\t\t\t flexFlow: 'column nowrap',\n\t\t\t justifyContent: 'center'\n\t\t\t }\n\t\t       }>\n            <a href='#' onClick={this.props.onClose} style={{position: 'absolute', right: '20px', top: '20px', zIndex: 100}}>\n          <i className='fa fa-times fa-2x' style={{color: 'white'}}/>\n        </a>\n\t    <div style={{\n\t    \t\t display: 'flex',\n\t\t\t flexFlow: 'column nowrap',\n\t\t\t justifyContent: 'center'\n\t    }}>\n\t    <VirtualizeSwipeableViews\n          index={this.state.index}\n          onChangeIndex={this.handleChangeIndex}\n        slideRenderer={slideRenderer}\n\tclassName='swipable-message'\n        />\t    \n\t    </div>\n\t    <button  onClick={this.left} style={{visibility: `${(index == 0) ? 'hidden' : 'visible'}`, position: 'absolute', left: '20px', top: '50%', zIndex: 100,  backgroundColor: 'rgb(74,170,221)', color: 'white', border: '0px'}}>\n\t    \t    <i className=\"fa fa-caret-left fa-3x\"></i>\n\t</button>\n\t    <button onClick={this.right} style={{visibility: `${(index == 2) ? 'hidden' : 'visible'}`, position: 'absolute', right: '20px', top: '50%', zIndex: 100,  backgroundColor: 'rgb(74,170,221)', color: 'white', border: '0px'}}>\n\t    \t    <i className=\"fa fa-caret-right fa-3x\" ></i>\n\t    </button>\n\t</div>\t    \n    )\n  }\n}\n\n\nclass FeedbackModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      journeySpaceName: '',\n      error: false\n    }\n  }\n\n    onChange = (e) => {\n    e.preventDefault();\t\n    this.setState({\n      journeySpaceName: e.target.value,\n      error: this.state.error && e.target.value != ''\n    });\n\te.stopPropagation();\t\n    }\n    onSubmit = (e) => {\n\tconsole.log(\"onSubmit clicked!\");\n    }\n    onInvite = (e) => {\n\tconsole.log(\"onInvite clicked!\");\t\n    }\n    \n    render() {\n\tconsole.log(\"journeySpacename\",this.state.journeySpaceName);\n\tconsole.log(\"journeySpacename\",this.props.journeySpaceName);\t\n    return (\n\t    <div style={{position: 'absolute',\n\t\t\t minHeight: `${someHelper.ONE_SQUARE_WIDTH}px`,\n\t\t\t maxWidth: `${someHelper.ONE_SQUARE_WIDTH}px`,\n\t\t\t maxHeight: `${someHelper.ONE_SQUARE_WIDTH}px`,\n\t\t\t minWidth: `${someHelper.ONE_SQUARE_WIDTH}px`,\t\t\t \n\t\t\t width: `${someHelper.ONE_SQUARE_WIDTH}px`,\t\t\t \n\t\t\t backgroundColor: 'rgba(89, 153, 222, 0.9)',\n\t\t\t display: 'flex',\n\t\t\t flexDirection: 'column',\n\t\t\t justifyContent: 'center',\n\t\t\t alignItems: 'center'\t\t\t\t\t \n\t\t\t }\n\t\t       }>\n\n            <a href='#' onClick={this.props.onClose} style={{position: 'absolute', right: '20px', top: '20px', zIndex: 100}}>\n          <i className='fa fa-times' style={{fontSize: '22px', color: 'white'}}/>\n            </a>\n\n            <div style={{\n\t\tdisplay: 'flex',\n\t\tflexDirection: 'column',\t\t\n\t\tjustifyContent: 'space-between',\n\t\talignItems: 'center',\n\t\tpadding: '1rem'\n\t    }}>\n\n\t    <p> Please rate your experience for: </p>\n\t    <p> \"{this.props.journeySpaceName}\"</p>\n\t    <div>\n\t    <Rating start={0} stop={10} className='feedback-rating'\n\temptySymbol=\"fa fa-circle rating-circle feedback-empty\"\n\tfullSymbol=\"fa fa-circle rating-circle feedback-full\" />\n\t    <div  style={{\n\t\tdisplay: 'flex',\n\t\tflexDirection: 'row',\t\t\n\t\tjustifyContent: 'space-between',\n\t    }}>\n\t    <div>1</div> <div>10</div> </div>\n\t    </div>\n\t    <p> How do you Feel?</p>\n\t    <div>\n\t    <Rating start={0} stop={10} className='feedback-rating'\n\temptySymbol=\"fa fa-circle rating-circle feedback-empty\"\n\tfullSymbol=\"fa fa-circle rating-circle feedback-full\"  />\n\t    <div  style={{\n\t\tdisplay: 'flex',\n\t\tflexDirection: 'row',\t\t\n\t\tjustifyContent: 'space-between',\n\t    }}>\n\t    <div>Worse</div>\n\t    <div>The Same</div>\n\t    <div>Better</div>\n\t    </div>\n\t    </div>\n\t    <p />\n\t    <p />\t    \n\t    <div className=\"form-group\"\n\t    style={{\n\t\tdisplay: 'flex',\n\t\tflexDirection: 'column',\n\t\talignItems: 'center',\t\t\t\t\t \n\t\tjustifyContent: 'space-between',\n\t\twidth: '100%'\n\t    }}>\n\t    <textarea className=\"form-control rounded-0\" id=\"exampleFormControlTextarea2\" rows=\"4\"\n\tstyle={{borderRadius: '15px',\n\t\tmarginLeft: '1rem',\n\t\tmarginRight: '1rem',\n\t\tmarginBottom: '0px'\n\t       }}\n\t    >\n\t    </textarea>\n\t    </div>\n            <button className='invite-button feedback-button' onClick={this.onSubmit}\n\tstyle={{borderRadius: '15px',\n\t\tmarginLeft: '1rem',\n\t\tmarginRight: '1rem',\n\t\tmarginTop: '-2rem'\t\t\n\t       }}\n \t    >Submit Feedback</button>\n</div>\n\t    <p />\n\t    <p />\t    \t    \n                  <button className='invite-button feedback-button' onClick={this.onInvite}\n \t              >Invite Friends to a New Journey</button>\n\n\t    </div>\t    \n    );\n    }\n}\n\n\nclass UnfilledVideoSquare extends React.Component {\n  constructor(props) {\n      super(props);\n  }\n    // TODO: onFlag must be moved here\n  render() {\n      const vid = this.props.vidid;\n      const slength = this.props.streamlength;\n      const stream = this.props.stream;\n      const session = this.props.session;\n      const localkey = this.props.localkey;\n      const limit = this.props.limit;\n      const state = this.props.state;\n      const journey = this.props.journey;\n      const sessionId = this.props.sessionId;\n      const hasFlagged = (stream) ? !!journey.flags.find(flag => flag.user === sessionId && flag.flagged === stream.id) : false;\n      const visible = this.props.visible;      \n      const hide_control = (!visible) ||\n      \t    !(state.playerState == \"waiting\" ||\n\t      state.playerState == \"failed\");\n\n      console.log(\"visible\",visible);\n\n      return ((slength < limit) ?\n\t      <div key={localkey} id={vid} className='video-placeholder'>\n\t      <div className='invite-indicator'>\n\t      <div style={{visibility: `${hide_control ? 'hidden' : 'visible'}` }}>\n              <i className='fa fa-smile-o fa-2x'></i>\n              <p style={{color: 'white', maxWidth: '80%', margin: '0 auto', fontSize: '1rem'}}>Waiting...</p>\n              <button className='invite-button invite-friends-button'  onClick={this.props.onInvite}>Invite Friends\n\t        </button>\n\t      </div>\n\t      </div>\n\t      </div>\n\t\t\t\t     :\n\t      <div key={localkey} id={vid} className='PartnerStream'\n\t      >\n                            <OTSubscriber\n                              key={stream.id}\n                              session={session}\n                              stream={stream}\n                              properties={{\n                                width: '100%',\n                                height: '100%',\n                              }}\n                            />\n                          <div className='journeyspace-stream-controls'>\n              <FlagControl currentUserHasFlaggedStream={hasFlagged}\n\t          onFlag={this.onFlag} stream={stream.id}>\n              <i style={{color: hasFlagged ? 'red' : 'white'}}\n\t          className='fa fa-flag'></i>\n                              </FlagControl>\n                            </div>\n                        </div>\n\t\t    ); }\t  \n}\n\nclass NoVideoSquare extends React.Component {\n  constructor(props) {\n      super(props);\n  }    \n  render() {\n      const localkey = this.props.localkey;\n      const vid = this.props.vidid;\n      const feedbackNotOrientation =\n\t    this.props.playerState == 'ended' || this.props.playerState == 'completed';\n      const msg = (feedbackNotOrientation) ? \"Leave and Give Feedback\" : \"Orientation\"; \n      const topmsg = (feedbackNotOrientation) ? \"When all sharing is done...\" : \"nothing\";\n      const topmsgvis = (feedbackNotOrientation) ? \"visible\" : \"hidden\";       \n      const fnc = (feedbackNotOrientation) ? this.props.onFeedback : this.props.onOrientation;\n\t  return (\n\t      <div key={localkey} id={vid} className='video-placeholder'>\n\t        <div className='invite-indicator'>\n\t          <div>\n\t      <i className='fa fa-smile-o fa-2x' style={{ visibility: 'hidden'}}></i>\n\t      \n\t\t  <p style={{visibility: `${topmsgvis}`, color: 'white', maxWidth: '80%', margin: '0 auto', fontSize: '1rem'}}>{topmsg}</p>\n\n\t      {/*              <div style={{color: 'white'}}> */}\n\t\t  {/* I have no idea how to incease the roundness of these corners */}\n\t      {/* We need to create a colore class to unify with invite-friends-button */}\n                  <button className='invite-button invite-orientation-button' onClick={fnc}\n \t              >{msg}</button>\n\t\t  {/*\t            </div>\t      \t  */}\n  \t         </div>\n\t        </div>\n\t\t  </div>);\n  }\t  \n}\n\nclass JourneySpace extends Component {\n\n  constructor(props) {\n      super(props);\n    this.state = {\n      streams: [],\n      publisherId: '',\n      session: null,\n      playerState: 'waiting',\n      playerProgress: 0,\n      playerProgressMS: 0,\n      journeyDuration: 0,\n      currentlyActivePublisher: null,\n\tshowInviteModal: false,\n\tshowOrientationModal: false,\n\tshowFeedbackModal: false,\n      showIntro: true,\n    }\n    this.publisher = {};\n    this.audioTag = {};\n  }\n\n    componentDidMount() {\n\tstate.audioTag.addEventListener('ended', (event) => {\n\t    console.log(\"CHANGING STATE TO ENDED!\");\n\t    if (this.publisher && this.publisher.state && this.publisher.state.publisher) {\n\t\tthis.publisher.state.publisher.publishAudio(true);\n\t    }\n\t    this.setState({\n\t\tplayerState: 'ended'\n\t    });\n\n\t    console.log(\"DOING /completed fetch\");\n\t    fetch(`/api/journeys/${this.props.match.params.room}/completed`, {\n\t\tcache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n\t\tcredentials: 'same-origin', // include, same-origin, *omit\n\t\theaders: {\n\t\t    'content-type': 'application/json'\n\t\t},\n\t\tmethod: 'POST', // *GET, POST, PUT, DELETE, etc.\n\t\tmode: 'cors', // no-cors, cors, *same-origin\n\t\tredirect: 'follow', // manual, *follow, error\n\t\treferrer: 'no-referrer', // *client, no-referrer\n\t    });\n\n\t    if (decodeURIComponent(state.audioTag.src) === `${window.location.origin}${state.journey.journey}`) {\n\t\tstate.audioTag.enqueue(['/chime.mp3', '/sharing.mp3']).then(() => {\n\t\t    // sharing audio ended\n\t\t    if (this.publisher && this.publisher.state && this.publisher.state.publisher) {\n\t\t\tthis.publisher.state.publisher.publishAudio(true);\n\t\t    }\n\t\t});\n\t\tstate.audioTag.play();\n\t    }\n\t});\n\n\t\tfetch(`/api/journeys/${this.props.match.params.room}${window.location.search}`, {credentials: 'include'})\n\t\t\t.then(res => res.json())\n\t\t\t.then(json => {\n\t\t\t\tstate.journey = json;\n\n        state.audioTag.src = state.journey.journey;\n        state.audioTag.currentTime = 0;\n\n        this.sessionHelper = createSession({\n          apiKey: state.openTokKey,\n          sessionId: state.journey.sessionId,\n          token: state.journey.token,\n          onConnect: () => {\n            console.log('assigned connection to publisher', this.sessionHelper.session.connection);\n            fetch(`/api/journeys/${this.props.match.params.room}/joined`, {\n              body: JSON.stringify({id: this.sessionHelper.session.connection.id}),\n              credentials: 'same-origin', // include, same-origin, *omit\n              headers: {\n                'content-type': 'application/json'\n              },\n              method: 'POST', // *GET, POST, PUT, DELETE, etc.\n              mode: 'cors', // no-cors, cors, *same-origin\n              redirect: 'follow', // manual, *follow, error\n              referrer: 'no-referrer', // *client, no-referrer\n            });\n          },\n          onStreamsUpdated: streams => {\n            console.log('Current subscriber streams:', streams);\n            this.setState({ streams });\n            if (!this.state.currentlyActivePublisher) {\n              this.setState({\n                currentlyActivePublisher: streams[0]\n              });\n            }\n          }\n        });\n        this.sessionHelper.session.on(\"connectionDestroyed\", (event) => {\n          const data = {\n            sessionId: this.sessionHelper.session.sessionId,\n            connection: {\n              id: event.connection.id\n            },\n            event: 'connectionDestroyed',\n          }\n          this.refreshSession();\n        });\n        this.sessionHelper.session.on(\"connectionCreated\", (event) => {\n          this.refreshSession();\n        });\n        this.sessionHelper.session.on('signal', (event) => {\n          console.log(\"Signal sent from connection \", event);\n          this.refreshSession();\n        });\n\n        this.sessionHelper.session.on(\"signal:startJourney\", (event) => {\n          if (this.publisher && this.publisher.state && this.publisher.state.publisher) {\n            this.publisher.state.publisher.publishAudio(false);\n          }\n          const playPromise = state.audioTag.play();\n          if (playPromise !== undefined) {\n            playPromise\n            .then(() => {\n              console.log('audio promise resolve');\n            })\n            // Safety first!\n            .catch(e => {\n              console.error(e);\n            });\n          }\n          this.setState({\n            playerState: 'playing'\n          });\n        });\n\n        this.sessionHelper.session.on(\"signal:pauseJourney\", (event) => {\n          if (this.publisher && this.publisher.state && this.publisher.state.publisher) {\n            this.publisher.state.publisher.publishAudio(true);\n          }\n          state.audioTag.pause();\n          this.setState({\n            playerState: 'paused'\n          });\n        });\n\n        this.sessionHelper.session.on(\"signal:journeyUpdated\", (event) => {\n          const journey = JSON.parse(event.data);\n            state.journey = journey;\n\t    console.log(\" Got signal:journeyUpdated \", event);\n\n          if (state.journey.state != 'completed') {\n            // if we are in completed state, then audio may be playing the sharing prompt\n            state.audioTag.src = state.journey.journey;\n            state.audioTag.currentTime = 0;\n          }\n\n          if (state.journey.state === 'started') {\n\n            if (this.publisher && this.publisher.state && this.publisher.state.publisher) {\n              this.publisher.state.publisher.publishAudio(false);\n            }\n            state.audioTag.play();\n            this.setState({\n              playerState: 'playing'\n            });\n          }\n        });\n        \n\n        this.sessionHelper.session.on(\"signal:fail\", (event) => {\n          state.journey.state = 'failed';\n        });\n\n\n        this.setState({\n          session: this.sessionHelper.session\n        });\n\n        const onAudioCanPlay = (event) => { \n          if (state.journey.state === 'started') {\n            state.audioTag.play();\n            if (!isNaN(state.journey.currentTime)) {\n              state.audioTag.currentTime = state.journey.currentTime;\n            }\n          }\n          state.audioTag.removeEventListener('canplaythrough', onAudioCanPlay);\n        }\n\n        state.audioTag.addEventListener('canplaythrough', onAudioCanPlay, false);\n        state.audioTag.load();\n\t\t\t});\n    fetch('/api/journeys')\n      .then(res => res.json())\n      .then(json => {\n        state.journeys = json;\n      });\n\n\n\t}\n\n  componentWillUnmount() {\n    if (this.sessionHelper) {\n      this.sessionHelper.disconnect();\n    }\n  }\n\n  refreshSession = () => {\n\t\tfetch(`/api/journeys/${this.props.match.params.room}`, {credentials: 'include'})\n\t\t\t.then(res => res.json())\n\t\t\t.then(json => {\n\t\t\t    state.journey = json;\n\t\t\t});\n      setTimeout(someHelper.setSizes,1000);\n  }\n\n  get timeRemaining() {\n    const seconds = this.state.journeyDuration - this.state.playerProgressMS;\n    const minutes = Math.floor(seconds / 60);\n    const remainingSeconds = (seconds % 60).toFixed(0);\n    return minutes + \":\" + (remainingSeconds < 10 ? '0' : '') + remainingSeconds;\n  }\n\n  get isHostUser() {\n    const currentParticipant = this.state.session && this.state.session.connection && state.journey && state.journey.participants.find(participant => participant.connectionId === this.state.session.connection.id);\n    return currentParticipant && state.journey.participants.indexOf(currentParticipant) === 0\n  }\n\n  get journeyStateTimer() {\n    switch(state.journey.state) {\n      case 'started':\n      case 'paused':\n        if (!this.playerTimeEmitter) {\n          this.playerTimeEmitter = new AudioPlayTickEmitter(state.audioTag);\n        }\n        return this.playerTimeEmitter;\n      default:\n        if (!this.secondsEmitter) {\n          this.secondsEmitter = new SecondsTimerEmitter(new Date(state.journey.createdAt), new Date(state.journey.startAt));\n        }\n        return this.secondsEmitter;\n    }\n  }\n\n  onInitPublisher = () => {\n    console.log('initialized publisher');\n  }\n\n  onConfirmReady = (e) => {\n    fetch(`/api/journeys/${this.props.match.params.room}/connections/${this.sessionHelper.session.connection.id}/ready`);\n  }\n\n  onChangeJourney = (e) => {\n    fetch(`/api/journeys/${this.props.match.params.room}/journey`, {\n      body: JSON.stringify({journey: e.target.value}), // must match 'Content-Type' header\n      cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n      credentials: 'same-origin', // include, same-origin, *omit\n      headers: {\n        'content-type': 'application/json'\n      },\n      method: 'PUT', // *GET, POST, PUT, DELETE, etc.\n      mode: 'cors', // no-cors, cors, *same-origin\n      redirect: 'follow', // manual, *follow, error\n      referrer: 'no-referrer', // *client, no-referrer\n    });\n  }\n\n  onStartSession = (e) => {\n    fetch(`/api/journeys/${this.props.match.params.room}/start`, {\n      cache: 'no-cache',\n      credentials: 'same-origin',\n      headers: {\n        'content-type': 'application/json'\n      },\n      method: 'POST',\n      mode: 'cors',\n    });\n  }\n\n  onLoadedMetadata = (e) => {\n    this.setState({\n      journeyDuration: e.target.duration\n    });\n    state.audioTag.removeEventListener('timeupdate', this.onTimeUpdate);\n    state.audioTag.addEventListener('timeupdate', this.onTimeUpdate);\n  }\n\n    onTimeUpdate = (e) => {\n\tconsole.log(\"onTimeUpdate\",e);\n\tconsole.log(\"onTimeUpdate\",e.target.currentTime);\t\n    this.setState({\n      playerProgress: (e.target.currentTime / e.target.duration) * 100,\n      playerProgressMS: e.target.currentTime,\n    });\n    if (this.isHostUser) {\n      fetch(`/api/journeys/${this.props.match.params.room}/progress`, {\n        body: JSON.stringify({currentTime: e.target.currentTime}),\n        cache: 'no-cache',\n        credentials: 'same-origin',\n        headers: {\n          'content-type': 'application/json'\n        },\n        method: 'PUT',\n        mode: 'cors',\n      });\n    }\n  }\n\n  onFlag = (stream) => {\n    fetch(`/api/journeys/${this.props.match.params.room}/flag`, {\n      cache: 'no-cache',\n      body: JSON.stringify({connectionId: this.state.session.connection.id, stream}),\n      credentials: 'same-origin',\n      headers: {\n        'content-type': 'application/json'\n      },\n      method: 'POST',\n      mode: 'cors',\n    })\n      .then(res => res.json())\n      .then(json => state.journey = json);\n  }\n\n  onShare = (e) => {\n    navigator.share({\n      title: 'Take a Journey With Me!',\n      text: `Join me on ${state.journey.name}`,\n      url: `${window.location.protocol}//${window.location.host}/${state.journey.room}`,\n    });\n  }\n\n  onInvite = (e) => {\n    e.preventDefault();\n    this.setState({\n      showInviteModal: true\n    });\n  }\n\n  onCloseShareModal = (e) => {\n    e.preventDefault();\n    this.setState({\n      showInviteModal: false\n    });\n  }\n\n  onCompleteShare = (url, name) => {\n    this.setState({\n      showInviteModal: false\n    });\n    window.location = url + `?journey=${state.journey.name}&name=${name}`;\n  }\n\n    onOrientation = (e) => {\n\tconsole.log(\"onOrientation called\");\n    e.preventDefault();\n    this.setState({\n      showOrientationModal: true\n    });\n    e.stopPropagation();\t\n  }\n\n  onCloseOrientationModal = (e) => {\n    e.preventDefault();\n    this.setState({\n      showOrientationModal: false\n    });\n  }\n\n  onCompleteOrienetation = (url, name) => {\n    this.setState({\n      showOrientationModal: false\n    });\n    window.location = url + `?journey=${state.journey.name}&name=${name}`;\n  }\n\n\n    onFeedback = (e) => {\n\tconsole.log(\"onFeedback called!\");\n    e.preventDefault();\n    this.setState({\n      showFeedbackModal: true\n    });\n    e.stopPropagation();\t\n  }\n\n  onCloseFeedbackModal = (e) => {\n    e.preventDefault();\n    this.setState({\n      showFeedbackModal: false\n    });\n  }\n\n  onCompleteFeedback = (url, name) => {\n    this.setState({\n      showFeedbackModal: false\n    });\n    window.location = url + `?journey=${state.journey.name}&name=${name}`;\n  }\n    \n\n\n    seekTo = (fraction) => {\n      console.log(\"duration\",state.audioTag.duration);\n      console.log(\"audioTag\",state.audioTag.currentTime);      \n\tstate.audioTag.play();\n\n\t\n\t\n    state.audioTag.currentTime = state.audioTag.duration * fraction;\n\n      console.log(\"SEEK called with:\",fraction);\n\tconsole.log(\"audioTag\",state.audioTag.currentTime);\n\t// This only needs a target...must determine what time that is..\n\t// I think iit is the audioTag\n\tvar e = {target: {currentTime: state.audioTag.currentTime}};\n\tthis.onTimeUpdate(e);\n  }\n\n    togglePlayState = (e) => {\n    e.preventDefault();\n    setTimeout(() => {\n      if (state.audioTag.paused) {\n        fetch(`/api/journeys/${state.journey.room}/start`, {\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'content-type': 'application/json'\n          },\n          method: 'POST',\n          mode: 'cors',\n        });\n      } else {\n        fetch(`/api/journeys/${state.journey.room}/pause`, {\n          cache: 'no-cache',\n          credentials: 'same-origin',\n          headers: {\n            'content-type': 'application/json'\n          },\n          method: 'POST',\n          mode: 'cors',\n        });\n      }\n    }, 20);\n    }\n\n    \n    render() {\n\t    const currentParticipant = this.state.session && this.state.session.connection && state.journey && state.journey.participants.find(participant => participant.connectionId === this.state.session.connection.id);\n\t    var local_key_counter_to_avoid_warning = 0;\t    \n\t    let currentUserHasFlaggedJourney = state.journey && state.journey.flags.map(flag => flag.user).indexOf(state.sessionId) > -1;\n\t    var stream0 = this.state.streams[0];\n\treturn (\n\t\t<div className='journeyspace' style={{position: 'relative'}}>\n\t    {/*          <div className='journeyspace-content flexiblerow'> */}\n\t\t{this.state.session && /* AAA */\n          <div className='journeyspace-content'>\t\t \n\n\t\t{/* tob bar */}\n\t\t<div id=\"topbar_and_header\">\n\t\t <Header history={this.props.history} showLeave={true} />\n\n\t\t \n\t\t <div id=\"titlebar\" className='flexiblerow space-between-added'\n\t\t style={{marginLeft: '20px', marginRight: '20px', backgroundColor: 'black', color: 'white'}}>\n\t\t \n\t\t {state.journey.startAt && <span style={{color: 'white'}} >{state.journey.name}</span>\n\t\t }\n                 { !state.journey.startAt && (state.journey.state === 'created' || state.journey.state === 'joined' || state.journey.state === 'completed') &&\n\t\t  <div style={{padding: '10px'}}>\n\t\t   <select style={{width: '100%'}} onChange={this.onChangeJourney} value={state.journeys&& state.journey.journey}>\n                        {state.journeys.map(journey => (\n                          <option value={journey.filePath}>{journey.name}</option>\n                        ))}\n                      </select>\n                   </div>}\n\n\n                   <JourneyPhases journey={state.journey} timer={this.journeyStateTimer} seekTo={this.seekTo}/>\n\n\t\t {/* we may need to make the Invite Friends button modal by this condition */}\n\t\t {/*\n\t\t {state.journey.startAt && ['joined', 'created'].indexOf(state.journey.state) > -1 && \n                    <div className='journeyspace-meta pr-3 pl-3 pt-3'>\n                      <SharePrompt onInvite={this.onInvite}/>\n                  </div>\n\t\t }\n\t\t  */}\n\n\t\t </div>\n\n\t    </div>\n\n\t\t {/*\n                 {state.journey.state === 'failed' &&\n                      <p className='p-3'>Nobody else has joined this Journey Space. \n                        You can either <a href='#' onClick={this.onStartSession}>hit play</a> and take the Journey by\n                        yourself of return to the <Link to='/join'>JourneyBoard</Link> to find another Journey Space\n                      </p>\n                  }\n\t\t  */}\n\n\n\n\t\t <div className=\"flex-squares\"> \n\t\t\t \n\t\t {/* here we create the two big squares;  */}\n\t\t <div id=\"bigsquares\">\n\n                    <span   key=\"name\">\n                      <img id='video-square0' className=\"journey-image\" src={state.journey.image} onClick={this.togglePlayState}/>\n                    </span>\n\n\t\t {/* This is the second square;  */}\t\t \n\t\t <div id='secondsquare' className='flexiblecol'>\n\n\t\t {/* This is a modal which is usually invisible. */}\n\t\t {this.state.showOrientationModal &&\n\t\t  <OrientationModal force={true} onComplete={this.onCompleteOrientation} onClose={this.onCloseOrientationModal}/>\n\t\t }\n\n\t\t {this.state.showFeedbackModal &&\n\t\t  <FeedbackModal\n\t\t  journeySpaceName={state.journey.name}\n\t\t  journey={this.state.session}\n\t\t  onComplete={this.onCompleteFeedback}\n\t\t  onClose={this.onCloseFeedbackModal}/>\n\t\t }\n\t\t \n\t\t \n\n\t\t <div style={{display: 'flex', flexDirection: 'row', visibility: `${(this.state.showOrientationModal || this.state.showFeedbackModal ) ? \"hidden\" : \"visible\"}`}}>\n\t\t <span key=\"stream\" id='video-square1' className='journeyspace-stream journeyspace-me'>\n                        <OTPublisher \n                          session={this.sessionHelper.session}\n                          onInit={this.onInitPublisher}\n                         ref={publisher => {this.publisher = publisher}}\n                              properties={{\n                                width: '100%',\n                                height: '100%',\n                              }}\n                        />\n\t\t </span>\n\t\t \n\t\t <UnfilledVideoSquare vidid='video-square2'\n\t\t limit={1}\n\t\t onInvite={this.onInvite}\t\t \n\t\t streamlength={this.state.streams.length}\n\t\t stream={this.state.streams[0]}\n\t\t session={this.sessionHelper.session}\n\t\t localkey={local_key_counter_to_avoid_warning++}\n\t\t state={this.state}\n\t\t journey={state.journey}\n\t\t sessionId={state.sessionId}\n\t\t visible={(!this.state.showOrientationModal)}\n\t\t ></UnfilledVideoSquare>\n\t\t </div>\n\n\t\t {/*\n\n\t\t {!(this.state.showInviteModal || this.state.showOrientationModal ) &&\n\t\t  */}\n\t\t <div id='central_control_panel_id'\n\t\t style={{visibility: `${(!(this.state.showInviteModal || this.state.showOrientationModal || this.state.showFeedbackModal)) ? \"visible\" : \"hidden\"}`}}\n\t\t >\n\n\n\t\t\t <VideoButton\n\t\t\t publisher={this.publisher}/>\n\t\t\t <AudioButton\n\t\t\t  publisher={this.publisher}/>\n\t\t <PlayButton style={{color: 'rgb(74,170,221)',backgroundColor: 'rgb(75,176,88)', borderRadius: '50%', }}\n\t\t journey={state.journey} player={state.audioTag}/>\t\t\t \n\n\t\t <PauseButton style={{color: 'rgb(74,170,221)',backgroundColor: 'rgb(75,176,88)', borderRadius: '50%', }}\n\t\t journey={state.journey} player={state.audioTag}/>\t\t\t \n\t\t \n\t\t <SkipButton style={{color: 'white',backgroundColor: 'rgb(75,176,88)', borderRadius: '50%',  }} journey={state.journey}\n\t\t playerState={state.playerState}\n\t\t seekTo={this.seekTo}\n\t\t />\n\t         </div>\n\t\t {/*\n\t\t    }*/}\t\t \n\n\t\t <div style={{display: 'flex', flexDirection: 'row', visibility: `${(this.state.showOrientationModal) ? \"hidden\" : \"visible\"}`}}>\n\t\t <UnfilledVideoSquare vidid='video-square3'\n\t\t limit={2}\n\t\t onInvite={this.onInvite}\t\t \n\t\t streamlength={this.state.streams.length}\n\t\t stream={this.state.streams[1]}\n\t\t session={this.sessionHelper.session}\n\t\t  localkey={local_key_counter_to_avoid_warning++}\n\t\t state={this.state}\n\t\t visible={(!this.state.showOrientationModal)}\t\t \n\t\t ></UnfilledVideoSquare>\n\t\t \n\t\t <NoVideoSquare vidid='video-square4'\n\t\t localkey={local_key_counter_to_avoid_warning++}\n\t\t onOrientation={this.onOrientation}\n\t\t onFeedback={this.onFeedback}\t\t \n\t\t playerState={this.state.playerState}\n\t\t ></NoVideoSquare>\n\t\t </div>\n\t\t \n\t\t </div>\n\t\t \n\t\t </div>\n\t\t \n\t\t \n\n\t\t \n\t\t\t </div>\n          <div className='journeyspace-footer' style={{display: 'flex'}}>\n            <div style={{flex: 1}}>\n            </div>\n            <div style={{marginLeft: 'auto', marginRight: '10px', alignSelf: 'center'}}>\n            </div>\n          </div>\n          {this.state.showInviteModal &&\n            <InviteModal journey={this.state.session} onComplete={this.onCompleteShare} onClose={this.onCloseShareModal}/>\n          }\n\t\t\t</div>\t\t \n\t\t}\n\t    \n\t\t\t {/* AAA */}\n\n\n\t\t    </div>\t\t\t\t\t\t\n\t)\n\t}\n}\n\nexport default view(JourneySpace);\n\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/journey_space.js","module.exports = require(\"react-swipeable-views-utils\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-swipeable-views-utils\"\n// module id = 102\n// module chunks = 0","module.exports = require(\"react-swipeable-views-core\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-swipeable-views-core\"\n// module id = 103\n// module chunks = 0","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 104\n// module chunks = 0","module.exports = require(\"opentok-layout-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"opentok-layout-js\"\n// module id = 105\n// module chunks = 0","if (__CLIENT__) {\n  navigator.share = navigator.share || (function(){\n      if (navigator.share) {\n          return navigator.share;\n      }\n\n    let android = navigator.userAgent.match(/Android/i);\n      let ios = navigator.userAgent.match(/iPhone|iPad|iPod/i);\n    let isDesktop = !(ios || android); // on those two support \"mobile deep links\", so HTTP based fallback for all others.\n\n    // sms on ios 'sms:;body='+payload, on Android 'sms:?body='+payload\n    let shareUrls = {\n        whatsapp: payload => (isDesktop ? 'https://api.whatsapp.com/send?text=' : 'whatsapp://send?text=') + payload,\n        telegram: payload => (isDesktop ? 'https://telegram.me/share/msg?url='+location.host+'&text=' : 'tg://msg?text=') + payload,\n        facebook: (payload, fbid, url) => `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,\n        email:    (payload, title) => 'mailto:?subject='+title+'&body='+payload,\n      sms:      payload => 'sms:/&body='+payload\n    };\n\n    class WebShareUI{\n      /*async*/\n      _init(){\n        if(this._initialized) return Promise.resolve();\n        this._initialized = true;\n\n        const template = `\n        <div class=\"web-share\" style=\"display: none\">\n          <div class=\"web-share-container web-share-grid\">\n              <div class=\"web-share-title\">SHARE VIA</div>\n            <a target='_blank' class=\"web-share-item web-share-facebook\">\n                  <div class=\"fa fa-facebook-official fa-3x\"></div>\n                  <div class=\"web-share-item-desc\">Facebook</div>\n              </a>\n              <a class=\"web-share-item web-share-email\">\n              <div class=\"fa fa-envelope fa-3x\"></div>\n              <div class=\"web-share-item-desc\">Email</div>\n            </a>\n              <a class=\"web-share-item web-share-sms\">\n              <div class=\"fa fa-commenting fa-3x\"></div>\n              <div class=\"web-share-item-desc\">SMS</div>\n            </a>\n            <a class=\"web-share-item web-share-copy\">\n                  <div class=\"fa fa-clone fa-3x\"></div>\n                  <div class=\"web-share-item-desc\">Copy</div>\n              </a>\n          </div>\n          <div class=\"web-share-container web-share-cancel\">Cancel</div>\n        </div>\n        `;\n\n        const el = document.createElement('div');\n        el.innerHTML = template;\n\n        this.$root     = el.querySelector('.web-share');\n        this.$whatsapp = el.querySelector('.web-share-whatsapp');\n        this.$facebook = el.querySelector('.web-share-facebook');\n        this.$telegram = el.querySelector('.web-share-telegram');\n        this.$email    = el.querySelector('.web-share-email');\n        this.$sms      = el.querySelector('.web-share-sms');\n        this.$copy     = el.querySelector('.web-share-copy');\n        this.$copy.onclick = () => this._copy();\n        this.$root.onclick = () => this._hide();\n        this.$root.classList.toggle('desktop', isDesktop);\n\n        document.body.appendChild(el);\n      }\n\n      _setPayload(payloadObj){\n        let payload = payloadObj.text + ' ' + payloadObj.url;\n        let title = payloadObj.title;\n        let facebookId = payloadObj.facebookId || '158651941570418';\n          this.url = payloadObj.url;\n        payload = encodeURIComponent(payload);\n        title = encodeURIComponent(title);\n        this.$whatsapp && (this.$whatsapp.href = shareUrls.whatsapp(payload));\n        this.$facebook.href = shareUrls.facebook(payload, facebookId, payloadObj.url);\n        this.$telegram && (this.$telegram.href = shareUrls.telegram(payload));\n        this.$email.href = shareUrls.email(payload, title);\n        this.$sms.href = shareUrls.sms(payload);\n      }\n\n      _copy(){\n              // A <span> contains the text to copy\n              const span = document.createElement('span');\n              span.textContent = this.url;\n              span.style.whiteSpace = 'pre'; // Preserve consecutive spaces and newlines\n\n              // Paint the span outside the viewport\n              span.style.position = 'absolute';\n              span.style.left = '-9999px';\n              span.style.top = '-9999px';\n\n              const win = window;\n              const selection = win.getSelection();\n              win.document.body.appendChild(span);\n\n              const range = win.document.createRange();\n              selection.removeAllRanges();\n              range.selectNode(span);\n              selection.addRange(range);\n\n              let success = false;\n              try {\n                  success = win.document.execCommand('copy');\n              } catch (err) {}\n\n              selection.removeAllRanges();\n              span.remove();\n\n              return success;\n      }\n\n      /*async*/\n      show(payloadObj){\n        this._init()\n        clearTimeout(this._hideTimer);\n        this._setPayload(payloadObj);\n        this.$root.style.display = 'flex';\n        this.$root.offsetWidth; // style update\n        this.$root.style.background = 'rgba(0,0,0,.4)';\n        document.querySelectorAll('.web-share-container').forEach(el => {\n            el.style.transform = 'translateY(0)';\n            el.style.opacity = 1;\n        });\n      }\n\n      _hide(){\n              this.$root.style.background = null;\n              document.querySelectorAll('.web-share-container').forEach(el => {\n                  el.style.transform = null;\n                  el.style.opacity = null;\n              });\n              this._hideTimer = setTimeout(() => this.$root.style.display = null, 400);\n      }\n    }\n\n    const shareUi = new WebShareUI();\n\n    /* async */\n    return data => shareUi.show(data);\n\n  }());\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/share.js","module.exports = require(\"react-rating\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-rating\"\n// module id = 107\n// module chunks = 0","module.exports = require(\"es6-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promise\"\n// module id = 108\n// module chunks = 0","import React, {Component} from 'react'\n\nclass CountdownMessage extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      currentCount: 10,\n      total: '',\n      days: '',\n      hours: '',\n      minutes: '',\n      seconds: ''\n    }\n\n    this.countdown = this.countdown.bind(this);\n  }\n\n  componentDidMount() {\n    this.intervalId = setInterval(this.countdown, 1000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.intervalId);\n  }\n\n  countdown() {\n    var deadline = Date.parse(this.props.endTime);\n    var now = Date.parse(new Date());\n    var timeRemaining = deadline - now\n\n    var seconds = Math.floor( (timeRemaining/1000) % 60 );\n    var minutes = Math.floor( (timeRemaining/1000/60) % 60 );\n    var hours = Math.floor( (timeRemaining/(1000*60*60)) % 24 );\n    var days = Math.floor( timeRemaining/(1000*60*60*24) );\n\n    this.setState({total: timeRemaining, minutes: minutes, seconds: seconds})\n\n  }\n\n\n  render() {\n    var totalTimeInMinutes = this.state.total/1000/60\n    if(totalTimeInMinutes > 0 && totalTimeInMinutes < 5) {\n      var message = `Starting in: ${this.state.minutes > 0 ? this.state.minutes + \"min\" : \"\"} ${this.state.seconds}sec`\n    } else {\n      var message = \"Started\"\n    }\n\n    if (totalTimeInMinutes < 5) {\n      return (\n        <div id='countdown-time' className='btn btn-info' ref='countdown_ref'>\n          {message}\n        </div>\n      );\n    } else {\n      return (\n        <div></div>\n        )\n    }\n  }\n}\n\nexport default CountdownMessage;\n\n\n\n// WEBPACK FOOTER //\n// ../client/src/components/countdown_message.js","module.exports = require(\"agenda\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"agenda\"\n// module id = 110\n// module chunks = 0","module.exports = require(\"agendash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"agendash\"\n// module id = 111\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 112\n// module chunks = 0","module.exports = require(\"connect-mongo\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-mongo\"\n// module id = 113\n// module chunks = 0"],"sourceRoot":""}